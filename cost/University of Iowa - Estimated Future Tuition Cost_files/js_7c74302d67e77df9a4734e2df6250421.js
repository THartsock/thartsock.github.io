if(/firefox/i.test(navigator.userAgent)){var nativeGetComputedStyle=window.getComputedStyle,defaults={width:0,height:0};window.getComputedStyle=function(b,c){var a=nativeGetComputedStyle(b,c);return null===a?{getPropertyValue:function(a){return defaults[a]}}:a}};
;
(function(){if(!window.google||!google.gears){var d=null;if("undefined"!=typeof GearsFactory)d=new GearsFactory;else try{d=new ActiveXObject("Gears.Factory"),-1!=d.getBuildInfo().indexOf("ie_mobile")&&d.privateSetGlobalObject(this)}catch(e){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(d=document.createElement("object"),d.style.display="none",d.width=0,d.height=0,d.type="application/x-googlegears",document.documentElement.appendChild(d))}d&&(window.google||
(google={}),google.gears||(google.gears={factory:d}))}})();
Persist=function(){var d,e,c,l,q,n;n=function(){var a=["expires","path","domain"],b=escape,f=unescape,d=document,c,e=function(s,f){var d,p,c=[],e=2<arguments.length?arguments[2]:{};c.push(b(s)+"="+b(f));for(var g=0;g<a.length;g++)d=a[g],(p=e[d])&&c.push(d+"="+p);e.secure&&c.push("secure");return c.join("; ")};c={set:function(a,b){var f=2<arguments.length?arguments[2]:{},c=new Date;c.setTime(c.getTime());var k={};if(f.expires)if(-1==f.expires)k.expires=-1;else{var m=864E5*f.expires;k.expires=new Date(c.getTime()+
m);k.expires=k.expires.toGMTString()}c=["path","domain","secure"];for(m=0;m<c.length;m++)f[c[m]]&&(k[c[m]]=f[c[m]]);f=e(a,b,k);d.cookie=f;return b},has:function(a){a=b(a);var f=d.cookie,c=f.indexOf(a+"="),f=f.substring(0,a.length);return!c&&a!=f||0>c?!1:!0},get:function(a){a=b(a);var c=d.cookie,e=c.indexOf(a+"="),p=e+a.length+1,k=c.substring(0,a.length);if(!e&&a!=k||0>e)return null;a=c.indexOf(";",p);0>a&&(a=c.length);return f(c.substring(p,a))},remove:function(a){var b=c.get(a);d.cookie=e(a,"",{expires:"Thu, 01-Jan-1970 00:00:01 GMT"});
return b},keys:function(){for(var a=d.cookie.split("; "),b,c=[],e=0;e<a.length;e++)b=a[e].split("="),c.push(f(b[0]));return c},all:function(){for(var a=d.cookie.split("; "),b,c=[],e=0;e<a.length;e++)b=a[e].split("="),c.push([f(b[0]),f(b[1])]);return c},version:"0.2.1",enabled:!1};c.enabled=function(){var a=new Date,a=a.toGMTString();this.set("__EC_TEST__",a);return this.enabled=this.remove("__EC_TEST__")==a}.call(c);return c}();var t=function(){return Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,
b)}:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1}}();q=function(){};c=function(a){return"PS"+a.replace(/_/g,"__").replace(/ /g,"_s")};var h="localstorage globalstorage gears cookie ie flash".split(" "),u=/^[a-z][a-z0-9_ \-]+$/i,r="init get set remove load save iterate".split(" "),v={autostart:!0};e={gears:{size:-1,test:function(){return window.google&&window.google.gears?!0:!1},methods:{init:function(){var a;a=this.db=google.gears.factory.create("beta.database");a.open(c(this.name));
a.execute("CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)").close()},get:function(a){var b=this.db,c;b.execute("BEGIN").close();a=b.execute("SELECT v FROM persist_data WHERE k = ?",[a]);c=a.isValidRow()?a.field(0):null;a.close();b.execute("COMMIT").close();return c},set:function(a,b){var c=this.db;c.execute("BEGIN").close();c.execute("DELETE FROM persist_data WHERE k = ?",[a]).close();c.execute("INSERT INTO persist_data(k, v) VALUES (?, ?)",[a,b]).close();
c.execute("COMMIT").close();return b},remove:function(a){var b=this.db;b.execute("BEGIN").close();b.execute("DELETE FROM persist_data WHERE k = ?",[a]).close();b.execute("COMMIT").close();return!0},iterate:function(a,b){var c;for(c=this.db.execute("SELECT * FROM persist_data");c.isValidRow();)a.call(b||this,c.field(0),c.field(1)),c.next();c.close()}}},globalstorage:{size:5242880,test:function(){return window.globalStorage?!0:!1},methods:{key:function(a){return c(this.name)+c(a)},init:function(){this.store=
globalStorage[this.o.domain]},get:function(a){a=this.key(a);return this.store.getItem(a)},set:function(a,b){a=this.key(a);this.store.setItem(a,b);return b},remove:function(a){var b;a=this.key(a);b=this.store.getItem[a];this.store.removeItem(a);return b}}},localstorage:{size:-1,test:function(){try{if(window.localStorage&&void 0==window.localStorage.setItem("test",null))if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){if(9<=RegExp.$1)return!0;if("file:"==window.location.protocol)return!1}else return!0;
else return!1;return window.localStorage?!0:!1}catch(a){return!1}},methods:{key:function(a){return this.name+">"+a},init:function(){this.store=localStorage},get:function(a){a=this.key(a);return this.store.getItem(a)},set:function(a,b){a=this.key(a);this.store.setItem(a,b);return b},remove:function(a){var b;a=this.key(a);b=this.store.getItem(a);this.store.removeItem(a);return b},iterate:function(a,b){for(var c=this.store,d,e,h=0;h<c.length;h++)d=c.key(h),e=d.split(">"),2==e.length&&e[0]==this.name&&
a.call(b||this,e[1],c.getItem(d))}}},ie:{prefix:"_persist_data-",size:65536,test:function(){return window.ActiveXObject?!0:!1},make_userdata:function(a){var b=document.createElement("div");b.id=a;b.style.display="none";b.addBehavior("#default#userdata");document.body.appendChild(b);return b},methods:{init:function(){var a=e.ie.prefix+c(this.name);this.el=e.ie.make_userdata(a);this.o.defer&&this.load()},get:function(a){a=c(a);this.o.defer||this.load();return this.el.getAttribute(a)},set:function(a,
b){a=c(a);this.el.setAttribute(a,b);this.o.defer||this.save();return b},remove:function(a){var b;a=c(a);this.o.defer||this.load();b=this.el.getAttribute(a);this.el.removeAttribute(a);this.o.defer||this.save();return b},load:function(){this.el.load(c(this.name))},save:function(){this.el.save(c(this.name))}}},cookie:{delim:":",size:4E3,test:function(){return d.Cookie.enabled?!0:!1},methods:{key:function(a){return this.name+e.cookie.delim+a},get:function(a,b){a=this.key(a);return n.get(a)},set:function(a,
b,c){a=this.key(a);n.set(a,b,this.o);return b},remove:function(a,b){a=this.key(a);return b=n.remove(a)}}},flash:{test:function(){try{if(!window.swfobject)return!1}catch(a){return!1}return 8<=swfobject.getFlashPlayerVersion().major?!0:!1},methods:{init:function(){if(!e.flash.el){var a,b;a=document.createElement("div");a.id="_persist_flash_wrap";b=document.createElement("div");b.id="_persist_flash";a.appendChild(b);document.body.appendChild(a);e.flash.el=swfobject.createSWF({id:"_persist_flash",data:this.o.swf_path||
"persist.swf",width:1,height:1},v,"_persist_flash")}this.el=e.flash.el},get:function(a){a=c(a);return this.el.get(this.name,a)},set:function(a,b){a=c(a);return this.el.set(this.name,a,b)},remove:function(a){a=c(a);return this.el.remove(this.name,a)}}}};l=function(){var a,b,c=h;a=0;for(var g=r.length;a<g;a++)d.Store.prototype[r[a]]=q;d.type=null;d.size=-1;for(var g=0,l=c.length;!d.type&&g<l;g++)if(a=e[c[g]],a.test())for(b in d.type=c[g],d.size=a.size,a.methods)d.Store.prototype[b]=a.methods[b];d._init=
!0};d={VERSION:"0.3.1",type:null,size:0,add:function(a){e[a.id]=a;h=[a.id].concat(h);l()},remove:function(a){var b=t(h,a);0>b||(h.splice(b,1),delete e[a],l())},Cookie:n,Store:function(a,b){if(!u.exec(a))throw Error("Invalid name");if(!d.type)throw Error("No suitable storage found");b=b||{};this.name=a;b.domain=b.domain||location.hostname||"localhost";b.domain=b.domain.replace(/:\d+$/,"");b.domain="localhost"==b.domain?"":b.domain;this.o=b;b.expires=b.expires||730;b.path=b.path||"/";this.o.search_order&&
(h=this.o.search_order,l());this.init()}};l();return d}();
;
(function(){function k(a,b,f,g){var e=this,d=randHash(16),c={action:"get",hash:d,name:a};a=document.createElement("a");a.href=b.src;var l=a.protocol+"//"+a.hostname;$w.on("message."+d,function(a){a=a.originalEvent;var h;try{h=JSON.parse(a.data)}catch(k){return}if(h.hash===d){$w.off("message."+d);c.action="set";var m=[];e.iterate(function(a,b){m.push({k:a,v:b})});c.data=_.isFunction(f)?f(h.data||[],m):[];b.contentWindow.postMessage(JSON.stringify(c),l);_.forEach(c.data,function(a,b){e.set(b,a)});_.isFunction(g)&&
g()}});b.contentWindow.postMessage(JSON.stringify(c),l)}var b={};window.Persist.Store.prototype.sync=function(a,n,f){var g=this,e;b[a]||(e="www"===a?"//"+(FTB.IS_LOCAL?"www.dw.com":"www.graphiq.com")+"/lstore_sync?app_id="+FTB.app_id:"//"+a+"."+FTB.DOMAIN+"/lstore_sync?app_id="+FTB.app_id,b[a]={queue:[],$iframe:$('<iframe src="'+e+'" style="display: none"></iframe>').on("load",function(){var d=function(c){k.apply(g,[c.name,b[a].$iframe.get(0),c.callback,c.done])};_.forEach(b[a].queue,d);b[a].queue.push=
d}).appendTo("body")});b[a].queue.push({name:this.name,callback:n,done:f})}})();
;
(function(l){if(!FTB.ABTest){var d=persist("ABTest",{expires:-1}),g={},n={},p=!1;"localstorage"!==window.Persist.type&&(d=persist.mocked,p=!0);var f=function(b){var a={},f=function(a){for(var e=0,d=0,b;b=a[d];++d){if(b.weight===l)throw"Weight must be defined for each AB Test";e+=b.weight}return $.map(a,function(a){return{percent:a.weight/e,label:a.label}})},m,k=function(c){var e;m===l&&(m=!1,e=GET().testbucket)&&(e=e.split(":"),e[0]===a.p.id&&(m=e[1]));e=m;c=e||c;if(!0===c){a:{c=f(a.p.tests);e=Math.random();
for(var b=0,h=0,k=c.length;h<k;h++){if(e>b&&e<c[h].percent+b){c=c[h].label;break a}b+=c[h].percent}c=void 0}return c?(a.tag=c,d.set(a.p.id,a.tag),g[a.p.id]=a.tag):l}if(c===l)return d.get(a.p.id)||a.tag;a.tag=c;d.set(a.p.id,a.tag);g[a.p.id]=a.tag;return c};(function(){if(!b.id)throw"test id must be defined for AB Test";a.p=$.extend({},b);var c=k();c||(c=k(!0));a.tag=c;g[a.p.id]=a.tag;n[a.p.id]=a})();return{tag:k,log:function(c,b){var d={action:c,time_on_page:time_on_site(),desc:a.p.id+":"+a.tag};if(a.p.pass&&
-1===$.inArray(c,a.p.pass))return!1;$.extend(!0,d,b);if(("true"===GET().debug||a.p.debug)&&FTB.IS_EMPLOYEE)console.log("The following data will be sent to Kibana:",d);else{if(p)return!1;FTB.Analytics.send_data("ab_test",d)}return!0},reset:function(){d.remove(a.p.id);delete g[a.p.id];delete a.tag}}};f.active_tags=function(){return g};f.all_tags=function(){var b={};if(!_.isFunction(d.iterate))return b;d.iterate(function(a){"__time"!==a&&(b[a]=d.get(a))});return b};f.all_tests=function(){return _.map(n,
function(b,a){return{id:a,tags:_.pluck(b.p.tests,"label"),active:g[a]}})};f.clear_all=function(){var b=[];d.iterate(function(a){b.push(a)});_.forEach(b,function(a){d.remove(a)})};(d.get("__time")||!1)<_.now()/1E3-1800&&f.clear_all();d.set("__time",_.now()/1E3>>0);FTB.module("FTB.ABTest",f)}})();
;
(function(g,k,q){function n(){function a(a,c,d){EVT([b,a,c||"",0,d||!1]);(g.widget_log||$.noop)(b,a,c,d)}var b,d,c;FTB.widget_error&&FTB.widget_id&&FTB.utils.postMessage({method:"remove",wid:k.location.href},"*");if(b=p[FTB.widget_type]){c=!FTB.dynamic_widget&&-1<["SRP","Versus"].indexOf(b);var e,m=$(".ww-embed-this"),l=!1;FTB.widget_id||m.length&&m.hide();$(k).one("mouseover",function(){a("Impression + Hover");d=_.now()}).on("click",".ww-footer-link-a",function(){a("Click to "+f(this),"Click Footer (See More)")}).on("click",
".powered-link",function(){a("Click FTB Logo")}).on("click",".ww-title-link",function(){a("Click to "+f(this),"Click Widget Title")}).on("click",".ss-more-details",function(){a("Click to "+f(this),"Click More Details")}).on("click",".ss-img-link, .det-img-a, .vs-img-a",function(){a("Click to "+f(this),"Click Image")}).on("click",".ss-mini-nav",function(){a("Scroll "+($(this).hasClass("ss-go-left")?"Left":"Right"))}).on("click",".ss-box",function(){a("Click Thumbnail")}).on("click",".vs-view-full",
function(){a("Click to "+f(this),"Click View Full Comparison")}).on("click","a.vs-title, .srp-widget .widget_row_link",function(){a("Click to "+f(this),"Click Listing Title")}).on("click",".wctr-field-clickable .ss-fields, .wctr-field-clickable .ww-datapoints-td, .wctr-field-clickable .vs-val",function(b){var c=$(".vs-view-full").attr("href")||$(".ww-title-link").attr("href");!$(b.target).closest("a,.link").length&&c&&(a("Click to "+f(this),"Click Fields"),g.open(c))}).on("mouseover",".wctr-field-clickable .vs-val",
function(){$(".vs-val").removeClass("vs-highlight");$(".vs-row").find(".vs-val:eq("+$(this).parent().children(".vs-val").index(this)+")").addClass("vs-highlight")}).on("click",".dsrc-sources",function(){a("Click on data sources")}).on("click",".ww-embed-this",function(){if($(".mask-menu").length)!l&&$(".mask-menu-x").siblings().remove();else e=g.MaskMenu($(".widget"));l||(g.WidgetShare(e.get(),{has_widget_img:c,widget_id:FTB.widget_id,custom_attrs:FTB.widget.custom_attrs}),l=!0);a("Inception Embed");
e.open()}).on("click",".tab-nav",function(){a("Click on Tab")});$.subscribe("affiliate/render",function(){a("Click See Prices")});$.subscribe("srpwidget/sort",function(){a("Sort")});$.subscribe("srpwidget/clickrow",function(){a("Click to DD","Click Listing Row")});var h=[5,10,30,60,300];$d.on("mousemove.widg click.widg",_.throttle(function(){h.length&&_.now()-d>1E3*h[0]&&(a(h.shift()+"s interaction"),h.length||$d.off("mousemove.widg click.widg"))},200));gatekeeper("WLP enable all widgets")&&FTB.backlink_for_test&&
"wlp-page"===FTB.ABTest({id:"wlp-backlink-test",tests:[{label:"nochange",weight:50},{label:"wlp-page",weight:50}]}).tag()&&($(".ww-title-link").attr("href",FTB.backlink_for_test),$(".ww-footer-link-a").attr("href",FTB.backlink_for_test));a("PageView","",!0)}}function f(a){var b=k.createElement("a"),d="SRP";if(!a)return d;_.isString(a)||(a=$(a),a=a.attr("href")||a.data("href"));b.href=a;b.href=b.href;/\/l\//.test(b.pathname)?d="DD":/\/compare\//.test(b.pathname)?d="SxS":/\/wlp\//.test(b.pathname)&&
(d="WLP");return d}var p={srp:"SRP",detail:"DD",ss:"SS",vs:"Versus",viz:"Viz",group:"Group",card:"Card"};g.MaskMenu=function(a,b){b=$.extend({},{html:"",initOpen:0},b);var d=a.jquery?a:$(a),c=$('<div class="mask-menu"/>').html(b.html),e={$:c,open:function(){c.show()},close:function(){c.hide()},get:function(){return c}};c.prepend('<div class="mask-menu-x">&times;</div>').appendTo(d).showIf(b.initOpen).on("click",".mask-menu-x",e.close);return e};$d.on("click",".shr-button",function(){var a=$(this).data("share-type");
a&&(EVT(["Share Overlay","Click "+a,"",0,!1]),(g.widget_log||$.noop)("Share Overlay","Click "+a))});$(function(){n();var a=$(".widget").outerWidth(),b=$(".ww-powered-by").outerWidth(),d=$(".ww-footer-link-a"),c=d.outerWidth(),e=parseInt($(".ww-footer-link").css("padding-left"),10);c+b>a&&(c=d.find(".ww-footer-link-reg").text(),c=c.substring(0,c.length-1),d.css("max-width",a-b-e).attr("title",c))})})(window,document);
;
(function(){function g(d,b,a,f,k){var g=d.split("#")[1];k=k||randHash(6);var e=d;g||("twitter"===b&&"/"!==e.slice(-1)&&(e+="/"),e+="facebook"===b||"twitter"===b?"#":encodeURIComponent("#"));e+="facebook"===b||"twitter"===b?"&":encodeURIComponent("&");e+="st="+k;p("hash_generated",d,b,a,f,k);return e}function p(d,b,a,f,k,g){FTB.Analytics.send_data("social",{action:d,hash:g,channel:a,shared_url:b,source:f.source||FTB.page_type,title:f.title||document.title,body:k||"",img_link:f.img_link||""})}window.miniShare=
function(d,b){d=d.jquery?d:$(d);b=b||{};if(d[0]){var a=window.location.pathname,f=b.url||"http://"+window.location.host.replace(".dw.com",".graphiq.com")+("/"!==a?a:""),k=b.title||document.title,q=b.img_link||"",e=encodeURIComponent(k),a=gatekeeper("Graphiq Launch")?tt("[network_name] - a Graphiq site",[FTB.net_name]):tt("[network_name] - a FindTheBest site",[FTB.net_name]),a=-1!==FTB.net_name.search("FindTheBest")?gatekeeper("Graphiq Launch")?"Graphiq":"FindTheBest":a,c="";switch(FTB.page_type){case "detail":c=
tt("I'm researching [detail_title] on [site_name]. Thoughts?",[window.detail.title,a]);break;case "comp":var r=_.pluck(window.compare.items,"title").join(" vs. "),c=tt("I'm comparing [comparison] on [site_name]. Thoughts?",[r,a]);break;case "editorial":c=tt("Reading an article about [topic_plural] on [site_name]. Check it out: ",[FTB.app_plural,a]);break;case "wlp":c=tt("I'm looking at [widget_title] on [site_name]. Check it out: ",[window.wlp.title,a]);break;case "widget":c="I thought you might be interested in this info from "+
FTB.net_name+": "+f;break;default:c=tt("I'm researching [topic_plural] on [site_name]. Thoughts?",[FTB.app_plural,a])}b.body&&(c='"'+b.body+'"');d.off("click",".shr-button");d.on("click",".shr-button",function(){var a,d=$(this),m=d.attr("class").split(" "),h=1<m.length?m[1].substr(4):"",l=b.incl_hash?f+window.location.hash:f,m=!0;switch(h){case "facebook":var n=randHash(6);if(!_.isFunction(window.load_fb_js)){a="https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+g(l,h,b,b.body||"",n)+"&p[images][0]="+
q+"&p[title]="+k+"&p[summary]="+c;break}load_fb_js(function(){FB.ui({method:"feed",name:k,link:g(l,h,b,b.body||"",n),picture:q,caption:"",description:b.body||""},function(a){if(a&&a.post_id){a=a.post_id.split("_");var c="";a[0]&&a[1]&&(c='<a target="_blank" href="http://www.facebook.com/permalink.php?id='+a[0]+"&v=wall&story_fbid="+a[1]+'">View</a>');MSG("Posted to Facebook successfully. "+c,"green");p("facebook_shared",l,h,b,b.body||"",n)}else p("facebook_canceled",l,h,b,b.body||"",n)})});break;
case "twitter":/[^\/]#/.test(l)&&(l=l.replace("#","/#"));a=gatekeeper("Graphiq Launch")?"GraphiqHQ":"FindTheBest";a="https://twitter.com/share?&text="+(FTB.IS_WIDGET?e:encodeURIComponent(c))+"&via="+a+"&url="+encodeURIComponent(g(l,h,b,c));break;case "googleplus":a="https://plus.google.com/share?url="+encodeURIComponent(g(l,h,b,c))+"&t="+encodeURIComponent(e);break;case "email":gatekeeper("ShareViaEmail")?481>window.innerWidth?a="mailto:?subject="+e+"&body="+encodeURIComponent(c+" ")+g(f,h,b,c):(FTB.spin(),
FTB.lazy("ShareViaEmail").done(function(){FTB.EmailBox.create({body:c,preview:{url:g(f,h,b,c)},clicked_index:$(".shr-email").index(d)})})):(m=!1,a="mailto:?subject="+e+"&body="+encodeURIComponent(c+" ")+g(f,h,b,c))}EVT(["Social Buttons",h,b.source||FTB.page_type,0,!1]);a&&(m?window.open(a,"shareWindow","status = 1, height = 500, width = 360, resizable = 0"):window.location=a)});FTB.EmailBox={share:function(a){$(".shr-email").get(a.clicked_index).click()}}}}})();
;
(function(b){var e=gatekeeper("disable widget kibana events"),c;b.widget_log=function(a,b,f,d){e||(a={eventCategory:a,eventAction:b,eventLabel:f||"",nonInteraction:d||!1},FTB.IS_DEVELOPER&&GET().debug?console.log("Widget Kibana Events:",a):FTB.Analytics.send_data("widgets",a),c||d||(c=!0,$.publish("widget/first_interaction")))}})(window);
;
(function(c,l,q,r){function g(){if(b&&b.enabled){var a=b.type||"srp";if(e[a])e[a]()}-1!==["srp","vs"].indexOf(b.type)&&(a=c(".ww-title-link").text().trim(),FTB.utils.postMessage({method:"title",content:a},"*"));if(-1!==["detail"].indexOf(b.type)&&2===n.tpl&&b.auto_resize_height&&FTB.preview_image_ratio){var a=c(".ww-root"),d=Math.min(Math.floor(a.width()/FTB.preview_image_ratio),600);FTB.utils.postMessage({method:"resize",height:d},"*");a.css("height",d)}}var b=FTB.widget_preview_indicate,n=FTB.widget_preview_options,
e={srp:function(){var a=c(".filter-wrap"),d,e,m=[],h,f;b.slide_filter&&!a.hasClass("open")&&(a.addClass("open"),setTimeout(function(){a.is(":hover")||a.removeClass("open")},1500));if(b.new_fields.length&&l.widgets){d=l.widgets[p];d=d.app;e=c(".srp-widget-table .srp-widget-th");for(var k=0,g=b.new_fields.length;k<g;k++)f=b.new_fields[k],f=d.head.indexOf(f),-1<f&&m.push(d.defs[f].name);h=e.filter(function(a){return-1<m.indexOf(c(this).text())});h.each(function(){var a=c(this);a.data("orig-bg",a.css("background"))}).css({transition:"background 0.2s ease-in-out",
background:"#fff0aa"});setTimeout(function(){h.each(function(){var a=c(this);a.css("background",a.data("orig-bg"))})},1500)}}},p=1;c(function(){setTimeout(g,300)})})(jQuery,window,document);
;
(function(){function g(a){FTB.geo=_.merge({},a,FTB.geo)}var k=Class.extend({init:function(a){this.fromJSON(a);this.vizWidth=this.options.viz_width||60;this.noLinks=this.options.no_links;this.configKey=this.options.config_key;this.isIframe=this.options.is_iframe;this.isEmbedded=this.options.is_embedded;this.target=this.isIframe?"_blank":"_parent";this.srp_data&&(_.bindAll(this,"renderResults"),this.app=this.getApp(),this.app.on("update",this.renderResults));_.bindAll(this,"applyHeight");return this},
render:function(a){this.el=a;this.$el=$(a);this.$=_.bind(this.$el.find,this.$el);this.$main=this.$("."+this.mainClass);this.applyHeight();this.$el.data("__widgetInstance",this);this.bindEvents()},renderViz:function(){viz.render(this.vizWidth,this.$el)},isLoaded:function(){return!this.options.lazyload||this.lazyDef&&"resolved"===this.lazyDef.state()},lazyLoad:function(){var a=this.options.lazyload;if(!a)return!0;if(!this.lazyDef){var a=a.join+"-"+a.item,b=$.Deferred();d.push({deferred:b,key:a});f();
this.lazyDef=b.done(this.app.update)}return this.lazyDef},bindEvents:function(){var a=this;a.$el.on("click","a.reset",function(b){a.resetFilters();cancelEvent(b)})},fromJSON:function(a){$.extend(this,_.pick(a,"options","srp_data","widgetId"));this.srp_data&&$.extend(this,_.pick(this.srp_data,"app_id","base_url"))},getApp:function(){return this.app||new window.App(this.srp_data)},getHeight:function(){if(this._height)return this._height;var a=this.options.h,b=this.options.minHeight||this.minHeight||
0,a="auto"===a?this.defaultHeight||b:Math.max(b,+a||0);this.isIframe&&(a-=this.headerHeight=this.$(".ww-header").outerHeight()||0,a-=this.footerHeight=this.$(".ww-footer").outerHeight()||0,a-=parseInt(this.$el.css("paddingTop"),0)||0,a-=parseInt(this.$el.css("paddingBottom"),0)||0,b=this.$(".ww-filters-wrap"),b.length&&a&&(a-=b.outerHeight()));a-=parseInt(this.$main.css("paddingTop"),0)||0;return this._height=a-=parseInt(this.$main.css("paddingBottom"),0)||0},applyHeight:function(){this.shouldPublishHeight()?
h(this.$el):"auto"!==this.options.h&&this.$main.height(this.getHeight())},shouldPublishHeight:function(){return!1},resize:function(){this._height=null},trackSponsors:function(){window.track_sponsor_links(this.$el.find(".sponsor_button"))},fitImage:function(a,b,c){b=Math.max(a.w/b,a.h/c);return{w:Math.round(a.w/b),h:Math.round(a.h/b)}},remove:function(a){a=a||this.$el;a=a.closest(".component");var b=(window.detail||{}).remove_component;a.length&&b&&b(a);this.destroy();return this},destroy:function(){this.off();
$.contains(document.documentElement,this.$el[0])&&this.$el.remove()},renderNoResults:function(a){(a||this.$main).html('<div class="no-results-placeholder"/><div class="no-results"><h1 class="no-results-header">No Results</h1><p class="no-results-body">Try <a class="link reset">resetting filters</a>'+(this.noLinks?"":' or <a href="'+this.base_url+'" target="_blank" class="link base-url">refining your search</a>.</p>')+"</div>");this.trigger("renderResults")},set:function(a,b){var c=this,e;"object"===
typeof a?e=a:(e={})[a]=b;_.each(e,function(a,b){c[b]!==a&&(c[b]=a,c.trigger("change:"+b))})}}).mixin(_.Events).statics({renderIn:function(a,b){var c=a.getWidgetInstance();if(c)return c;if(window.widgets){var c=a.data("id"),e=$.extend({},window.widgets[c],{widgetId:c});if(!c)throw"Widget information not found";c=new this(e);c.render(a,b||$.noop);return c}}}),d=[],f;f=_.debounce(function(){var a=d.slice(0),b={batches:_.pluck(a,"key").join(","),shapeKeys:Object.keys(FTB.geo||{})};$.getJSON("/ajax_lazy",
b).always(function(b){g(b._geo||[]);_.each(a,function(a){var d=b[a.key];a.deferred[d?"resolve":"reject"](d)})});d=[]},20);var h=_.throttle(function(a){a=a[0].scrollHeight||a.height();FTB.utils.postMessage({method:"resize",height:Math.max(a,200),_wid:FTB.widget_id,wid:document.location.href},"*")},50);FTB.module("FTB.widget.Base",k);FTB.widget.getById=function(a){return $('.ftb-widget[data-id="'+a+'"]').getWidgetInstance()};$.fn.getWidgetInstance=function(){var a=this.eq(0);return a?a.data("__widgetInstance"):
void 0}})();
;
FTB.module("FTB.widget.filterable",{initFilters:function(){var a=this.isFilteringEnabled();a&&(this.$(".wwf-spin").spin({size:5}),this.renderFilters(this.$(".ww-filters-wrap")));this.$(".widget-filter").showIf(a);this.open_dropdowns=0;return a},isFilteringEnabled:function(){return!(!_.size(this.options.filter_specs)||!FTB.filters)},renderFilters:function(a){this.$filterWrap=a;var b,c=this.options.filter_specs||{},d=c.specs||[],f=c.statics||[],g=a.find(".wwf-groups");for(a=0;a<d.length;a++)b="w_"+
_.uniqueId()+"_fltr_"+a,g.append('<div class="single-filter-wrap ww-filt-'+a+'" style="z-index:'+(1E3-a)+';"><div id="'+b+'" class="filter_group"></div></div>'),d[a].parent_group="#"+b,d[a].no_report=!0;this.filters=FTB.filters.create_collection({id:c.id,app_id:this.app.app_id,callback:_.bind(this.filterResults,this),sort_callback:_.bind(this.setSort||$.noop,this),load_callback:_.bind(this.onFilterLoad,this),filter_props:{dom:this.isEmbedded?this.$main.closest(".ww-root-inner"):$("body")},statics:f,
compact:!0,style_type:"Top"},d);this.bindFilterEvents()},getFilterState:function(){return this.filters?this.filters.get():this.srp_data.filters||[]},bindFilterEvents:function(){var a=this,b=-1;a.$el.on("click",".wwf-toggle",function(){a.$filterWrap.toggleClass("wwf-open").find(".filter-wrap-inner").toggleClass("stnd-box white-bg")});a.$el.on("toggle-drp",".drp",function(b,d){a.open_dropdowns+=d?1:-1;a.$filterWrap.toggleClass("ww-filters-wrap-open",0<a.open_dropdowns)});a.$el.on("click",".widget-filter-reset",
function(){a.resetFilters()}).on("click",".widget-filter",function(){b=a.$filterWrap.toggleClass("open").hasClass("open")?0:-1});a.$filterWrap.hover(function(){clearTimeout(b);b=0},function(c){0===b&&"SELECT"!==c.target.nodeName&&"INPUT"!==c.target.nodeName&&(b=setTimeout(function(){b=-1;a.$filterWrap.removeClass("open")},300))});a.$filterWrap.find(".filter-wrap-icon, .filter-wrap-close").on("vclick",function(c){cancelEvent(c);0<b&&window.clearTimeout&&clearTimeout(b);b=0;a.$filterWrap.removeClass("open")})},
resetFilters:function(){this.setSort(null);this.filters.reset();this.filterResults();this.$(".widget-filter-reset").removeClass("shown")},filterResults:function(a){var b=this,c=this.filters.has_criteria();a=$.extend({get_headers:!0,filters:c?this.filters.get():[],show_distance:!!this.options.show_distance,pre_update:a?function(a){if(!a.data.length&&!b.isEmbedded)return FTB.lazy("WidgetWelcomeMat").done(_.bind(b.renderWelcome,b)),!1}:$.noop},this.sort||{});this.configKey&&(a.config_key=this.configKey,
a.type="join");this.app.ajax(a);this.$(".widget-filter-reset").toggleClass("shown",c);this.filterResults._location=!1},renderWelcome:function(){var a=this,b;_.each(this.options.filter_specs.specs||[],function(c){if("_location"===c.db_name){var d=a.filters.get_filters("_location")[0],e=d.get_criteria();b={field:c.db_name,title:e[7]?tt("No results were found within [distance] [units]s of [location]",[e[4],d.options.units,e[7]]):tt("No Results Found")+" "+d.get_value_nice()}}});if(b&&FTB.widget.WM){try{b.img=
window.detail?window.detail.img_info.filename:window.compare?window.compare.items[this.$el.parent(".cell").data("cell-i")].img_info.file_name:this.app.images[Object.keys(this.app.images)[0]][0]}catch(c){b.img=!1}var d={single:{field:b.field},type:"single",title:tt("Enter a different location"),subtitle:b.title,other:tt("Reset all filters"),img:[b.img],style:"1"};this.$main.html(FTB.WelcomeMat.TPL);this.psf=new FTB.widget.WM({d:[d]},{f_collect:this.filters,f_specs:this.options.filter_specs.specs,$el:this.$main,
onAction:_.bind(this.welcomeCB,this)})}else a.filters.reset(),a.renderResults()},welcomeCB:function(a,b){switch(a){case "filter":this.filters.set([b.filter]);this.filterResults();break;case "other":this.resetFilters()}},setSort:function(a){var b=(this.sort||{}).sort_field;this.sort=a&&"distance"===a.current&&"distance"!==b&&-1===this.app.dist_index?{sort_index:0,sort_dir:"ASC",sort_field:"distance"}:{sort_field:null,sort_dir:null}},filtersLoaded:function(){this.$(".wwf-spin").spin(!1);this.$(".ww-filters").removeClass("ww-filters-stage")},
onFilterLoad:function(){if(this.filters.waiting())this.once("renderResults",this.filtersLoaded,this);else this.filtersLoaded()}});
;
FTB.module("FTB.widget.comparable",{initComparable:function(){this.getRCQ().onadd(this.onCompareAdd).onremove(this.onCompareRemove).each(this.onCompareAdd)},getRCQ:function(){if(FTB.rcq)this.rcq=FTB.rcq;else if(window.RCQ){var a=this.isIframe?this.$(".ww-root-inner"):$("body"),a=$('<div class="rcq-wrap" style="bottom:'+(this.footerHeight||0)+'px">').appendTo(a);this.rcq=new window.RCQ({app_id:this.app_id,base_url:this.base_url,element:a})}return this.rcq||!1}});
;
FTB.module("FTB.widget.selectable",{onSelect:function(a){var c=this;this.on("selected",function(b){a.call(this,b,c.selected)})},select:function(a,c){this.selected=a;this.trigger("selected",this.app.get_index(a),c)},deselect:function(){this.selected=null;this.trigger("deselected")},renderSelected:function(){this.$(".selected."+this.selectableClass).removeClass("selected");this.selected&&this.$("."+this.selectableClass+"[data-id="+this.selected+"]").addClass("selected")},onHover:function(a,c){var b=
this,d=b.app;b.selectableClass&&$.each({mouseenter:a,mouseleave:c},function(a,c){if(c)b.$el.on(a,"."+b.selectableClass,function(a){a=[a];var b=$(this).data("id");b&&a.push(b,d.data[d.get_index(b)]);c.apply(this,a)})})}});
;
FTB.module("FTB.widget.scrollable",{scroll:!1,initScroll:function(){this.scroll=this.isScrollable();this.minScrollHeight=this.minScrollHeight||this.getHeight();this.$scrollView=this.$("."+this.scrollViewClass)},isScrollable:function(){return this.isEmbedded||768<$w.width()},onScroll:function(){this.trigger("scrolled")},renderExpandMore:function(){var a=this,c=this.$scrollView,d=parseInt(c.height(),10),e=c[0].scrollHeight||d;this._originHeight=d;e>d?this.expand||(this.expand=$('<div class="scroll-expand clearfix"><div style="height:0"><div class="sx-shadow-bottom on"></div></div><div class="scroll-expand-btn scroll-show-more"><i class="i icon-angle-down"></i></div><div class="scroll-expand-btn scroll-show-less"><i class="i icon-angle-up"></i></div></div>'),
c.after(this.expand),this.expand.on("vclick",".scroll-expand-btn",function(b){cancelEvent(b);b=$(this).hasClass("scroll-show-more");!b&&a.$scrollView.offset().top<$(window).scrollTop()&&FTB.go_to(a.$scrollView,-100);b&&a.$scrollView.css("max-height","");a.$scrollView.css("height",b?"auto":a._originHeight);a.expand.toggleClass("expanded",b);EVT([window.get_gaq_page_type(),"Soft Joins",b?"click more":"click less",0,!1])})):(this.expand&&this.expand.hide().removeClass("expanded"),e<this.minScrollHeight&&
this.$scrollView.css("height",this.minScrollHeight))},scrollTop:function(a){a=a||0;this.$scrollView.animate({scrollTop:this.$scrollView.scrollTop()+a},300)},scrollResize:function(){var a=this.scroll=this.isScrollable();this.$scrollView.addClass("scrollbar-style scroll-light").toggleClass("no-scroll-y",!a);this.expand&&this.expand.showIf(!a);a||this.renderExpandMore();if(a)this.$scrollView.on("scroll.sw",_.throttle(_.bind(this.onScroll,this),200));else this.$scrollView.off("scroll.sw")}});
;
!function(){function pa(a){return!isNaN(a)}function bb(a){return a.length}function W(){}function M(a){return a&&(a.ownerDocument&&a.ownerDocument.defaultView||a.document&&a||a.defaultView)}function F(a,b){for(var c in b)Object.defineProperty(a.prototype,c,{value:b[c],enumerable:!1})}function X(){this._=Object.create(null)}function N(a){return(a+="")===Qe||a[0]===dc?dc+a:a}function Y(a){return(a+="")[0]===dc?a.slice(1):a}function g(a){return N(a)in this._}function ca(a){return(a=N(a))in this._&&delete this._[a]}
function S(){var a=[],b;for(b in this._)a.push(Y(b));return a}function t(){var a=0,b;for(b in this._)++a;return a}function v(){for(var a in this._)return!1;return!0}function r(){}function Q(a){function b(){for(var b,d=c,h=-1,l=d.length;++h<l;)(b=d[h].on)&&b.apply(this,arguments);return a}var c=[],d=new X;return b.on=function(b,f){var h,l=d.get(b);return 2>arguments.length?l&&l.on:(l&&(l.on=null,c=c.slice(0,h=c.indexOf(l)).concat(c.slice(h+1)),d.remove(b)),f&&c.push(d.set(b,{on:f})),a)},b}function z(){k.event.preventDefault()}
function E(){for(var a,b=k.event;a=b.sourceEvent;)b=a;return b}function G(a){for(var b=new r,c=0,d=arguments.length;++c<d;)b[arguments[c]]=Q(b);return b.of=function(c,d){return function(h){try{var l=h.sourceEvent=k.event;h.target=a;k.event=h;b[h.type].apply(c,d)}finally{k.event=l}}},b}function C(a,b){b.changedTouches&&(b=b.changedTouches[0]);var c=a.ownerSVGElement||a;if(c.createSVGPoint){var d=c.createSVGPoint();if(0>ec&&(c=M(a),c.scrollX||c.scrollY)){var c=k.select("body").append("svg").style({position:"absolute",
top:0,left:0,margin:0,padding:0,border:"none"},"important"),e=c[0][0].getScreenCTM();ec=!(e.f||e.e);c.remove()}return ec?(d.x=b.pageX,d.y=b.pageY):(d.x=b.clientX,d.y=b.clientY),d=d.matrixTransform(a.getScreenCTM().inverse()),[d.x,d.y]}d=a.getBoundingClientRect();return[b.clientX-d.left-a.clientLeft,b.clientY-d.top-a.clientTop]}function q(a,b){if(b in a)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(var c=0,d=cd.length;d>c;++c){var e=cd[c]+b;if(e in a)return e}}function P(){var a=H(),a=p()-a;
24<a?(isFinite(a)&&(clearTimeout(mb),mb=setTimeout(P,a)),nb=0):(nb=1,dd(P))}function H(){var a=Date.now();for(Da=ob;Da;)a>=Da.t&&(Da.f=Da.c(a-Da.t)),Da=Da.n;return a}function p(){for(var a,b=ob,c=1/0;b;)b.f?b=a?a.n=b.n:ob=b.n:(b.t<c&&(c=b.t),b=(a=b).n);return pb=a,c}function x(a){return a}function qa(a,b){return b-(a?Math.ceil(Math.log(a)/Math.LN10):1)}function Re(a){var b=a.decimal,c=a.thousands,d=a.grouping,e=a.currency,f=d&&c?function(a,b){for(var f=a.length,e=[],m=0,T=d[0],B=0;0<f&&0<T&&(B+T+
1>b&&(T=Math.max(1,b-B)),e.push(a.substring(f-=T,f+T)),!((B+=T+1)>b));)T=d[m=(m+1)%d.length];return e.reverse().join(c)}:x;return function(a){a=ed.exec(a);var c=a[1]||" ",d=a[2]||">",s=a[3]||"-",m=a[4]||"",T=a[5],B=+a[6],g=a[7],V=a[8],I=a[9],A=1,D="",y="",K=!1,p=!0;switch(V&&(V=+V.substring(1)),(T||"0"===c&&"="===d)&&(T=c="0",d="="),I){case "n":g=!0;I="g";break;case "%":A=100;y="%";I="f";break;case "p":A=100;y="%";I="r";break;case "b":case "o":case "x":case "X":"#"===m&&(D="0"+I.toLowerCase());case "c":p=
!1;case "d":K=!0;V=0;break;case "s":A=-1,I="r"}"$"===m&&(D=e[0],y=e[1]);"r"!=I||V||(I="g");null!=V&&("g"==I?V=Math.max(1,Math.min(21,V)):("e"==I||"f"==I)&&(V=Math.max(0,Math.min(20,V))));var I=Se.get(I)||Te,q=T&&g;return function(a){var e=y;if(K&&a%1)return"";var h=0>a||0===a&&0>1/a?(a=-a,"-"):"-"===s?"":s;0>A?(e=k.formatPrefix(a,V),a=e.scale(a),e=e.symbol+y):a*=A;a=I(a,V);var m,cb,ha=a.lastIndexOf(".");0>ha?(ha=p?a.lastIndexOf("e"):-1,0>ha?(m=a,cb=""):(m=a.substring(0,ha),cb=a.substring(ha))):(m=
a.substring(0,ha),cb=b+a.substring(ha+1));!T&&g&&(m=f(m,1/0));var ha=D.length+m.length+cb.length+(q?0:h.length),r=B>ha?Array(ha=B-ha+1).join(c):"";return q&&(m=f(r+m,r.length?B-cb.length:1/0)),h+=D,a=m+cb,("<"===d?h+a+r:">"===d?r+h+a:"^"===d?r.substring(0,ha>>=1)+h+a+r.substring(ha):h+(q?a:r+a))+e}}}function Te(a){return a+""}function Fa(){this._=new Date(1<arguments.length?Date.UTC.apply(this,arguments):arguments[0])}function Ta(a,b,c){function d(b){var c=a(b),d=f(c,1);return d-b>b-c?c:d}function e(c){return b(c=
a(new da(c-1)),1),c}function f(a,c){return b(a=new da(+a),c),a}function h(a,d,f){a=e(a);var l=[];if(1<f)for(;d>a;)c(a)%f||l.push(new Date(+a)),b(a,1);else for(;d>a;)l.push(new Date(+a)),b(a,1);return l}a.floor=a;a.round=d;a.ceil=e;a.offset=f;a.range=h;var l=a.utc=qb(a);return l.floor=l,l.round=qb(d),l.ceil=qb(e),l.offset=qb(f),l.range=function(a,b,c){try{da=Fa;var d=new Fa;return d._=a,h(d,b,c)}finally{da=Date}},a}function qb(a){return function(b,c){try{da=Fa;var d=new Fa;return d._=b,a(d,c)._}finally{da=
Date}}}function Ue(a){function b(a){function b(c){for(var f,e,l,h=[],w=-1,s=0;++w<d;)37===a.charCodeAt(w)&&(h.push(a.slice(s,w)),null!=(e=fd[f=a.charAt(++w)])&&(f=a.charAt(++w)),(l=p[f])&&(f=l(c,null==e?"e"===f?" ":"0":e)),h.push(f),s=w+1);return h.push(a.slice(s,w)),h.join("")}var d=a.length;return b.parse=function(b){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(c(d,a,b,0)!=b.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);b=null!=d.Z&&da!==Fa;var f=new (b?Fa:da);return"j"in d?f.setFullYear(d.y,
0,d.j):"w"in d&&("W"in d||"U"in d)?(f.setFullYear(d.y,0,1),f.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(f.getDay()+5)%7:d.w+7*d.U-(f.getDay()+6)%7)):f.setFullYear(d.y,d.m,d.d),f.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),b?f._:f},b.toString=function(){return a},b}function c(a,b,c,d){for(var f,e,l,h=0,w=b.length,s=c.length;w>h;){if(d>=s)return-1;if(f=b.charCodeAt(h++),37===f){if(l=b.charAt(h++),e=q[l in fd?b.charAt(h++):l],!e||0>(d=e(a,c,d)))return-1}else if(f!=c.charCodeAt(d++))return-1}return d}
var d=a.dateTime,e=a.date,f=a.time,h=a.periods,l=a.days,w=a.shortDays,s=a.months,m=a.shortMonths;b.utc=function(a){function c(a){try{da=Fa;var b=new da;return b._=a,d(b)}finally{da=Date}}var d=b(a);return c.parse=function(a){try{da=Fa;var b=d.parse(a);return b&&b._}finally{da=Date}},c.toString=d.toString,c};b.multi=b.utc.multi=Ve;var T=k.map(),B=rb(l),g=sb(l),V=rb(w),I=sb(w),A=rb(s),D=sb(s),y=rb(m),K=sb(m);h.forEach(function(a,b){T.set(a.toLowerCase(),b)});var p={a:function(a){return w[a.getDay()]},
A:function(a){return l[a.getDay()]},b:function(a){return m[a.getMonth()]},B:function(a){return s[a.getMonth()]},c:b(d),d:function(a,b){return ga(a.getDate(),b,2)},e:function(a,b){return ga(a.getDate(),b,2)},H:function(a,b){return ga(a.getHours(),b,2)},I:function(a,b){return ga(a.getHours()%12||12,b,2)},j:function(a,b){return ga(1+u.dayOfYear(a),b,3)},L:function(a,b){return ga(a.getMilliseconds(),b,3)},m:function(a,b){return ga(a.getMonth()+1,b,2)},M:function(a,b){return ga(a.getMinutes(),b,2)},p:function(a){return h[+(12<=
a.getHours())]},S:function(a,b){return ga(a.getSeconds(),b,2)},U:function(a,b){return ga(u.sundayOfYear(a),b,2)},w:function(a){return a.getDay()},W:function(a,b){return ga(u.mondayOfYear(a),b,2)},x:b(e),X:b(f),y:function(a,b){return ga(a.getFullYear()%100,b,2)},Y:function(a,b){return ga(a.getFullYear()%1E4,b,4)},Z:We,"%":function(){return"%"}},q={a:function(a,b,c){V.lastIndex=0;return(b=V.exec(b.slice(c)))?(a.w=I.get(b[0].toLowerCase()),c+b[0].length):-1},A:function(a,b,c){B.lastIndex=0;return(b=
B.exec(b.slice(c)))?(a.w=g.get(b[0].toLowerCase()),c+b[0].length):-1},b:function(a,b,c){y.lastIndex=0;return(b=y.exec(b.slice(c)))?(a.m=K.get(b[0].toLowerCase()),c+b[0].length):-1},B:function(a,b,c){A.lastIndex=0;return(b=A.exec(b.slice(c)))?(a.m=D.get(b[0].toLowerCase()),c+b[0].length):-1},c:function(a,b,d){return c(a,p.c.toString(),b,d)},d:gd,e:gd,H:hd,I:hd,j:Xe,L:Ye,m:Ze,M:$e,p:function(a,b,c){b=T.get(b.slice(c,c+=2).toLowerCase());return null==b?-1:(a.p=b,c)},S:af,U:bf,w:cf,W:df,x:function(a,
b,d){return c(a,p.x.toString(),b,d)},X:function(a,b,d){return c(a,p.X.toString(),b,d)},y:ef,Y:ff,Z:gf,"%":hf};return b}function ga(a,b,c){var d=0>a?"-":"";a=(d?-a:a)+"";var e=a.length;return d+(c>e?Array(c-e+1).join(b)+a:a)}function rb(a){return RegExp("^(?:"+a.map(k.requote).join("|")+")","i")}function sb(a){for(var b=new X,c=-1,d=a.length;++c<d;)b.set(a[c].toLowerCase(),c);return b}function cf(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+1)))?(a.w=+b[0],c+b[0].length):-1}function bf(a,b,c){Z.lastIndex=
0;return(b=Z.exec(b.slice(c)))?(a.U=+b[0],c+b[0].length):-1}function df(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c)))?(a.W=+b[0],c+b[0].length):-1}function ff(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+4)))?(a.y=+b[0],c+b[0].length):-1}function ef(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?(a.y=+b[0]+(68<+b[0]?1900:2E3),c+b[0].length):-1}function gf(a,b,c){return/^[+-]\d{4}$/.test(b=b.slice(c,c+5))?(a.Z=-b,c+5):-1}function Ze(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?
(a.m=b[0]-1,c+b[0].length):-1}function gd(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?(a.d=+b[0],c+b[0].length):-1}function Xe(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+3)))?(a.j=+b[0],c+b[0].length):-1}function hd(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?(a.H=+b[0],c+b[0].length):-1}function $e(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?(a.M=+b[0],c+b[0].length):-1}function af(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+2)))?(a.S=+b[0],c+b[0].length):
-1}function Ye(a,b,c){Z.lastIndex=0;return(b=Z.exec(b.slice(c,c+3)))?(a.L=+b[0],c+b[0].length):-1}function We(a){var b=a.getTimezoneOffset();a=0<b?"-":"+";var c=U(b)/60|0,b=U(b)%60;return a+ga(c,"0",2)+ga(b,"0",2)}function hf(a,b,c){id.lastIndex=0;return(a=id.exec(b.slice(c,c+1)))?c+a[0].length:-1}function Ve(a){for(var b=a.length,c=-1;++c<b;)a[c][0]=this(a[c][0]);return function(b){for(var c=0,f=a[c];!f[1](b);)f=a[++c];return f[0](b)}}function Ma(a){return 1<a?ia:-1>a?-ia:Math.asin(a)}function jd(a){return((a=
Math.exp(a))+1/a)/2}function jf(a,b,c){return function(){var d=c.apply(b,arguments);return d===b?a:d}}function db(){return!0}function fa(){}function tb(a){return[Math.atan2(a[1],a[0]),Ma(a[2])]}function ub(a,b){return U(a[0]-b[0])<L&&U(a[1]-b[1])<L}function kd(a,b,c,d,e){var f=[],h=[];if(a.forEach(function(a){if(!(0>=(b=a.length-1))){var b,c=a[0],d=a[b];if(ub(c,d)){e.lineStart();for(d=0;b>d;++d)e.point((c=a[d])[0],c[1]);return void e.lineEnd()}b=new vb(c,a,null,!0);c=new vb(c,null,b,!1);b.o=c;f.push(b);
h.push(c);b=new vb(d,a,null,!1);c=new vb(d,null,b,!0);b.o=c;f.push(b);h.push(c)}}),h.sort(b),ld(f),ld(h),f.length){a=0;b=c;for(c=h.length;c>a;++a)h[a].e=b=!b;for(var l,w=f[0];;){for(var s=w,m=!0;s.v;)if((s=s.n)===w)return;b=s.z;e.lineStart();do{if(s.v=s.o.v=!0,s.e){if(m)for(a=0,c=b.length;c>a;++a)e.point((l=b[a])[0],l[1]);else d(s.x,s.n.x,1,e);s=s.n}else{if(m)for(b=s.p.z,a=b.length-1;0<=a;--a)e.point((l=b[a])[0],l[1]);else d(s.x,s.p.x,-1,e);s=s.p}s=s.o;b=s.z;m=!m}while(!s.v);e.lineEnd()}}}function ld(a){if(b=
a.length){for(var b,c,d=0,e=a[0];++d<b;)e.n=c=a[d],c.p=e,e=c;e.n=c=a[0];c.p=e}}function vb(a,b,c,d){this.x=a;this.z=b;this.o=c;this.e=d;this.v=!1;this.n=this.p=null}function md(a,b,c,d){return function(e,f){function h(b,c){var d=e(b,c);a(b=d[0],c=d[1])&&f.point(b,c)}function l(a,b){var c=e(a,b);A.point(c[0],c[1])}function w(){y.point=l;A.lineStart()}function s(){y.point=h;A.lineEnd()}function m(a,b){I.push([a,b]);var c=e(a,b);p.point(c[0],c[1])}function T(){p.lineStart();I=[]}function B(){m(I[0][0],
I[0][1]);p.lineEnd();var a;a=p.clean();var b=K.buffer(),c=b.length;if(I.pop(),V.push(I),I=null,c)if(1&a){a=b[0];var d,c=a.length-1,b=-1;if(0<c){q||(f.polygonStart(),q=!0);for(f.lineStart();++b<c;)f.point((d=a[b])[0],d[1]);f.lineEnd()}}else 1<c&&2&a&&b.push(b.pop().concat(b.shift())),g.push(b.filter(kf))}var g,V,I,A=b(f),D=e.invert(d[0],d[1]),y={point:h,lineStart:w,lineEnd:s,polygonStart:function(){y.point=m;y.lineStart=T;y.lineEnd=B;g=[];V=[]},polygonEnd:function(){y.point=h;y.lineStart=w;y.lineEnd=
s;g=k.merge(g);var a,b=D;a=V;var d=b[0],e=b[1],l=[Math.sin(d),-Math.cos(d),0],m=0,B=0;Ua.reset();for(var T=0,K=a.length;K>T;++T){var I=a[T],A=I.length;if(A)for(var p=I[0],Ea=p[0],b=p[1]/2+J/4,r=Math.sin(b),x=Math.cos(b),H=1;;){H===A&&(H=0);var b=I[H],u=b[0],v=b[1]/2+J/4,t=Math.sin(v),v=Math.cos(v),C=u-Ea,z=0<=C?1:-1,P=z*C,G=P>J,r=r*t;if(Ua.add(Math.atan2(r*z*Math.sin(P),x*v+r*Math.cos(P))),m+=G?C+z*ra:C,G^Ea>=d^u>=d)p=eb(Va(p),Va(b)),wb(p),Ea=eb(l,p),wb(Ea),Ea=(G^0<=C?-1:1)*Ma(Ea[2]),(e>Ea||e===Ea&&
(p[0]||p[1]))&&(B+=G^0<=C?1:-1);if(!H++)break;Ea=u;r=t;x=v;p=b}}a=(-L>m||L>m&&0>Ua)^1&B;g.length?(q||(f.polygonStart(),q=!0),kd(g,lf,a,c,f)):a&&(q||(f.polygonStart(),q=!0),f.lineStart(),c(null,null,1,f),f.lineEnd());q&&(f.polygonEnd(),q=!1);g=V=null},sphere:function(){f.polygonStart();f.lineStart();c(null,null,1,f);f.lineEnd();f.polygonEnd()}},K=od(),p=b(K),q=!1;return y}}function kf(a){return 1<a.length}function od(){var a,b=[];return{lineStart:function(){b.push(a=[])},point:function(b,d){a.push([b,
d])},lineEnd:fa,buffer:function(){var c=b;return b=[],a=null,c},rejoin:function(){1<b.length&&b.push(b.pop().concat(b.shift()))}}}function lf(a,b){return(0>(a=a.x)[0]?a[1]-ia-L:ia-a[1])-(0>(b=b.x)[0]?b[1]-ia-L:ia-b[1])}function Va(a){var b=a[0];a=a[1];var c=Math.cos(a);return[c*Math.cos(b),c*Math.sin(b),Math.sin(a)]}function xb(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function eb(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function fc(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=
b[2]}function yb(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function wb(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=b;a[1]/=b;a[2]/=b}function pd(a,b){function c(c,e){return c=a(c,e),b(c[0],c[1])}return a.invert&&b.invert&&(c.invert=function(c,e){return c=b.invert(c,e),c&&a.invert(c[0],c[1])}),c}function zb(a,b){return[a,b]}function qd(a,b){return[a>J?a-ra:-J>a?a+ra:a,b]}function gc(a,b,c){return a?b||c?pd(rd(a),sd(b,c)):rd(a):b||c?sd(b,c):qd}function td(a){return function(b,c){return b+=a,[b>
J?b-ra:-J>b?b+ra:b,c]}}function rd(a){var b=td(a);return b.invert=td(-a),b}function sd(a,b){function c(a,b){var c=Math.cos(b),m=Math.cos(a)*c,c=Math.sin(a)*c,T=Math.sin(b),B=T*d+m*e;return[Math.atan2(c*f-B*h,m*d-T*e),Ma(B*f+c*h)]}var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),h=Math.sin(b);return c.invert=function(a,b){var c=Math.cos(b),m=Math.cos(a)*c,c=Math.sin(a)*c,T=Math.sin(b),B=T*f-c*h;return[Math.atan2(c*f+T*h,m*d+B*e),Ma(B*d-m*e)]},c}function hc(a,b){var c=Math.cos(a),d=Math.sin(a);return function(e,
f,h,l){var w=h*b;null!=e?(e=ud(c,e),f=ud(c,f),(0<h?f>e:e>f)&&(e+=h*ra)):(e=a+h*ra,f=a-0.5*w);for(var s;0<h?e>f:f>e;e-=w)l.point((s=tb([c,-d*Math.cos(e),-d*Math.sin(e)]))[0],s[1])}}function ud(a,b){var c=Va(b);c[0]-=a;wb(c);var d=1<-c[1]?0:-1>-c[1]?J:Math.acos(-c[1]);return((0>-c[2]?-d:d)+2*Math.PI-L)%(2*Math.PI)}function ic(){}function vd(a,b,c){var d=c.s=a+b,e=d-a;c.t=a-(d-e)+(b-e)}function Ab(a,b){a&&wd.hasOwnProperty(a.type)&&wd[a.type](a,b)}function jc(a,b,c){var d=-1,e=a.length-c;for(b.lineStart();++d<
e;)c=a[d],b.point(c[0],c[1],c[2]);b.lineEnd()}function xd(a,b){var c=-1,d=a.length;for(b.polygonStart();++c<d;)jc(a[c],b,1);b.polygonEnd()}function mf(){function a(a,b){a*=O;b=b*O/2+J/4;var c=a-d,s=0<=c?1:-1,m=s*c,c=Math.cos(b),T=Math.sin(b),B=f*T,k=e*c+B*Math.cos(m),s=B*s*Math.sin(m);Ua.add(Math.atan2(s,k));d=a;e=c;f=T}var b,c,d,e,f;na.point=function(h,l){na.point=a;d=(b=h)*O;e=Math.cos(l=(c=l)*O/2+J/4);f=Math.sin(l)};na.lineEnd=function(){a(b,c)}}function nf(a){function b(a,b){return Math.cos(a)*
Math.cos(b)>e}function c(a,b,c){var d=Va(a),f=Va(b),l=[1,0,0],f=eb(d,f),h=xb(f,f),d=f[0],k=h-d*d;if(!k)return!c&&a;h=e*h/k;k=-e*d/k;d=eb(l,f);l=yb(l,h);f=yb(f,k);fc(l,f);f=xb(l,d);h=xb(d,d);k=f*f-h*(xb(l,l)-1);if(!(0>k)){var g=Math.sqrt(k),k=yb(d,(-f-g)/h);if(fc(k,l),k=tb(k),!c)return k;var D;c=a[0];var y=b[0];a=a[1];b=b[1];c>y&&(D=c,c=y,y=D);var K=y-c,p=U(K-J)<L,q=p||L>K;if(!p&&a>b&&(D=a,a=b,b=D),q?p?0<a+b^k[1]<(U(k[0]-c)<L?a:b):a<=k[1]&&k[1]<=b:K>J^(c<=k[0]&&k[0]<=y))return D=yb(d,(-f+g)/h),fc(D,
l),[k,tb(D)]}}function d(b,c){var d=f?a:J-a,e=0;return-d>b?e|=1:b>d&&(e|=2),-d>c?e|=4:c>d&&(e|=8),e}var e=Math.cos(a),f=0<e,h=U(e)>L,l=hc(a,6*O);return md(b,function(a){var e,l,k,B,g;return{lineStart:function(){B=k=!1;g=1},point:function(p,I){var A,D=[p,I],y=b(p,I),K=f?y?0:d(p,I):y?d(p+(0>p?J:-J),I):0;if(!e&&(B=k=y)&&a.lineStart(),y!==k&&(A=c(e,D),(ub(e,A)||ub(D,A))&&(D[0]+=L,D[1]+=L,y=b(D[0],D[1]))),y!==k)g=0,y?(a.lineStart(),A=c(D,e),a.point(A[0],A[1])):(A=c(e,D),a.point(A[0],A[1]),a.lineEnd()),
e=A;else if(h&&e&&f^y){var q;K&l||!(q=c(D,e,!0))||(g=0,f?(a.lineStart(),a.point(q[0][0],q[0][1]),a.point(q[1][0],q[1][1]),a.lineEnd()):(a.point(q[1][0],q[1][1]),a.lineEnd(),a.lineStart(),a.point(q[0][0],q[0][1])))}!y||e&&ub(e,D)||a.point(D[0],D[1]);e=D;k=y;l=K},lineEnd:function(){k&&a.lineEnd();e=null},clean:function(){return g|(B&&k)<<1}}},l,f?[0,-a]:[-J,a-J])}function of(a,b,c,d){return function(e){var f,h=e.a,l=e.b,w=h.x,h=h.y,s=0,m=1,k=l.x-w,l=l.y-h;if(f=a-w,k||!(0<f)){if(f/=k,0>k){if(s>f)return;
m>f&&(m=f)}else if(0<k){if(f>m)return;f>s&&(s=f)}if(f=c-w,k||!(0>f)){if(f/=k,0>k){if(f>m)return;f>s&&(s=f)}else if(0<k){if(s>f)return;m>f&&(m=f)}if(f=b-h,l||!(0<f)){if(f/=l,0>l){if(s>f)return;m>f&&(m=f)}else if(0<l){if(f>m)return;f>s&&(s=f)}if(f=d-h,l||!(0>f)){if(f/=l,0>l){if(f>m)return;f>s&&(s=f)}else if(0<l){if(s>f)return;m>f&&(m=f)}return 0<s&&(e.a={x:w+s*k,y:h+s*l}),1>m&&(e.b={x:w+m*k,y:h+m*l}),e}}}}}}function yd(a,b,c,d){function e(d,f){return U(d[0]-a)<L?0<f?0:3:U(d[0]-c)<L?0<f?2:1:U(d[1]-b)<
L?0<f?1:0:0<f?3:2}function f(a,b){return h(a.x,b.x)}function h(a,b){var c=e(a,1),d=e(b,1);return c!==d?c-d:0===c?b[1]-a[1]:1===c?a[0]-b[0]:2===c?a[1]-b[1]:b[0]-a[0]}return function(l){function w(f,l,w,s){var m=0,k=0;if(null==f||(m=e(f,w))!==(k=e(l,w))||0>h(f,l)^0<w){do s.point(0===m||3===m?a:c,1<m?d:b);while((m=(m+w+4)%4)!==k)}else s.point(l[0],l[1])}function s(f,e){f>=a&&c>=f&&e>=b&&d>=e&&l.point(f,e)}function m(f,e){f=Math.max(-Bb,Math.min(Bb,f));e=Math.max(-Bb,Math.min(Bb,e));var h=f>=a&&c>=f&&
e>=b&&d>=e;if(B&&p.push([f,e]),q)V=f,I=e,A=h,q=!1,h&&(l.lineStart(),l.point(f,e));else if(h&&K)l.point(f,e);else{var w={a:{x:D,y:y},b:{x:f,y:e}};va(w)?(K||(l.lineStart(),l.point(w.a.x,w.a.y)),l.point(w.b.x,w.b.y),h||l.lineEnd(),r=!1):h&&(l.lineStart(),l.point(f,e),r=!1)}D=f;y=e;K=h}var g,B,p,V,I,A,D,y,K,q,r,ea=l,ba=od(),va=of(a,b,c,d),v={point:s,lineStart:function(){v.point=m;B&&B.push(p=[]);q=!0;K=!1;D=y=NaN},lineEnd:function(){g&&(m(V,I),A&&K&&ba.rejoin(),g.push(ba.buffer()));v.point=s;K&&l.lineEnd()},
polygonStart:function(){l=ba;g=[];B=[];r=!0},polygonEnd:function(){l=ea;g=k.merge(g);var b;b=[a,d];for(var c=0,e=B.length,h=b[1],s=0;e>s;++s)for(var m,K=1,y=B[s],D=y.length,A=y[0];D>K;++K)m=y[K],A[1]<=h?m[1]>h&&0<(m[0]-A[0])*(b[1]-A[1])-(m[1]-A[1])*(b[0]-A[0])&&++c:m[1]<=h&&0>(m[0]-A[0])*(b[1]-A[1])-(m[1]-A[1])*(b[0]-A[0])&&--c,A=m;b=0!==c;c=r&&b;e=g.length;(c||e)&&(l.polygonStart(),c&&(l.lineStart(),w(null,null,1,l),l.lineEnd()),e&&kd(g,f,b,w,l),l.polygonEnd());g=B=p=null}};return v}}function kc(a,
b){a*=O;var c=Math.cos(b*=O);ib(c*Math.cos(a),c*Math.sin(a),Math.sin(b))}function ib(a,b,c){++jb;Ga+=(a-Ga)/jb;Ha+=(b-Ha)/jb;Aa+=(c-Aa)/jb}function zd(){function a(a,f){a*=O;var h=Math.cos(f*=O),l=h*Math.cos(a),h=h*Math.sin(a),w=Math.sin(f),s=Math.atan2(Math.sqrt((s=c*w-d*h)*s+(s=d*l-b*w)*s+(s=b*h-c*l)*s),b*l+c*h+d*w);fb+=s;sa+=s*(b+(b=l));ta+=s*(c+(c=h));ja+=s*(d+(d=w));ib(b,c,d)}var b,c,d;wa.point=function(e,f){e*=O;var h=Math.cos(f*=O);b=h*Math.cos(e);c=h*Math.sin(e);d=Math.sin(f);wa.point=a;ib(b,
c,d)}}function Ad(){wa.point=kc}function pf(){function a(a,b){a*=O;var c=Math.cos(b*=O),s=c*Math.cos(a),c=c*Math.sin(a),m=Math.sin(b),k=e*m-f*c,g=f*s-d*m,p=d*c-e*s,V=Math.sqrt(k*k+g*g+p*p),I=d*s+e*c+f*m,A=V&&-(1<I?0:-1>I?J:Math.acos(I))/V,V=Math.atan2(V,I);Na+=A*k;Oa+=A*g;Ba+=A*p;fb+=V;sa+=V*(d+(d=s));ta+=V*(e+(e=c));ja+=V*(f+(f=m));ib(d,e,f)}var b,c,d,e,f;wa.point=function(h,l){b=h;c=l;wa.point=a;h*=O;var w=Math.cos(l*=O);d=w*Math.cos(h);e=w*Math.sin(h);f=Math.sin(l);ib(d,e,f)};wa.lineEnd=function(){a(b,
c);wa.lineEnd=Ad;wa.point=kc}}function qf(){function a(a,b){Cb+=e*a-d*b;d=a;e=b}var b,c,d,e;Pa.point=function(f,h){Pa.point=a;b=d=f;c=e=h};Pa.lineEnd=function(){a(b,c)}}function rf(){function a(a,b){h.push("M",a,",",b,f)}function b(a,b){h.push("M",a,",",b);l.point=c}function c(a,b){h.push("L",a,",",b)}function d(){l.point=a}function e(){h.push("Z")}var f=Bd(4.5),h=[],l={point:a,lineStart:function(){l.point=b},lineEnd:d,polygonStart:function(){l.lineEnd=e},polygonEnd:function(){l.lineEnd=d;l.point=
a},pointRadius:function(a){return f=Bd(a),l},result:function(){if(h.length){var a=h.join("");return h=[],a}}};return l}function Bd(a){return"m0,"+a+"a"+a+","+a+" 0 1,1 0,"+-2*a+"a"+a+","+a+" 0 1,1 0,"+2*a+"z"}function Wa(a,b){Ga+=a;Ha+=b;++Aa}function Cd(){function a(a,e){var f=a-b,h=e-c,f=Math.sqrt(f*f+h*h);sa+=f*(b+a)/2;ta+=f*(c+e)/2;ja+=f;Wa(b=a,c=e)}var b,c;xa.point=function(d,e){xa.point=a;Wa(b=d,c=e)}}function Dd(){xa.point=Wa}function sf(){function a(a,b){var c=a-d,w=b-e,c=Math.sqrt(c*c+w*
w);sa+=c*(d+a)/2;ta+=c*(e+b)/2;ja+=c;c=e*a-d*b;Na+=c*(d+a);Oa+=c*(e+b);Ba+=3*c;Wa(d=a,e=b)}var b,c,d,e;xa.point=function(f,h){xa.point=a;Wa(b=d=f,c=e=h)};xa.lineEnd=function(){a(b,c)}}function tf(a){function b(b,c){a.moveTo(b+h,c);a.arc(b,c,h,0,ra)}function c(b,c){a.moveTo(b,c);l.point=d}function d(b,c){a.lineTo(b,c)}function e(){l.point=b}function f(){a.closePath()}var h=4.5,l={point:b,lineStart:function(){l.point=c},lineEnd:e,polygonStart:function(){l.lineEnd=f},polygonEnd:function(){l.lineEnd=
e;l.point=b},pointRadius:function(a){return h=a,l},result:fa};return l}function Ed(a){function b(a){return(l?d:c)(a)}function c(b){return Fd(b,function(c,d){c=a(c,d);b.point(c[0],c[1])})}function d(b){function c(d,f){d=a(d,f);b.point(d[0],d[1])}function d(){ba=NaN;u.point=f;b.lineStart()}function f(c,d){var h=Va([c,d]),s=a(c,d);e(ba,va,ea,v,H,x,ba=s[0],va=s[1],ea=c,v=h[0],H=h[1],x=h[2],l,b);b.point(ba,va)}function h(){u.point=c;b.lineEnd()}function k(){d();u.point=g;u.lineEnd=p}function g(a,b){f(A=
a,b);D=ba;y=va;K=v;q=H;r=x;u.point=f}function p(){e(ba,va,ea,v,H,x,D,y,A,K,q,r,l,b);u.lineEnd=h;h()}var A,D,y,K,q,r,ea,ba,va,v,H,x,u={point:c,lineStart:d,lineEnd:h,polygonStart:function(){b.polygonStart();u.lineStart=k},polygonEnd:function(){b.polygonEnd();u.lineStart=d}};return u}function e(b,c,d,l,k,g,p,I,A,D,y,K,q,r){var ea=p-b,ba=I-c,va=ea*ea+ba*ba;if(va>4*f&&q--){var v=l+D,u=k+y,H=g+K,x=Math.sqrt(v*v+u*u+H*H),t=Math.asin(H/=x),C=U(U(H)-1)<L||U(d-A)<L?(d+A)/2:Math.atan2(u,v),z=a(C,t),t=z[0],z=
z[1],nd=t-b,P=z-c,G=ba*nd-ea*P;(G*G/va>f||0.3<U((ea*nd+ba*P)/va-0.5)||h>l*D+k*y+g*K)&&(e(b,c,d,l,k,g,t,z,C,v/=x,u/=x,H,q,r),r.point(t,z),e(t,z,C,v,u,H,p,I,A,D,y,K,q,r))}}var f=0.5,h=Math.cos(30*O),l=16;return b.precision=function(a){return arguments.length?(l=0<(f=a*a)&&16,b):Math.sqrt(f)},b}function uf(a){var b=Ed(function(b,d){return a([b*$,d*$])});return function(a){return Gd(b(a))}}function Hd(a){this.stream=a}function Fd(a,b){return{point:b,sphere:function(){a.sphere()},lineStart:function(){a.lineStart()},
lineEnd:function(){a.lineEnd()},polygonStart:function(){a.polygonStart()},polygonEnd:function(){a.polygonEnd()}}}function Db(a){return lc(function(){return a})()}function lc(a){function b(a){return a=l(a[0]*O,a[1]*O),[a[0]*B+w,s-a[1]*B]}function c(a){return a=l.invert((a[0]-w)/B,(s-a[1])/B),a&&[a[0]*$,a[1]*$]}function d(){l=pd(h=gc(D,y,K),f);var a=f(I,A);return w=p-a[0]*B,s=q+a[1]*B,e()}function e(){return m&&(m.valid=!1,m=null),b}var f,h,l,w,s,m,g=Ed(function(a,b){return a=f(a,b),[a[0]*B+w,s-a[1]*
B]}),B=150,p=480,q=250,I=0,A=0,D=0,y=0,K=0,r=Id,v=x,ea=null,ba=null;return b.stream=function(a){return m&&(m.valid=!1),m=Gd(r(h,g(v(a)))),m.valid=!0,m},b.clipAngle=function(a){return arguments.length?(r=null==a?(ea=a,Id):nf((ea=+a)*O),e()):ea},b.clipExtent=function(a){return arguments.length?(ba=a,v=a?yd(a[0][0],a[0][1],a[1][0],a[1][1]):x,e()):ba},b.scale=function(a){return arguments.length?(B=+a,d()):B},b.translate=function(a){return arguments.length?(p=+a[0],q=+a[1],d()):[p,q]},b.center=function(a){return arguments.length?
(I=a[0]%360*O,A=a[1]%360*O,d()):[I*$,A*$]},b.rotate=function(a){return arguments.length?(D=a[0]%360*O,y=a[1]%360*O,K=2<a.length?a[2]%360*O:0,d()):[D*$,y*$,K*$]},k.rebind(b,g,"precision"),function(){return f=a.apply(this,arguments),b.invert=f.invert&&c,d()}}function Gd(a){return Fd(a,function(b,c){a.point(b*O,c*O)})}function vf(a){var b=0,c=J/3,d=lc(a);a=d(b,c);return a.parallels=function(a){return arguments.length?d(b=a[0]*J/180,c=a[1]*J/180):[b/J*180,c/J*180]},a}function Jd(a,b){function c(a,b){var c=
Math.sqrt(f-2*e*Math.sin(b))/e;return[c*Math.sin(a*=e),h-c*Math.cos(a)]}var d=Math.sin(a),e=(d+Math.sin(b))/2,f=1+d*(2*e-d),h=Math.sqrt(f)/e;return c.invert=function(a,b){var c=h-b;return[Math.atan2(a,c)/e,Ma((f-(a*a+c*c)*e*e)/(2*e))]},c}function mc(a,b){return[a,Math.log(Math.tan(J/4+b/2))]}function wf(a){var b,c=Db(a),d=c.scale,e=c.translate,f=c.clipExtent;return c.scale=function(){var a=d.apply(c,arguments);return a===c?b?c.clipExtent(null):c:a},c.translate=function(){var a=e.apply(c,arguments);
return a===c?b?c.clipExtent(null):c:a},c.clipExtent=function(a){var l=f.apply(c,arguments);if(l===c){if(b=null==a){var w=J*d(),s=e();f([[s[0]-w,s[1]-w],[s[0]+w,s[1]+w]])}}else b&&(l=null);return l},c.clipExtent(null)}function Kd(a,b,c){var d=k.range(a,b-L,c).concat(b);return function(a){return d.map(function(b){return[a,b]})}}function Ld(a,b,c){var d=k.range(a,b-L,c).concat(b);return function(a){return d.map(function(b){return[b,a]})}}function Qa(a){return Eb(a,R),a}function nc(a){return"function"==
typeof a?a:function(){return oc(a,this)}}function Md(a){return"function"==typeof a?a:function(){return pc(a,this)}}function Nd(a,b){function c(){this.removeAttribute(a)}function d(){this.removeAttributeNS(a.space,a.local)}function e(){this.setAttribute(a,b)}function f(){this.setAttributeNS(a.space,a.local,b)}function h(){var c=b.apply(this,arguments);null==c?this.removeAttribute(a):this.setAttribute(a,c)}function l(){var c=b.apply(this,arguments);null==c?this.removeAttributeNS(a.space,a.local):this.setAttributeNS(a.space,
a.local,c)}return a=k.ns.qualify(a),null==b?a.local?d:c:"function"==typeof b?a.local?l:h:a.local?f:e}function Od(a){return a.trim().replace(/\s+/g," ")}function Pd(a){return RegExp("(?:^|\\s+)"+k.requote(a)+"(?:\\s+|$)","g")}function Qd(a,b){function c(){for(var c=-1;++c<e;)a[c](this,b)}function d(){for(var c=-1,d=b.apply(this,arguments);++c<e;)a[c](this,d)}a=(a+"").trim().split(/^|\s+/).map(xf);var e=a.length;return"function"==typeof b?d:c}function xf(a){var b=Pd(a);return function(c,d){if(e=c.classList)return d?
e.add(a):e.remove(a);var e=c.getAttribute("class")||"";d?(b.lastIndex=0,b.test(e)||c.setAttribute("class",Od(e+" "+a))):c.setAttribute("class",Od(e.replace(b," ")))}}function Rd(a,b,c){function d(){this.style.removeProperty(a)}function e(){this.style.setProperty(a,b,c)}function f(){var d=b.apply(this,arguments);null==d?this.style.removeProperty(a):this.style.setProperty(a,d,c)}return null==b?d:"function"==typeof b?f:e}function Sd(a,b){function c(){delete this[a]}function d(){this[a]=b}function e(){var c=
b.apply(this,arguments);null==c?delete this[a]:this[a]=c}return null==b?c:"function"==typeof b?e:d}function Td(a){function b(){var b=this.ownerDocument,c=this.namespaceURI;return c?b.createElementNS(c,a):b.createElement(a)}function c(){return this.ownerDocument.createElementNS(a.space,a.local)}return"function"==typeof a?a:(a=k.ns.qualify(a)).local?c:b}function yf(){var a=this.parentNode;a&&a.removeChild(this)}function Ud(){this._=Object.create(null)}function Vd(a){return function(){return qc(this,
a)}}function Fb(a,b){return b>a?-1:a>b?1:a>=b?0:NaN}function zf(a){return arguments.length||(a=Fb),function(b,c){return b&&c?a(b.__data__,c.__data__):!b-!c}}function Ia(a,b){for(var c=0,d=a.length;d>c;c++)for(var e,f=a[c],h=0,l=f.length;l>h;h++)(e=f[h])&&b(e,h,c);return a}function Wd(a){return Eb(a,Ja),a}function Af(a){var b,c;return function(d,e,f){d=a[f].update;var h=d.length;f!=c&&(c=f,b=0);for(e>=b&&(b=e+1);!(e=d[b])&&++b<h;);return e}}function Xd(a,b,c){function d(){var b=this[h];b&&(this.removeEventListener(a,
b,b.$),delete this[h])}function e(){var f=w(b,Xa(arguments));d.call(this);this.addEventListener(a,this[h]=f,f.$=c);f._=b}function f(){var b,c=RegExp("^__on([^.]+)"+k.requote(a)+"$"),d;for(d in this)if(b=d.match(c)){var f=this[d];this.removeEventListener(b[1],f,f.$);delete this[d]}}var h="__on"+a,l=a.indexOf("."),w=Yd;0<l&&(a=a.slice(0,l));var s=rc.get(a);return s&&(a=s,w=Bf),l?b?e:d:b?fa:f}function Yd(a,b){return function(c){var d=k.event;k.event=c;b[0]=this.__data__;try{a.apply(this,b)}finally{k.event=
d}}}function Bf(a,b){var c=Yd(a,b);return function(a){var b=a.relatedTarget;b&&(b===this||8&b.compareDocumentPosition(this))||c.call(this,a)}}function sc(a){var b=".dragsuppress-"+ ++Cf,c="click"+b,d=k.select(M(a)).on("touchmove"+b,z).on("dragstart"+b,z).on("selectstart"+b,z);if(null==Ya&&(Ya="onselectstart"in a?!1:q(a.style,"userSelect")),Ya){var e=(a&&(a.ownerDocument||a.document||a).documentElement).style,f=e[Ya];e[Ya]="none"}return function(a){if(d.on(b,null),Ya&&(e[Ya]=f),a){var l=function(){d.on(c,
null)};d.on(c,function(){z();l()},!0);setTimeout(l,0)}}}function Ca(a,b,c){return this instanceof Ca?(this.h=+a,this.s=+b,void(this.l=+c)):2>arguments.length?a instanceof Ca?new Ca(a.h,a.s,a.l):Zd(""+a,$d,Ca):new Ca(a,b,c)}function tc(a,b,c){function d(a){return 360<a?a-=360:0>a&&(a+=360),60>a?e+(f-e)*a/60:180>a?f:240>a?e+(f-e)*(240-a)/60:e}var e,f;return a=isNaN(a)?0:0>(a%=360)?a+360:a,b=isNaN(b)?0:0>b?0:1<b?1:b,c=0>c?0:1<c?1:c,f=0.5>=c?c*(1+b):c+b-c*b,e=2*c-f,new ka(Math.round(255*d(a+120)),Math.round(255*
d(a)),Math.round(255*d(a-120)))}function ya(a,b,c){return this instanceof ya?(this.h=+a,this.c=+b,void(this.l=+c)):2>arguments.length?a instanceof ya?new ya(a.h,a.c,a.l):a instanceof za?ae(a.l,a.a,a.b):ae((a=be((a=k.rgb(a)).r,a.g,a.b)).l,a.a,a.b):new ya(a,b,c)}function uc(a,b,c){return isNaN(a)&&(a=0),isNaN(b)&&(b=0),new za(c,Math.cos(a*=O)*b,Math.sin(a)*b)}function za(a,b,c){return this instanceof za?(this.l=+a,this.a=+b,void(this.b=+c)):2>arguments.length?a instanceof za?new za(a.l,a.a,a.b):a instanceof
ya?uc(a.h,a.c,a.l):be((a=ka(a)).r,a.g,a.b):new za(a,b,c)}function ce(a,b,c){a=(a+16)/116;b=a+b/500;c=a-c/200;return b=vc(b)*de,a=vc(a)*ee,c=vc(c)*fe,new ka(wc(3.2404542*b-1.5371385*a-0.4985314*c),wc(-0.969266*b+1.8760108*a+0.041556*c),wc(0.0556434*b-0.2040259*a+1.0572252*c))}function ae(a,b,c){return 0<a?new ya(Math.atan2(c,b)*$,Math.sqrt(b*b+c*c),a):new ya(NaN,NaN,a)}function vc(a){return 0.206893034<a?a*a*a:(a-4/29)/7.787037}function xc(a){return 0.008856<a?Math.pow(a,1/3):7.787037*a+4/29}function wc(a){return Math.round(255*
(0.00304>=a?12.92*a:1.055*Math.pow(a,1/2.4)-0.055))}function ka(a,b,c){return this instanceof ka?(this.r=~~a,this.g=~~b,void(this.b=~~c)):2>arguments.length?a instanceof ka?new ka(a.r,a.g,a.b):Zd(""+a,ka,tc):new ka(a,b,c)}function gb(a){return 16>a?"0"+Math.max(0,a).toString(16):Math.min(255,a).toString(16)}function Zd(a,b,c){var d,e,f,h=0,l=0,w=0;if(d=/([a-z]+)\((.*)\)/.exec(a=a.toLowerCase()))switch(e=d[2].split(","),d[1]){case "hsl":return c(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/
100);case "rgb":return b(yc(e[0]),yc(e[1]),yc(e[2]))}return(f=Gb.get(a))?b(f.r,f.g,f.b):(null==a||"#"!==a.charAt(0)||isNaN(f=parseInt(a.slice(1),16))||(4===a.length?(h=(3840&f)>>4,h|=h>>4,l=240&f,l|=l>>4,w=15&f,w|=w<<4):7===a.length&&(h=(16711680&f)>>16,l=(65280&f)>>8,w=255&f)),b(h,l,w))}function $d(a,b,c){var d,e,f=Math.min(a/=255,b/=255,c/=255),h=Math.max(a,b,c),l=h-f,w=(h+f)/2;return l?(e=0.5>w?l/(h+f):l/(2-h-f),d=a==h?(b-c)/l+(c>b?6:0):b==h?(c-a)/l+2:(a-b)/l+4,d*=60):(d=NaN,e=0<w&&1>w?0:d),new Ca(d,
e,w)}function be(a,b,c){a=zc(a);b=zc(b);c=zc(c);var d=xc((0.4124564*a+0.3575761*b+0.1804375*c)/de),e=xc((0.2126729*a+0.7151522*b+0.072175*c)/ee);a=xc((0.0193339*a+0.119192*b+0.9503041*c)/fe);return za(116*e-16,500*(d-e),200*(e-a))}function zc(a){return 0.04045>=(a/=255)?a/12.92:Math.pow((a+0.055)/1.055,2.4)}function yc(a){var b=parseFloat(a);return"%"===a.charAt(a.length-1)?Math.round(2.55*b):b}function Ac(a,b){a=k.rgb(a);b=k.rgb(b);var c=a.r,d=a.g,e=a.b,f=b.r-c,h=b.g-d,l=b.b-e;return function(a){return"#"+
gb(Math.round(c+f*a))+gb(Math.round(d+h*a))+gb(Math.round(e+l*a))}}function ge(a,b){var c,d={},e={};for(c in a)c in b?d[c]=Za(a[c],b[c]):e[c]=a[c];for(c in b)c in a||(e[c]=b[c]);return function(a){for(c in d)e[c]=d[c](a);return e}}function Ka(a,b){return a=+a,b=+b,function(c){return a*(1-c)+b*c}}function he(a,b){var c,d,e,f=Bc.lastIndex=Cc.lastIndex=0,h=-1,l=[],w=[];a+="";for(b+="";(c=Bc.exec(a))&&(d=Cc.exec(b));)(e=d.index)>f&&(e=b.slice(f,e),l[h]?l[h]+=e:l[++h]=e),(c=c[0])===(d=d[0])?l[h]?l[h]+=
d:l[++h]=d:(l[++h]=null,w.push({i:h,x:Ka(c,d)})),f=Cc.lastIndex;return f<b.length&&(e=b.slice(f),l[h]?l[h]+=e:l[++h]=e),2>l.length?w[0]?(b=w[0].x,function(a){return b(a)+""}):function(){return b}:(b=w.length,function(a){for(var c,d=0;b>d;++d)l[(c=w[d]).i]=c.x(a);return l.join("")})}function Za(a,b){for(var c,d=k.interpolators.length;0<=--d&&!(c=k.interpolators[d](a,b)););return c}function Hb(a,b){var c,d=[],e=[],f=a.length,h=b.length,l=Math.min(a.length,b.length);for(c=0;l>c;++c)d.push(Za(a[c],b[c]));
for(;f>c;++c)e[c]=a[c];for(;h>c;++c)e[c]=b[c];return function(a){for(c=0;l>c;++c)e[c]=d[c](a);return e}}function Df(a){return function(b){return 0>=b?0:1<=b?1:a(b)}}function ie(a){return function(b){return 1-a(1-b)}}function je(a){return function(b){return 0.5*(0.5>b?a(2*b):2-a(2-2*b))}}function Ef(a){return a*a}function Ff(a){return a*a*a}function Gf(a){if(0>=a)return 0;if(1<=a)return 1;var b=a*a,c=b*a;return 4*(0.5>a?c:3*(a-b)+c-0.75)}function Hf(a){return 1-Math.cos(a*ia)}function If(a){return Math.pow(2,
10*(a-1))}function Jf(a){return 1-Math.sqrt(1-a*a)}function Kf(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+0.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375}function ke(a,b){return b-=a,function(c){return Math.round(a+b*c)}}function le(a){var b=[a.a,a.b],c=[a.c,a.d],d=me(b),e=b[0]*c[0]+b[1]*c[1],f=me((c[0]+=-e*b[0],c[1]+=-e*b[1],c))||0;b[0]*c[1]<c[0]*b[1]&&(b[0]*=-1,b[1]*=-1,d*=-1,e*=-1);this.rotate=(d?Math.atan2(b[1],b[0]):Math.atan2(-c[0],c[1]))*
$;this.translate=[a.e,a.f];this.scale=[d,f];this.skew=f?Math.atan2(e,f)*$:0}function me(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return b&&(a[0]/=b,a[1]/=b),b}function ne(a,b){var c,d=[],e=[],f=k.transform(a),h=k.transform(b),l=f.translate,w=h.translate,s=f.rotate,m=h.rotate,g=f.skew,B=h.skew,f=f.scale,h=h.scale;return l[0]!=w[0]||l[1]!=w[1]?(d.push("translate(",null,",",null,")"),e.push({i:1,x:Ka(l[0],w[0])},{i:3,x:Ka(l[1],w[1])})):w[0]||w[1]?d.push("translate("+w+")"):d.push(""),s!=m?(180<s-m?m+=
360:180<m-s&&(s+=360),e.push({i:d.push(d.pop()+"rotate(",null,")")-2,x:Ka(s,m)})):m&&d.push(d.pop()+"rotate("+m+")"),g!=B?e.push({i:d.push(d.pop()+"skewX(",null,")")-2,x:Ka(g,B)}):B&&d.push(d.pop()+"skewX("+B+")"),f[0]!=h[0]||f[1]!=h[1]?(c=d.push(d.pop()+"scale(",null,",",null,")"),e.push({i:c-4,x:Ka(f[0],h[0])},{i:c-2,x:Ka(f[1],h[1])})):(1!=h[0]||1!=h[1])&&d.push(d.pop()+"scale("+h+")"),c=e.length,function(a){for(var b,f=-1;++f<c;)d[(b=e[f]).i]=b.x(a);return d.join("")}}function Lf(a,b){return b=
(b-=a=+a)||1/b,function(c){return(c-a)/b}}function Mf(a,b){return b=(b-=a=+a)||1/b,function(c){return Math.max(0,Math.min(1,(c-a)/b))}}function Nf(a){return a.x}function Of(a){return a.y}function Pf(a,b,c){a.y0=b;a.y=c}function Dc(a){return k.range(a.length)}function Ec(a){var b=-1;a=a[0].length;for(var c=[];++b<a;)c[b]=0;return c}function Qf(a){for(var b,c=1,d=0,e=a[0][1],f=a.length;f>c;++c)(b=a[c][1])>e&&(d=c,e=b);return d}function Rf(a){return a.reduce(Sf,0)}function Sf(a,b){return a+b[1]}function Tf(a,
b,c,d){var e=c(a[0],a[1]),f=d(b[0],b[1]);return function(a){return f(e(a))}}function Fc(a,b){var c,d=0,e=a.length-1,f=a[d],h=a[e];return f>h&&(c=d,d=e,e=c,c=f,f=h,h=c),a[d]=b.floor(f),a[e]=b.ceil(h),a}function oe(a){return a?{floor:function(b){return Math.floor(b/a)*a},ceil:function(b){return Math.ceil(b/a)*a}}:Uf}function pe(a){return{left:function(b,c,d,e){3>arguments.length&&(d=0);for(4>arguments.length&&(e=b.length);e>d;){var f=d+e>>>1;0>a(b[f],c)?d=f+1:e=f}return d},right:function(b,c,d,e){3>
arguments.length&&(d=0);for(4>arguments.length&&(e=b.length);e>d;){var f=d+e>>>1;0<a(b[f],c)?e=f:d=f+1}return d}}}function Vf(a,b,c,d){var e=[],f=[],h=0,l=Math.min(a.length,b.length)-1;for(a[l]<a[0]&&(a=a.slice().reverse(),b=b.slice().reverse());++h<=l;)e.push(c(a[h-1],a[h])),f.push(d(b[h-1],b[h]));return function(b){var c=k.bisect(a,b,1,l)-1;return f[c](e[c](b))}}function kb(a){var b=a[0];a=a[a.length-1];return a>b?[b,a]:[a,b]}function Ib(a){return a.rangeExtent?a.rangeExtent():kb(a.range())}function qe(a,
b,c,d){function e(){var e=2<Math.min(a.length,b.length)?Vf:Tf,s=d?Mf:Lf;return h=e(a,b,s,c),l=e(b,a,s,Za),f}function f(a){return h(a)}var h,l;return f.invert=function(a){return l(a)},f.domain=function(b){return arguments.length?(a=b.map(Number),e()):a},f.range=function(a){return arguments.length?(b=a,e()):b},f.rangeRound=function(a){return f.range(a).interpolate(ke)},f.clamp=function(a){return arguments.length?(d=a,e()):d},f.interpolate=function(a){return arguments.length?(c=a,e()):c},f.ticks=function(b){return k.range.apply(k,
Ra(a,b))},f.tickFormat=function(b,c){return Gc(a,b,c)},f.nice=function(b){return Fc(a,oe(Ra(a,b)[2])),e()},f.copy=function(){return qe(a,b,c,d)},e()}function re(a,b){return k.rebind(a,b,"range","rangeRound","interpolate","clamp")}function Ra(a,b){null==b&&(b=10);var c=kb(a),d=c[1]-c[0],e=Math.pow(10,Math.floor(Math.log(d/b)/Math.LN10)),d=b/d*e;return 0.15>=d?e*=10:0.35>=d?e*=5:0.75>=d&&(e*=2),c[0]=Math.ceil(c[0]/e)*e,c[1]=Math.floor(c[1]/e)*e+0.5*e,c[2]=e,c}function Gc(a,b,c){a=Ra(a,b);if(c){b=ed.exec(c);
if(b.shift(),"s"===b[8]){var d=k.formatPrefix(Math.max(U(a[0]),U(a[1])));return b[7]||(b[7]="."+Jb(d.scale(a[2]))),b[8]="f",c=k.format(b.join("")),function(a){return c(d.scale(a))+d.symbol}}b[7]||(b[7]="."+Wf(b[8],a));c=b.join("")}else c=",."+Jb(a[2])+"f";return k.format(c)}function Jb(a){return-Math.floor(Math.log(a)/Math.LN10+0.01)}function Wf(a,b){var c=Jb(b[2]);return a in Xf?Math.abs(c-Jb(Math.max(U(b[0]),U(b[1]))))+ +("e"!==a):c-2*("%"===a)}function se(a){function b(a){return+a}return b.invert=
b,b.domain=b.range=function(c){return arguments.length?(a=c.map(b),b):a},b.ticks=function(b){return k.range.apply(k,Ra(a,b))},b.tickFormat=function(b,d){return Gc(a,b,d)},b.copy=function(){return se(a)},b}function te(a,b){function c(c){return f[((e.get(c)||("range"===b.t?e.set(c,a.push(c)):NaN))-1)%f.length]}function d(b,c){return k.range(a.length).map(function(a){return b+c*a})}var e,f,h;return c.domain=function(d){if(!arguments.length)return a;a=[];e=new X;for(var f,h=-1,m=d.length;++h<m;)e.has(f=
d[h])||e.set(f,a.push(f));return c[b.t].apply(c,b.a)},c.range=function(a){return arguments.length?(f=a,h=0,b={t:"range",a:arguments},c):f},c.rangePoints=function(e,w){2>arguments.length&&(w=0);var s=e[0],m=e[1],m=2>a.length?(s=(s+m)/2,0):(m-s)/(a.length-1+w);return f=d(s+m*w/2,m),h=0,b={t:"rangePoints",a:arguments},c},c.rangeRoundPoints=function(e,w){2>arguments.length&&(w=0);var s=e[0],m=e[1],k=2>a.length?(s=m=Math.round((s+m)/2),0):(m-s)/(a.length-1+w)|0;return f=d(s+Math.round(k*w/2+(m-s-(a.length-
1+w)*k)/2),k),h=0,b={t:"rangeRoundPoints",a:arguments},c},c.rangeBands=function(e,w,s){2>arguments.length&&(w=0);3>arguments.length&&(s=w);var m=e[1]<e[0],k=e[m-0],g=(e[1-m]-k)/(a.length-w+2*s);return f=d(k+g*s,g),m&&f.reverse(),h=g*(1-w),b={t:"rangeBands",a:arguments},c},c.rangeRoundBands=function(e,w,s){2>arguments.length&&(w=0);3>arguments.length&&(s=w);var m=e[1]<e[0],k=e[m-0],g=e[1-m],p=Math.floor((g-k)/(a.length-w+2*s));return f=d(k+Math.round((g-k-(a.length-w)*p)/2),p),m&&f.reverse(),h=Math.round(p*
(1-w)),b={t:"rangeRoundBands",a:arguments},c},c.rangeBand=function(){return h},c.rangeExtent=function(){return kb(b.a[0])},c.copy=function(){return te(a,b)},c.domain(a)}function ue(a,b,c){function d(b){return a(e(b))}var e=Kb(b),f=Kb(1/b);return d.invert=function(b){return f(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain((c=b.map(Number)).map(e)),d):c},d.ticks=function(a){return k.range.apply(k,Ra(c,a))},d.tickFormat=function(a,b){return Gc(c,a,b)},d.nice=function(a){return d.domain(Fc(c,
oe(Ra(c,a)[2])))},d.exponent=function(h){return arguments.length?(e=Kb(b=h),f=Kb(1/b),a.domain(c.map(e)),d):b},d.copy=function(){return ue(a.copy(),b,c)},re(d,a)}function Kb(a){return function(b){return 0>b?-Math.pow(-b,a):Math.pow(b,a)}}function ve(a){return function(){var b,c;(b=this[a])&&(c=b[b.active])&&(--b.count?delete b[b.active]:delete this[a],b.active+=0.5,c.event&&c.event.interrupt.call(this,this.__data__,c.index))}}function lb(a,b,c){return Eb(a,aa),a.namespace=b,a.id=c,a}function Hc(a,
b,c,d){var e=a.id,f=a.namespace;return Ia(a,"function"==typeof c?function(a,l,w){a[f][e].tween.set(b,d(c.call(a,a.__data__,l,w)))}:(c=d(c),function(a){a[f][e].tween.set(b,c)}))}function Yf(a){return null==a&&(a=""),function(){this.textContent=a}}function Ic(a){return null==a?"__transition__":"__transition_"+a+"__"}function Lb(a,b,c,d,e){var f=a[c]||(a[c]={active:0,count:0}),h=f[d];if(!h){var l=e.time,h=f[d]={tween:new X,time:l,delay:e.delay,duration:e.duration,ease:e.ease,index:b};e=null;++f.count;
k.timer(function(e){function s(c){if(f.active>d)return g();var e=f[f.active];e&&(--f.count,delete f[f.active],e.event&&e.event.interrupt.call(a,a.__data__,e.index));f.active=d;h.event&&h.event.start.call(a,a.__data__,b);h.tween.forEach(function(c,d){(d=d.call(a,a.__data__,b))&&A.push(d)});p=h.ease;B=h.duration;k.timer(function(){return I.c=m(c||1)?db:m,1},0,l)}function m(c){if(f.active!==d)return 1;c/=B;for(var e=p(c),l=A.length;0<l;)A[--l].call(a,e);return 1<=c?(h.event&&h.event.end.call(a,a.__data__,
b),g()):void 0}function g(){return--f.count?delete f[d]:delete a[c],1}var B,p,q=h.delay,I=Da,A=[];return I.t=q+l,e>=q?s(e-q):void(I.c=s)},0,l)}}function Zf(a,b,c){a.attr("transform",function(a){var e=b(a);return"translate("+(isFinite(e)?e:c(a))+",0)"})}function $f(a,b,c){a.attr("transform",function(a){var e=b(a);return"translate(0,"+(isFinite(e)?e:c(a))+")"})}function la(a){return"function"==typeof a?a:function(){return a}}function Jc(a){return a[0]}function we(a){return a[1]}function ag(a){function b(b){function h(){k.push("M",
f(a(g),l))}for(var m,k=[],g=[],p=-1,q=b.length,I=la(c),A=la(d);++p<q;)e.call(this,m=b[p],p)?g.push([+I.call(this,m,p),+A.call(this,m,p)]):g.length&&(h(),g=[]);return g.length&&h(),k.length?k.join(""):null}var c=Jc,d=we,e=db,f=oa,h=f.key,l=0.7;return b.x=function(a){return arguments.length?(c=a,b):c},b.y=function(a){return arguments.length?(d=a,b):d},b.defined=function(a){return arguments.length?(e=a,b):e},b.interpolate=function(a){return arguments.length?(h="function"==typeof a?f=a:(f=Kc.get(a)||
oa).key,b):h},b.tension=function(a){return arguments.length?(l=a,b):l},b}function oa(a){return a.join("L")}function Lc(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("V",(d=a[b])[1],"H",d[0]);return e.join("")}function Mc(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d=a[b])[0],"V",d[1]);return e.join("")}function Mb(a,b){if(1>b.length||a.length!=b.length&&a.length!=b.length+2)return oa(a);var c=a.length!=b.length,d="",e=a[0],f=a[1],h=b[0],l=h,w=1;if(c&&(d+=
"Q"+(f[0]-2*h[0]/3)+","+(f[1]-2*h[1]/3)+","+f[0]+","+f[1],e=a[1],w=2),1<b.length)for(l=b[1],f=a[w],w++,d+="C"+(e[0]+h[0])+","+(e[1]+h[1])+","+(f[0]-l[0])+","+(f[1]-l[1])+","+f[0]+","+f[1],e=2;e<b.length;e++,w++)f=a[w],l=b[e],d+="S"+(f[0]-l[0])+","+(f[1]-l[1])+","+f[0]+","+f[1];c&&(c=a[w],d+="Q"+(f[0]+2*l[0]/3)+","+(f[1]+2*l[1]/3)+","+c[0]+","+c[1]);return d}function Nc(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],h=a[1],l=1,w=a.length;++l<w;)c=f,f=h,h=a[l],d.push([e*(h[0]-c[0]),e*(h[1]-c[1])]);return d}function xe(a){if(3>
a.length)return oa(a);var b=1,c=a.length,d=a[0],e=d[0],f=d[1],h=[e,e,e,(d=a[1])[0]],l=[f,f,f,d[1]],e=[e,",",f,"L",ua(Sa,h),",",ua(Sa,l)];for(a.push(a[c-1]);++b<=c;)d=a[b],h.shift(),h.push(d[0]),l.shift(),l.push(d[1]),Oc(e,h,l);return a.pop(),e.push("L",d),e.join("")}function ua(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function Oc(a,b,c){a.push("C",ua(ye,b),",",ua(ye,c),",",ua(ze,b),",",ua(ze,c),",",ua(Sa,b),",",ua(Sa,c))}function Pc(a,b){return(b[1]-a[1])/(b[0]-a[0])}function bg(){return 0}
function Qc(a,b,c){return(c[0]-b[0])*(a[1]-b[1])<(c[1]-b[1])*(a[0]-b[0])}function Rc(a,b,c,d){var e=a[0],f=c[0],h=b[0]-e,l=d[0]-f;a=a[1];c=c[1];b=b[1]-a;d=d[1]-c;f=(l*(a-c)-d*(e-f))/(d*h-l*b);return[e+f*h,a+f*b]}function Ae(a){var b=a[0];a=a[a.length-1];return!(b[0]-a[0]||b[1]-a[1])}function cg(a){return a.innerRadius}function dg(a){return a.outerRadius}function eg(a){return a.startAngle}function fg(a){return a.endAngle}function gg(a){return a&&a.padAngle}function Nb(a,b,c,d,e){var f=a[0]-b[0],h=
a[1]-b[1];e=(e?d:-d)/Math.sqrt(f*f+h*h);var h=e*h,f=-e*f,l=a[0]+h,w=a[1]+f,s=b[0]+h,m=b[1]+f;a=(l+s)/2;b=(w+m)/2;e=s-l;var k=m-w,g=e*e+k*k;d=c-d;var m=l*m-s*w,p=(0>k?-1:1)*Math.sqrt(d*d*g-m*m),l=(m*k-e*p)/g,w=(-m*e-k*p)/g,s=(m*k+e*p)/g;e=(-m*e+k*p)/g;k=l-a;g=w-b;a=s-a;b=e-b;return k*k+g*g>a*a+b*b&&(l=s,w=e),[[l-h,w-f],[l*c/d,w*c/d]]}function hg(a){function b(b){function w(){D.push("M",l(a(K),k),m,s(a(y.reverse()),k),"Z")}for(var g,p,A,D=[],y=[],K=[],q=-1,r=b.length,ea=la(c),v=la(e),u=c===d?function(){return p}:
la(d),H=e===f?function(){return A}:la(f);++q<r;)h.call(this,g=b[q],q)?(y.push([p=+ea.call(this,g,q),A=+v.call(this,g,q)]),K.push([+u.call(this,g,q),+H.call(this,g,q)])):y.length&&(w(),y=[],K=[]);return y.length&&w(),D.length?D.join(""):null}var c=Jc,d=Jc,e=0,f=we,h=db,l=oa,w=l.key,s=l,m="L",k=0.7;return b.x=function(a){return arguments.length?(c=d=a,b):d},b.x0=function(a){return arguments.length?(c=a,b):c},b.x1=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?
(e=f=a,b):f},b.y0=function(a){return arguments.length?(e=a,b):e},b.y1=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(h=a,b):h},b.interpolate=function(a){return arguments.length?(w="function"==typeof a?l=a:(l=Kc.get(a)||oa).key,s=l.reverse||l,m=l.closed?"M":"L",b):w},b.tension=function(a){return arguments.length?(k=a,b):k},b}function Sc(a){return a.toISOString()}function Tc(a,b,c){function d(b){return a(b)}function e(a,c){var d=(a[1]-a[0])/c,e=k.bisect(Ob,
d);return e==Ob.length?[b.year,Ra(a.map(function(a){return a/31536E6}),c)[2]]:e?b[d/Ob[e-1]<Ob[e]/d?e-1:e]:[ig,Ra(a,c)[2]]}return d.invert=function(b){return $a(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain(b),d):a.domain().map($a)},d.nice=function(a,b){function c(d){return!isNaN(d)&&!a.range(d,$a(+d+1),b).length}var k=d.domain(),s=kb(k),s=null==a?e(s,10):"number"==typeof a&&e(s,a);return s&&(a=s[0],b=s[1]),d.domain(Fc(k,1<b?{floor:function(b){for(;c(b=a.floor(b));)b=$a(b-1);
return b},ceil:function(b){for(;c(b=a.ceil(b));)b=$a(+b+1);return b}}:a))},d.ticks=function(a,b){var c=kb(d.domain()),k=null==a?e(c,10):"number"==typeof a?e(c,a):!a.range&&[{range:a},b];return k&&(a=k[0],b=k[1]),a.range(c[0],$a(+c[1]+1),1>b?1:b)},d.tickFormat=function(){return c},d.copy=function(){return Tc(a.copy(),b,c)},re(d,a)}function $a(a){return new Date(a)}var k={version:"3.5.6",extent:function(a,b){var c,d,e,f=-1,h=a.length;if(1===arguments.length){for(;++f<h;)if(null!=(d=a[f])&&d>=d){c=e=
d;break}for(;++f<h;)null!=(d=a[f])&&(c>d&&(c=d),d>e&&(e=d))}else{for(;++f<h;)if(null!=(d=b.call(a,a[f],f))&&d>=d){c=e=d;break}for(;++f<h;)null!=(d=b.call(a,a[f],f))&&(c>d&&(c=d),d>e&&(e=d))}return[c,e]},max:function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&d>c&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&d>c&&(c=d)}return c},min:function(a,b){var c,
d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&c>d&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&c>d&&(c=d)}return c},mean:function(a,b){var c,d=0,e=a.length,f=-1,h=e;if(1===arguments.length)for(;++f<e;)pa(c=null===a[f]?NaN:+a[f])?d+=c:--h;else for(;++f<e;){var l=b.call(a,a[f],f);pa(c=null===l?NaN:+l)?d+=c:--h}return h?d/h:void 0},merge:function(a){var b,c,d,e=a.length;
b=-1;for(var f=0;++b<e;)f+=a[b].length;for(c=Array(f);0<=--e;)for(d=a[e],b=d.length;0<=--b;)c[--f]=d[b];return c}},U=Math.abs;k.range=function(a,b,c){if(3>arguments.length&&(c=1,2>arguments.length&&(b=a,a=0)),(b-a)/c===1/0)throw Error("infinite range");var d,e=[],f;d=U(c);for(f=1;d*f%1;)f*=10;var h=-1;if(a*=f,b*=f,c*=f,0>c)for(;(d=a+c*++h)>b;)e.push(d/f);else for(;(d=a+c*++h)<b;)e.push(d/f);return e};k.sum=function(a,b){var c,d=0,e=a.length,f=-1;if(1===arguments.length)for(;++f<e;)pa(c=+a[f])&&(d+=
c);else for(;++f<e;)pa(c=+b.call(a,a[f],f))&&(d+=c);return d};k.values=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};k.zip=function(){if(!(d=arguments.length))return[];for(var a=-1,b=k.min(arguments,bb),c=Array(b);++a<b;)for(var d,e=-1,f=c[a]=Array(d);++e<d;)f[e]=arguments[e][a];return c};k.transpose=function(a){return k.zip.apply(k,a)};k.color=W;W.prototype.toString=function(){return this.rgb()+""};var Be=[].slice,Xa=function(a){return Be.call(a)},ma=this.document;if(ma)try{Xa(ma.documentElement.childNodes)[0].nodeType}catch(zg){Xa=
function(a){for(var b=a.length,c=Array(b);b--;)c[b]=a[b];return c}}if(Date.now||(Date.now=function(){return+new Date}),ma)try{ma.createElement("DIV").style.setProperty("opacity",0,"")}catch(Ag){var Pb=this.Element.prototype,jg=Pb.setAttribute,kg=Pb.setAttributeNS,Ce=this.CSSStyleDeclaration.prototype,lg=Ce.setProperty;Pb.setAttribute=function(a,b){jg.call(this,a,b+"")};Pb.setAttributeNS=function(a,b,c){kg.call(this,a,b,c+"")};Ce.setProperty=function(a,b,c){lg.call(this,a,b+"",c)}}k.map=function(a,
b){var c=new X;if(a instanceof X)a.forEach(function(a,b){c.set(a,b)});else if(Array.isArray(a)){var d,e=-1,f=a.length;if(1===arguments.length)for(;++e<f;)c.set(e,a[e]);else for(;++e<f;)c.set(b.call(a,d=a[e],e),d)}else for(e in a)c.set(e,a[e]);return c};var Qe="__proto__",dc="\x00";F(X,{has:g,get:function(a){return this._[N(a)]},set:function(a,b){return this._[N(a)]=b},remove:ca,keys:S,values:function(){var a=[],b;for(b in this._)a.push(this._[b]);return a},entries:function(){var a=[],b;for(b in this._)a.push({key:Y(b),
value:this._[b]});return a},size:t,empty:v,forEach:function(a){for(var b in this._)a.call(this,Y(b),this._[b])}});k.dispatch=function(){for(var a=new r,b=-1,c=arguments.length;++b<c;)a[arguments[b]]=Q(a);return a};r.prototype.on=function(a,b){var c=a.indexOf("."),d="";if(0<=c&&(d=a.slice(c+1),a=a.slice(0,c)),a)return 2>arguments.length?this[a].on(d):this[a].on(d,b);if(2===arguments.length){if(null==b)for(a in this)this.hasOwnProperty(a)&&this[a].on(d,null);return this}};k.event=null;k.mouse=function(a){return C(a,
E())};var ec=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;k.touch=function(a,b,c){if(3>arguments.length&&(c=b,b=E().changedTouches),b)for(var d,e=0,f=b.length;f>e;++e)if((d=b[e]).identifier===c)return C(a,d)};k.touches=function(a,b){return 2>arguments.length&&(b=E().touches),b?Xa(b).map(function(b){var d=C(a,b);return d.identifier=b.identifier,d}):[]};var ob,pb,nb,mb,Da,cd="webkit ms moz Moz o O".split(" "),dd=this[q(this,"requestAnimationFrame")]||function(a){setTimeout(a,17)};k.timer=
function(a,b,c){var d=arguments.length;2>d&&(b=0);3>d&&(c=Date.now());d={c:a,t:c+b,f:!1,n:null};pb?pb.n=d:ob=d;pb=d;nb||(mb=clearTimeout(mb),nb=1,dd(P))};k.timer.flush=function(){H();p()};k.round=function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)};var mg="y z a f p n \u00b5 m  k M G T P E Z Y".split(" ").map(function(a,b){var c=Math.pow(10,3*U(8-b));return{scale:8<b?function(a){return a/c}:function(a){return a*c},symbol:a}});k.formatPrefix=function(a,b){var c=0;return a&&(0>a&&
(a*=-1),b&&(a=k.round(a,qa(a,b))),c=1+Math.floor(1E-12+Math.log(a)/Math.LN10),c=Math.max(-24,Math.min(24,3*Math.floor((c-1)/3)))),mg[8+c/3]};var ed=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Se=k.map({b:function(a){return a.toString(2)},c:function(a){return String.fromCharCode(a)},o:function(a){return a.toString(8)},x:function(a){return a.toString(16)},X:function(a){return a.toString(16).toUpperCase()},g:function(a,b){return a.toPrecision(b)},e:function(a,b){return a.toExponential(b)},
f:function(a,b){return a.toFixed(b)},r:function(a,b){return(a=k.round(a,qa(a,b))).toFixed(Math.max(0,Math.min(20,qa(a*(1+1E-15),b))))}});k.requote=function(a){return a.replace(ng,"\\$&")};var ng=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,u=k.time={},da=Date;Fa.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},
getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){La.setUTCDate.apply(this._,arguments)},setDay:function(){La.setUTCDay.apply(this._,arguments)},setFullYear:function(){La.setUTCFullYear.apply(this._,arguments)},setHours:function(){La.setUTCHours.apply(this._,
arguments)},setMilliseconds:function(){La.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){La.setUTCMinutes.apply(this._,arguments)},setMonth:function(){La.setUTCMonth.apply(this._,arguments)},setSeconds:function(){La.setUTCSeconds.apply(this._,arguments)},setTime:function(){La.setTime.apply(this._,arguments)}};var La=Date.prototype;u.year=Ta(function(a){return a=u.day(a),a.setMonth(0,1),a},function(a,b){a.setFullYear(a.getFullYear()+b)},function(a){return a.getFullYear()});u.years=
u.year.range;u.years.utc=u.year.utc.range;u.day=Ta(function(a){var b=new da(2E3,0);return b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b},function(a,b){a.setDate(a.getDate()+b)},function(a){return a.getDate()-1});u.days=u.day.range;u.days.utc=u.day.utc.range;u.dayOfYear=function(a){var b=u.year(a);return Math.floor((a-b-6E4*(a.getTimezoneOffset()-b.getTimezoneOffset()))/864E5)};"sunday monday tuesday wednesday thursday friday saturday".split(" ").forEach(function(a,b){b=7-b;var c=u[a]=
Ta(function(a){return(a=u.day(a)).setDate(a.getDate()-(a.getDay()+b)%7),a},function(a,b){a.setDate(a.getDate()+7*Math.floor(b))},function(a){var c=u.year(a).getDay();return Math.floor((u.dayOfYear(a)+(c+b)%7)/7)-(c!==b)});u[a+"s"]=c.range;u[a+"s"].utc=c.utc.range;u[a+"OfYear"]=function(a){var c=u.year(a).getDay();return Math.floor((u.dayOfYear(a)+(c+b)%7)/7)}});u.week=u.sunday;u.weeks=u.sunday.range;u.weeks.utc=u.sunday.utc.range;u.weekOfYear=u.sundayOfYear;var fd={"-":"",_:" ",0:"0"},Z=/^\s*\d+/,
id=/^%/;k.locale=function(a){return{numberFormat:Re(a),timeFormat:Ue(a)}};var De=k.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),shortDays:"Sun Mon Tue Wed Thu Fri Sat".split(" "),months:"January February March April May June July August September October November December".split(" "),shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")});
k.format=De.numberFormat;var L=1E-6,Ee=L*L,J=Math.PI,ra=2*J,og=ra-L,ia=J/2,O=J/180,$=180/J;k.geo={};k.rebind=function(a,b){for(var c,d=1,e=arguments.length;++d<e;)a[c=arguments[d]]=jf(a,b,b[c]);return a};var Id=md(db,function(a){var b,c=NaN,d=NaN,e=NaN;return{lineStart:function(){a.lineStart();b=1},point:function(f,h){var l=0<f?J:-J,k=U(f-c);if(U(k-J)<L)a.point(c,d=0<(d+h)/2?ia:-ia),a.point(e,d),a.lineEnd(),a.lineStart(),a.point(l,d),a.point(f,d),b=0;else if(e!==l&&k>=J){U(c-e)<L&&(c-=e*L);U(f-l)<
L&&(f-=l*L);var k=c,s=d,m=f,g,p,q=Math.sin(k-m);d=U(q)>L?Math.atan((Math.sin(s)*(p=Math.cos(h))*Math.sin(m)-Math.sin(h)*(g=Math.cos(s))*Math.sin(k))/(g*p*q)):(s+h)/2;a.point(e,d);a.lineEnd();a.lineStart();a.point(l,d);b=0}a.point(c=f,d=h);e=l},lineEnd:function(){a.lineEnd();c=d=NaN},clean:function(){return 2-b}}},function(a,b,c,d){null==a?(c*=ia,d.point(-J,c),d.point(0,c),d.point(J,c),d.point(J,0),d.point(J,-c),d.point(0,-c),d.point(-J,-c),d.point(-J,0),d.point(-J,c)):U(a[0]-b[0])>L?(a=a[0]<b[0]?
J:-J,c=c*a/2,d.point(-a,c),d.point(0,c),d.point(a,c)):d.point(b[0],b[1])},[-J,-J/2]);(k.geo.equirectangular=function(){return Db(zb)}).raw=zb.invert=zb;k.geo.rotation=function(a){function b(b){return b=a(b[0]*O,b[1]*O),b[0]*=$,b[1]*=$,b}return a=gc(a[0]%360*O,a[1]*O,2<a.length?a[2]*O:0),b.invert=function(b){return b=a.invert(b[0]*O,b[1]*O),b[0]*=$,b[1]*=$,b},b};qd.invert=zb;k.geo.circle=function(){function a(){var a="function"==typeof d?d.apply(this,arguments):d,b=gc(-a[0]*O,-a[1]*O,0).invert,e=[];
return c(null,null,1,{point:function(a,c){e.push(a=b(a,c));a[0]*=$;a[1]*=$}}),{type:"Polygon",coordinates:[e]}}var b,c,d=[0,0],e=6;return a.origin=function(b){return arguments.length?(d=b,a):d},a.angle=function(d){return arguments.length?(c=hc((b=+d)*O,e*O),a):b},a.precision=function(d){return arguments.length?(c=hc(b*O,(e=+d)*O),a):e},a.angle(90)};ic.prototype={s:0,t:0,add:function(a){vd(a,this.t,Qb);vd(Qb.s,this.s,this);this.s?this.t+=Qb.t:this.s=Qb.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};
var Qb=new ic;k.geo.stream=function(a,b){a&&Fe.hasOwnProperty(a.type)?Fe[a.type](a,b):Ab(a,b)};var Fe={Feature:function(a,b){Ab(a.geometry,b)},FeatureCollection:function(a,b){for(var c=a.features,d=-1,e=c.length;++d<e;)Ab(c[d].geometry,b)}},wd={Sphere:function(a,b){b.sphere()},Point:function(a,b){a=a.coordinates;b.point(a[0],a[1],a[2])},MultiPoint:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)a=c[d],b.point(a[0],a[1],a[2])},LineString:function(a,b){jc(a.coordinates,b,0)},MultiLineString:function(a,
b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)jc(c[d],b,0)},Polygon:function(a,b){xd(a.coordinates,b)},MultiPolygon:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)xd(c[d],b)},GeometryCollection:function(a,b){for(var c=a.geometries,d=-1,e=c.length;++d<e;)Ab(c[d],b)}};k.geo.area=function(a){return hb=0,k.geo.stream(a,na),hb};var hb,Ua=new ic,na={sphere:function(){hb+=4*J},point:fa,lineStart:fa,lineEnd:fa,polygonStart:function(){Ua.reset();na.lineStart=mf},polygonEnd:function(){var a=
2*Ua;hb+=0>a?4*J+a:a;na.lineStart=na.lineEnd=na.point=fa}},Bb=1E9;k.geo.clipExtent=function(){var a,b,c,d,e,f,h={stream:function(a){return e&&(e.valid=!1),e=f(a),e.valid=!0,e},extent:function(l){return arguments.length?(f=yd(a=+l[0][0],b=+l[0][1],c=+l[1][0],d=+l[1][1]),e&&(e.valid=!1,e=null),h):[[a,b],[c,d]]}};return h.extent([[0,0],[960,500]])};k.geo.albersUsa=function(){function a(a){var f=a[0];a=a[1];return b=null,c(f,a),b||(d(f,a),b)||e(f,a),b}var b,c,d,e,f=k.geo.albers(),h=k.geo.conicEqualArea().rotate([154,
0]).center([-2,58.5]).parallels([55,65]),l=k.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),w={point:function(a,c){b=[a,c]}};return a.invert=function(a){var b=f.scale(),c=f.translate(),d=(a[0]-c[0])/b,b=(a[1]-c[1])/b;return(0.12<=b&&0.234>b&&-0.425<=d&&-0.214>d?h:0.166<=b&&0.234>b&&-0.214<=d&&-0.115>d?l:f).invert(a)},a.stream=function(a){var b=f.stream(a),c=h.stream(a),d=l.stream(a);return{point:function(a,e){b.point(a,e);c.point(a,e);d.point(a,e)},sphere:function(){b.sphere();
c.sphere();d.sphere()},lineStart:function(){b.lineStart();c.lineStart();d.lineStart()},lineEnd:function(){b.lineEnd();c.lineEnd();d.lineEnd()},polygonStart:function(){b.polygonStart();c.polygonStart();d.polygonStart()},polygonEnd:function(){b.polygonEnd();c.polygonEnd();d.polygonEnd()}}},a.precision=function(b){return arguments.length?(f.precision(b),h.precision(b),l.precision(b),a):f.precision()},a.scale=function(b){return arguments.length?(f.scale(b),h.scale(0.35*b),l.scale(b),a.translate(f.translate())):
f.scale()},a.translate=function(b){if(!arguments.length)return f.translate();var k=f.scale(),g=+b[0],p=+b[1];return c=f.translate(b).clipExtent([[g-0.455*k,p-0.238*k],[g+0.455*k,p+0.238*k]]).stream(w).point,d=h.translate([g-0.307*k,p+0.201*k]).clipExtent([[g-0.425*k+L,p+0.12*k+L],[g-0.214*k-L,p+0.234*k-L]]).stream(w).point,e=l.translate([g-0.205*k,p+0.212*k]).clipExtent([[g-0.214*k+L,p+0.166*k+L],[g-0.115*k-L,p+0.234*k-L]]).stream(w).point,a},a.scale(1070)};k.geo.bounds=function(){function a(a,b){K.push(v=
[m=a,B=a]);p>b&&(p=b);b>q&&(q=b)}function b(b,c){var d=Va([b*O,c*O]);if(D){var e=eb(D,d),e=eb([e[1],-e[0],0],e);wb(e);var e=tb(e),f=b-r,h=0<f?1:-1,k=e[0]*$*h,f=180<U(f);f^(k>h*r&&h*b>k)?(e=e[1]*$,e>q&&(q=e)):(k=(k+360)%360-180,f^(k>h*r&&h*b>k))?(e=-e[1]*$,p>e&&(p=e)):(p>c&&(p=c),c>q&&(q=c));f?r>b?l(m,b)>l(m,B)&&(B=b):l(b,B)>l(m,B)&&(m=b):B>=m?(m>b&&(m=b),b>B&&(B=b)):b>r?l(m,b)>l(m,B)&&(B=b):l(b,B)>l(m,B)&&(m=b)}else a(b,c);D=d;r=b}function c(){u.point=b}function d(){v[0]=m;v[1]=B;u.point=a;D=null}
function e(a,c){if(D){var d=a-r;y+=180<U(d)?d+(0<d?360:-360):d}else I=a,A=c;na.point(a,c);b(a,c)}function f(){na.lineStart()}function h(){e(I,A);na.lineEnd();U(y)>L&&(m=-(B=180));v[0]=m;v[1]=B;D=null}function l(a,b){return 0>(b-=a)?b+360:b}function g(a,b){return a[0]-b[0]}function s(a,b){return b[0]<=b[1]?b[0]<=a&&a<=b[1]:a<b[0]||b[1]<a}var m,p,B,q,r,I,A,D,y,K,v,u={point:a,lineStart:c,lineEnd:d,polygonStart:function(){u.point=e;u.lineStart=f;u.lineEnd=h;y=0;na.polygonStart()},polygonEnd:function(){na.polygonEnd();
u.point=a;u.lineStart=c;u.lineEnd=d;0>Ua?(m=-(B=180),p=-(q=90)):y>L?q=90:-L>y&&(p=-90);v[0]=m;v[1]=B}};return function(a){q=B=-(m=p=1/0);K=[];k.geo.stream(a,u);if(a=K.length){K.sort(g);for(var b,c=1,d=K[0],e=[d];a>c;++c)b=K[c],s(b[0],d)||s(b[1],d)?(l(d[0],b[1])>l(d[0],d[1])&&(d[1]=b[1]),l(b[0],d[1])>l(d[0],d[1])&&(d[0]=b[0])):e.push(d=b);var f,h=-(1/0);a=e.length-1;c=0;for(d=e[a];a>=c;d=b,++c)b=e[c],(f=l(d[1],b[0]))>h&&(h=f,m=b[0],B=d[1])}return K=v=null,m===1/0||p===1/0?[[NaN,NaN],[NaN,NaN]]:[[m,
p],[B,q]]}}();k.geo.centroid=function(a){jb=fb=Ga=Ha=Aa=sa=ta=ja=Na=Oa=Ba=0;k.geo.stream(a,wa);a=Na;var b=Oa,c=Ba,d=a*a+b*b+c*c;return Ee>d&&(a=sa,b=ta,c=ja,L>fb&&(a=Ga,b=Ha,c=Aa),d=a*a+b*b+c*c,Ee>d)?[NaN,NaN]:[Math.atan2(b,a)*$,Ma(c/Math.sqrt(d))*$]};var jb,fb,Ga,Ha,Aa,sa,ta,ja,Na,Oa,Ba,Rb,Cb,Sb,Tb,Ub,Vb,wa={sphere:fa,point:kc,lineStart:zd,lineEnd:Ad,polygonStart:function(){wa.lineStart=pf},polygonEnd:function(){wa.lineStart=zd}},Pa={point:fa,lineStart:fa,lineEnd:fa,polygonStart:function(){Cb=0;
Pa.lineStart=qf},polygonEnd:function(){Pa.lineStart=Pa.lineEnd=Pa.point=fa;Rb+=U(Cb/2)}},pg={point:function(a,b){Sb>a&&(Sb=a);a>Ub&&(Ub=a);Tb>b&&(Tb=b);b>Vb&&(Vb=b)},lineStart:fa,lineEnd:fa,polygonStart:fa,polygonEnd:fa},xa={point:Wa,lineStart:Cd,lineEnd:Dd,polygonStart:function(){xa.lineStart=sf},polygonEnd:function(){xa.point=Wa;xa.lineStart=Cd;xa.lineEnd=Dd}};k.geo.path=function(){function a(a){return a&&("function"==typeof h&&e.pointRadius(+h.apply(this,arguments)),f&&f.valid||(f=d(e)),k.geo.stream(a,
f)),e.result()}var b,c,d,e,f,h=4.5;return a.area=function(a){return Rb=0,k.geo.stream(a,d(Pa)),Rb},a.centroid=function(a){return Ga=Ha=Aa=sa=ta=ja=Na=Oa=Ba=0,k.geo.stream(a,d(xa)),Ba?[Na/Ba,Oa/Ba]:ja?[sa/ja,ta/ja]:Aa?[Ga/Aa,Ha/Aa]:[NaN,NaN]},a.bounds=function(a){return Ub=Vb=-(Sb=Tb=1/0),k.geo.stream(a,d(pg)),[[Sb,Tb],[Ub,Vb]]},a.projection=function(c){return arguments.length?(d=(b=c)?c.stream||uf(c):x,f=null,a):b},a.context=function(b){return arguments.length?(e=null==(c=b)?new rf:new tf(b),"function"!=
typeof h&&e.pointRadius(h),f=null,a):c},a.pointRadius=function(b){return arguments.length?(h="function"==typeof b?b:(e.pointRadius(+b),+b),a):h},a.projection(k.geo.albersUsa()).context(null)};k.geo.transform=function(a){return{stream:function(b){b=new Hd(b);for(var c in a)b[c]=a[c];return b}}};Hd.prototype={point:function(a,b){this.stream.point(a,b)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},
polygonEnd:function(){this.stream.polygonEnd()}};k.geo.projection=Db;k.geo.projectionMutator=lc;(k.geo.conicEqualArea=function(){return vf(Jd)}).raw=Jd;k.geo.albers=function(){return k.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)};mc.invert=function(a,b){return[a,2*Math.atan(Math.exp(b))-ia]};(k.geo.mercator=function(){return wf(mc)}).raw=mc;var Ge=function(a,b){function c(b,c){var f=Math.cos(b),h=Math.cos(c),f=a(f*h);return[f*h*Math.sin(b),f*Math.sin(c)]}
return c.invert=function(a,c){var f=Math.sqrt(a*a+c*c),h=b(f),l=Math.sin(h),h=Math.cos(h);return[Math.atan2(a*l,f*h),Math.asin(f&&c*l/f)]},c}(function(){return 1},Math.asin);(k.geo.orthographic=function(){return Db(Ge)}).raw=Ge;k.geo.graticule=function(){function a(){return{type:"MultiLineString",coordinates:b()}}function b(){return k.range(Math.ceil(f/A)*A,e,A).map(B).concat(k.range(Math.ceil(s/D)*D,g,D).map(q)).concat(k.range(Math.ceil(d/r)*r,c,r).filter(function(a){return U(a%A)>L}).map(m)).concat(k.range(Math.ceil(l/
I)*I,h,I).filter(function(a){return U(a%D)>L}).map(p))}var c,d,e,f,h,l,g,s,m,p,B,q,r=10,I=r,A=90,D=360,y=2.5;return a.lines=function(){return b().map(function(a){return{type:"LineString",coordinates:a}})},a.outline=function(){return{type:"Polygon",coordinates:[B(f).concat(q(g).slice(1),B(e).reverse().slice(1),q(s).reverse().slice(1))]}},a.extent=function(b){return arguments.length?a.majorExtent(b).minorExtent(b):a.minorExtent()},a.majorExtent=function(b){return arguments.length?(f=+b[0][0],e=+b[1][0],
s=+b[0][1],g=+b[1][1],f>e&&(b=f,f=e,e=b),s>g&&(b=s,s=g,g=b),a.precision(y)):[[f,s],[e,g]]},a.minorExtent=function(b){return arguments.length?(d=+b[0][0],c=+b[1][0],l=+b[0][1],h=+b[1][1],d>c&&(b=d,d=c,c=b),l>h&&(b=l,l=h,h=b),a.precision(y)):[[d,l],[c,h]]},a.step=function(b){return arguments.length?a.majorStep(b).minorStep(b):a.minorStep()},a.majorStep=function(b){return arguments.length?(A=+b[0],D=+b[1],a):[A,D]},a.minorStep=function(b){return arguments.length?(r=+b[0],I=+b[1],a):[r,I]},a.precision=
function(b){return arguments.length?(y=+b,m=Kd(l,h,90),p=Ld(d,c,y),B=Kd(s,g,90),q=Ld(f,e,y),a):y},a.majorExtent([[-180,-90+L],[180,90-L]]).minorExtent([[-180,-80-L],[180,80+L]])};var Eb={}.__proto__?function(a,b){a.__proto__=b}:function(a,b){for(var c in b)a[c]=b[c]},oc=function(a,b){return b.querySelector(a)},pc=function(a,b){return b.querySelectorAll(a)},qc=function(a,b){var c=a.matches||a[q(a,"matchesSelector")];return(qc=function(a,b){return c.call(a,b)})(a,b)};"function"==typeof Sizzle&&(oc=
function(a,b){return Sizzle(a,b)[0]||null},pc=Sizzle,qc=Sizzle.matchesSelector);k.selection=function(){return k.select(ma.documentElement)};var R=k.selection.prototype=[];R.select=function(a){var b,c,d,e,f=[];a=nc(a);for(var h=-1,l=this.length;++h<l;){f.push(b=[]);b.parentNode=(d=this[h]).parentNode;for(var k=-1,s=d.length;++k<s;)(e=d[k])?(b.push(c=a.call(e,e.__data__,k,h)),c&&"__data__"in e&&(c.__data__=e.__data__)):b.push(null)}return Qa(f)};R.selectAll=function(a){var b,c,d=[];a=Md(a);for(var e=
-1,f=this.length;++e<f;)for(var h=this[e],l=-1,k=h.length;++l<k;)(c=h[l])&&(d.push(b=Xa(a.call(c,c.__data__,l,e))),b.parentNode=c);return Qa(d)};var Uc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};k.ns={prefix:Uc,qualify:function(a){var b=a.indexOf(":"),c=a;return 0<=b&&(c=a.slice(0,b),a=a.slice(b+1)),Uc.hasOwnProperty(c)?{space:Uc[c],local:a}:a}};R.attr=
function(a,b){if(2>arguments.length){if("string"==typeof a){var c=this.node();return a=k.ns.qualify(a),a.local?c.getAttributeNS(a.space,a.local):c.getAttribute(a)}for(b in a)this.each(Nd(b,a[b]));return this}return this.each(Nd(a,b))};R.classed=function(a,b){if(2>arguments.length){if("string"==typeof a){var c=this.node(),d=(a=(a+"").trim().split(/^|\s+/)).length,e=-1;if(b=c.classList)for(;++e<d;){if(!b.contains(a[e]))return!1}else for(b=c.getAttribute("class");++e<d;)if(!Pd(a[e]).test(b))return!1;
return!0}for(b in a)this.each(Qd(b,a[b]));return this}return this.each(Qd(a,b))};R.style=function(a,b,c){var d=arguments.length;if(3>d){if("string"!=typeof a){2>d&&(b="");for(c in a)this.each(Rd(c,a[c],b));return this}if(2>d)return d=this.node(),M(d).getComputedStyle(d,null).getPropertyValue(a);c=""}return this.each(Rd(a,b,c))};R.property=function(a,b){if(2>arguments.length){if("string"==typeof a)return this.node()[a];for(b in a)this.each(Sd(b,a[b]));return this}return this.each(Sd(a,b))};R.text=
function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.textContent=null==b?"":b}:null==a?function(){this.textContent=""}:function(){this.textContent=a}):this.node().textContent};R.html=function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.innerHTML=null==b?"":b}:null==a?function(){this.innerHTML=""}:function(){this.innerHTML=a}):this.node().innerHTML};R.append=function(a){return a=
Td(a),this.select(function(){return this.appendChild(a.apply(this,arguments))})};R.insert=function(a,b){return a=Td(a),b=nc(b),this.select(function(){return this.insertBefore(a.apply(this,arguments),b.apply(this,arguments)||null)})};R.remove=function(){return this.each(yf)};k.set=function(a){var b=new Ud;if(a)for(var c=0,d=a.length;d>c;++c)b.add(a[c]);return b};F(Ud,{has:g,add:function(a){return this._[N(a+="")]=!0,a},remove:ca,values:S,size:t,empty:v,forEach:function(a){for(var b in this._)a.call(this,
Y(b))}});R.data=function(a,b){function c(a,c){var d,e,f,h=a.length,g=c.length,p=Math.min(h,g),q=Array(g),r=Array(g),v=Array(h);if(b){var u,p=new X,H=Array(h);for(d=-1;++d<h;)p.has(u=b.call(e=a[d],e.__data__,d))?v[d]=e:p.set(u,e),H[d]=u;for(d=-1;++d<g;)(e=p.get(u=b.call(c,f=c[d],d)))?!0!==e&&(q[d]=e,e.__data__=f):r[d]={__data__:f},p.set(u,!0);for(d=-1;++d<h;)!0!==p.get(H[d])&&(v[d]=a[d])}else{for(d=-1;++d<p;)e=a[d],f=c[d],e?(e.__data__=f,q[d]=e):r[d]={__data__:f};for(;g>d;++d)r[d]={__data__:c[d]};
for(;h>d;++d)v[d]=a[d]}r.update=q;r.parentNode=q.parentNode=v.parentNode=a.parentNode;l.push(r);k.push(q);s.push(v)}var d,e,f=-1,h=this.length;if(!arguments.length){for(a=Array(h=(d=this[0]).length);++f<h;)(e=d[f])&&(a[f]=e.__data__);return a}var l=Wd([]),k=Qa([]),s=Qa([]);if("function"==typeof a)for(;++f<h;)c(d=this[f],a.call(d,d.parentNode.__data__,f));else for(;++f<h;)c(d=this[f],a);return k.enter=function(){return l},k.exit=function(){return s},k};R.datum=function(a){return arguments.length?this.property("__data__",
a):this.property("__data__")};R.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Vd(a));for(var f=0,h=this.length;h>f;f++){e.push(b=[]);b.parentNode=(c=this[f]).parentNode;for(var l=0,k=c.length;k>l;l++)(d=c[l])&&a.call(d,d.__data__,l,f)&&b.push(d)}return Qa(e)};R.order=function(){for(var a=-1,b=this.length;++a<b;)for(var c,d=this[a],e=d.length-1,f=d[e];0<=--e;)(c=d[e])&&(f&&f!==c.nextSibling&&f.parentNode.insertBefore(c,f),f=c);return this};k.ascending=Fb;R.sort=function(a){a=zf.apply(this,
arguments);for(var b=-1,c=this.length;++b<c;)this[b].sort(a);return this.order()};R.each=function(a){return Ia(this,function(b,c,d){a.call(b,b.__data__,c,d)})};R.call=function(a){var b=Xa(arguments);return a.apply(b[0]=this,b),this};R.empty=function(){return!this.node()};R.node=function(){for(var a=0,b=this.length;b>a;a++)for(var c=this[a],d=0,e=c.length;e>d;d++){var f=c[d];if(f)return f}return null};R.size=function(){var a=0;return Ia(this,function(){++a}),a};var Ja=[];k.selection.enter=Wd;k.selection.enter.prototype=
Ja;Ja.append=R.append;Ja.empty=R.empty;Ja.node=R.node;Ja.call=R.call;Ja.size=R.size;Ja.select=function(a){for(var b,c,d,e,f,h=[],l=-1,k=this.length;++l<k;){d=(e=this[l]).update;h.push(b=[]);b.parentNode=e.parentNode;for(var g=-1,m=e.length;++g<m;)(f=e[g])?(b.push(d[g]=c=a.call(e.parentNode,f.__data__,g,l)),c.__data__=f.__data__):b.push(null)}return Qa(h)};Ja.insert=function(a,b){return 2>arguments.length&&(b=Af(this)),R.insert.call(this,a,b)};k.select=function(a){var b;return"string"==typeof a?(b=
[oc(a,ma)],b.parentNode=ma.documentElement):(b=[a],b.parentNode=a&&(a.ownerDocument||a.document||a).documentElement),Qa([b])};k.selectAll=function(a){var b;return"string"==typeof a?(b=Xa(pc(a,ma)),b.parentNode=ma.documentElement):(b=a,b.parentNode=null),Qa([b])};R.on=function(a,b,c){var d=arguments.length;if(3>d){if("string"!=typeof a){2>d&&(b=!1);for(c in a)this.each(Xd(c,a[c],b));return this}if(2>d)return(d=this.node()["__on"+a])&&d._;c=!1}return this.each(Xd(a,b,c))};var rc=k.map({mouseenter:"mouseover",
mouseleave:"mouseout"});ma&&rc.forEach(function(a){"on"+a in ma&&rc.remove(a)});var Ya,Cf=0,Wb=Math.SQRT2,Vc=2;k.interpolateZoom=function(a,b){function c(a){var b=a*v;if(r){a=jd(q);var c=f/(Vc*m),h,g=Wb*b+q;h=((g=Math.exp(2*g))-1)/(g+1);h*=a;var s=q,g=((s=Math.exp(s))-1/s)/2,c=c*(h-g);return[d+c*l,e+c*k,f*a/jd(Wb*b+q)]}return[d+a*l,e+a*k,f*Math.exp(Wb*b)]}var d=a[0],e=a[1],f=a[2],h=b[2],l=b[0]-d,k=b[1]-e,g=l*l+k*k,m=Math.sqrt(g),p=(h*h-f*f+4*g)/(2*f*Vc*m),g=(h*h-f*f-4*g)/(2*h*Vc*m),q=Math.log(Math.sqrt(p*
p+1)-p),r=Math.log(Math.sqrt(g*g+1)-g)-q,v=(r||Math.log(h/f))/Wb;return c.duration=1E3*v,c};k.behavior={};k.behavior.zoom=function(){function a(a){a.on(L,s).on(Wc+".zoom",p).on("dblclick.zoom",q).on(qa,m)}function b(a){return[(a[0]-x.x)/x.k,(a[1]-x.y)/x.k]}function c(a){x.k=Math.max(C[0],Math.min(C[1],a))}function d(a,b){b=[b[0]*x.k+x.x,b[1]*x.k+x.y];x.x+=a[0]-b[0];x.y+=a[1]-b[1]}function e(b,e,f,h){b.__chart__={x:x.x,y:x.y,k:x.k};c(Math.pow(2,h));d(v=e,f);b=k.select(b);0<P&&(b=b.transition().duration(P));
b.call(a.event)}function f(){K&&K.domain(y.range().map(function(a){return(a-x.x)/x.k}).map(y.invert));H&&H.domain(u.range().map(function(a){return(a-x.y)/x.k}).map(u.invert))}function h(a){Q++||a({type:"zoomstart"})}function l(a){f();a({type:"zoom",scale:x.k,translate:[x.x,x.y]})}function g(a){--Q||(a({type:"zoomend"}),v=null)}function s(){var a=this,c=k.event.target,e=F.of(a,arguments),f=0,s=k.select(M(a)).on(J,function(){f=1;d(k.mouse(a),m);l(e)}).on(E,function(){s.on(J,null).on(E,null);p(f&&k.event.target===
c);g(e)}),m=b(k.mouse(a)),p=sc(a);Xb.call(a);h(e)}function m(){function a(){var c=k.touches(r);return A=x.k,c.forEach(function(a){a.identifier in B&&(B[a.identifier]=b(a))}),c}function f(){var b=k.event.target;k.select(b).on(K,p).on(u,q);T.push(b);for(var b=k.event.changedTouches,c=0,d=b.length;d>c;++c)B[b[c].identifier]=null;c=a();d=Date.now();1===c.length?(500>d-D&&(b=c[0],e(r,b,B[b.identifier],Math.floor(Math.log(x.k)/Math.LN2)+1),z()),D=d):1<c.length&&(b=c[0],d=c[1],c=b[0]-d[0],b=b[1]-d[1],v=
c*c+b*b)}function p(){var a,b,e,f,h=k.touches(r);Xb.call(r);for(var g=0,s=h.length;s>g;++g,f=null)if(e=h[g],f=B[e.identifier]){if(b)break;a=e;b=f}if(f){var m=(m=e[0]-a[0])*m+(m=e[1]-a[1])*m,h=v&&Math.sqrt(m/v);a=[(a[0]+e[0])/2,(a[1]+e[1])/2];b=[(b[0]+f[0])/2,(b[1]+f[1])/2];c(h*A)}D=null;d(a,b);l(y)}function q(){if(k.event.touches.length){for(var b=k.event.changedTouches,c=0,d=b.length;d>c;++c)delete B[b[c].identifier];for(var e in B)return void a()}k.selectAll(T).on(I,null);H.on(L,s).on(qa,m);t();
g(y)}var A,r=this,y=F.of(r,arguments),B={},v=0,I=".zoom-"+k.event.changedTouches[0].identifier,K="touchmove"+I,u="touchend"+I,T=[],H=k.select(r),t=sc(r);f();h(y);H.on(L,null).on(qa,f)}function p(){var a=F.of(this,arguments);A?clearTimeout(A):(Xb.call(this),r=b(v=I||k.mouse(this)),h(a));A=setTimeout(function(){A=null;g(a)},50);z();c(Math.pow(2,0.002*Yb())*x.k);d(v,r);l(a)}function q(){var a=k.mouse(this),c=Math.log(x.k)/Math.LN2;e(this,a,b(a),k.event.shiftKey?Math.ceil(c)-1:Math.floor(c)+1)}var r,
v,I,A,D,y,K,u,H,x={x:0,y:0,k:1},t=[960,500],C=He,P=250,Q=0,L="mousedown.zoom",J="mousemove.zoom",E="mouseup.zoom",qa="touchstart.zoom",F=G(a,"zoomstart","zoom","zoomend");return Wc||(Wc="onwheel"in ma?(Yb=function(){return-k.event.deltaY*(k.event.deltaMode?120:1)},"wheel"):"onmousewheel"in ma?(Yb=function(){return k.event.wheelDelta},"mousewheel"):(Yb=function(){return-k.event.detail},"MozMousePixelScroll")),a.event=function(a){a.each(function(){var a=F.of(this,arguments),b=x;ab?k.select(this).transition().each("start.zoom",
function(){x=this.__chart__||{x:0,y:0,k:1};h(a)}).tween("zoom:zoom",function(){var c=t[0],d=t[1],e=v?v[0]:c/2,f=v?v[1]:d/2,h=k.interpolateZoom([(e-x.x)/x.k,(f-x.y)/x.k,c/x.k],[(e-b.x)/b.k,(f-b.y)/b.k,c/b.k]);return function(b){b=h(b);var d=c/b[2];this.__chart__=x={x:e-b[0]*d,y:f-b[1]*d,k:d};l(a)}}).each("interrupt.zoom",function(){g(a)}).each("end.zoom",function(){g(a)}):(this.__chart__=x,h(a),l(a),g(a))})},a.translate=function(b){return arguments.length?(x={x:+b[0],y:+b[1],k:x.k},f(),a):[x.x,x.y]},
a.scale=function(b){return arguments.length?(x={x:x.x,y:x.y,k:+b},f(),a):x.k},a.scaleExtent=function(b){return arguments.length?(C=null==b?He:[+b[0],+b[1]],a):C},a.center=function(b){return arguments.length?(I=b&&[+b[0],+b[1]],a):I},a.size=function(b){return arguments.length?(t=b&&[+b[0],+b[1]],a):t},a.duration=function(b){return arguments.length?(P=+b,a):P},a.x=function(b){return arguments.length?(K=b,y=b.copy(),x={x:0,y:0,k:1},a):K},a.y=function(b){return arguments.length?(H=b,u=b.copy(),x={x:0,
y:0,k:1},a):H},k.rebind(a,F,"on")};var Yb,Wc,He=[0,1/0];k.hsl=Ca;var Xc=Ca.prototype=new W;Xc.brighter=function(a){return a=Math.pow(0.7,arguments.length?a:1),new Ca(this.h,this.s,this.l/a)};Xc.darker=function(a){return a=Math.pow(0.7,arguments.length?a:1),new Ca(this.h,this.s,a*this.l)};Xc.rgb=function(){return tc(this.h,this.s,this.l)};k.hcl=ya;var Yc=ya.prototype=new W;Yc.brighter=function(a){return new ya(this.h,this.c,Math.min(100,this.l+Zb*(arguments.length?a:1)))};Yc.darker=function(a){return new ya(this.h,
this.c,Math.max(0,this.l-Zb*(arguments.length?a:1)))};Yc.rgb=function(){return uc(this.h,this.c,this.l).rgb()};k.lab=za;var Zb=18,de=0.95047,ee=1,fe=1.08883,Zc=za.prototype=new W;Zc.brighter=function(a){return new za(Math.min(100,this.l+Zb*(arguments.length?a:1)),this.a,this.b)};Zc.darker=function(a){return new za(Math.max(0,this.l-Zb*(arguments.length?a:1)),this.a,this.b)};Zc.rgb=function(){return ce(this.l,this.a,this.b)};k.rgb=ka;var $b=ka.prototype=new W;$b.brighter=function(a){a=Math.pow(0.7,
arguments.length?a:1);var b=this.r,c=this.g,d=this.b;return b||c||d?(b&&30>b&&(b=30),c&&30>c&&(c=30),d&&30>d&&(d=30),new ka(Math.min(255,b/a),Math.min(255,c/a),Math.min(255,d/a))):new ka(30,30,30)};$b.darker=function(a){return a=Math.pow(0.7,arguments.length?a:1),new ka(a*this.r,a*this.g,a*this.b)};$b.hsl=function(){return $d(this.r,this.g,this.b)};$b.toString=function(){return"#"+gb(this.r)+gb(this.g)+gb(this.b)};var Gb=k.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,
azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,
darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,
ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,
mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,
peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,
wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Gb.forEach(function(a,b){Gb.set(a,new ka(b>>16,b>>8&255,255&b))});k.interpolateRgb=Ac;k.interpolateObject=ge;k.interpolateNumber=Ka;k.interpolateString=he;var Bc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Cc=RegExp(Bc.source,"g");k.interpolate=Za;k.interpolators=[function(a,b){var c=typeof b;return("string"===c?Gb.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?Ac:he:b instanceof W?Ac:Array.isArray(b)?Hb:
"object"===c&&isNaN(b)?ge:Ka)(a,b)}];k.interpolateArray=Hb;var Ie=function(){return x},qg=k.map({linear:Ie,poly:function(a){return function(b){return Math.pow(b,a)}},quad:function(){return Ef},cubic:function(){return Ff},sin:function(){return Hf},exp:function(){return If},circle:function(){return Jf},elastic:function(a,b){var c;return 2>arguments.length&&(b=0.45),arguments.length?c=b/ra*Math.asin(1/a):(a=1,c=b/4),function(d){return 1+a*Math.pow(2,-10*d)*Math.sin((d-c)*ra/b)}},back:function(a){return a||
(a=1.70158),function(b){return b*b*((a+1)*b-a)}},bounce:function(){return Kf}}),rg=k.map({"in":x,out:ie,"in-out":je,"out-in":function(a){return je(ie(a))}});k.ease=function(a){var b=a.indexOf("-"),c=0<=b?a.slice(0,b):a,b=0<=b?a.slice(b+1):"in";return c=qg.get(c)||Ie,b=rg.get(b)||x,Df(b(c.apply(null,Be.call(arguments,1))))};k.interpolateHcl=function(a,b){a=k.hcl(a);b=k.hcl(b);var c=a.h,d=a.c,e=a.l,f=b.h-c,h=b.c-d,l=b.l-e;return isNaN(h)&&(h=0,d=isNaN(d)?b.c:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):180<f?
f-=360:-180>f&&(f+=360),function(a){return uc(c+f*a,d+h*a,e+l*a)+""}};k.interpolateHsl=function(a,b){a=k.hsl(a);b=k.hsl(b);var c=a.h,d=a.s,e=a.l,f=b.h-c,h=b.s-d,l=b.l-e;return isNaN(h)&&(h=0,d=isNaN(d)?b.s:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):180<f?f-=360:-180>f&&(f+=360),function(a){return tc(c+f*a,d+h*a,e+l*a)+""}};k.interpolateLab=function(a,b){a=k.lab(a);b=k.lab(b);var c=a.l,d=a.a,e=a.b,f=b.l-c,h=b.a-d,l=b.b-e;return function(a){return ce(c+f*a,d+h*a,e+l*a)+""}};k.interpolateRound=ke;k.transform=
function(a){var b=ma.createElementNS(k.ns.prefix.svg,"g");return(k.transform=function(a){if(null!=a){b.setAttribute("transform",a);var d=b.transform.baseVal.consolidate()}return new le(d?d.matrix:sg)})(a)};le.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var sg={a:1,b:0,c:0,d:1,e:0,f:0};k.interpolateTransform=ne;k.permute=function(a,b){for(var c=b.length,d=Array(c);c--;)d[c]=a[b[c]];return d};k.layout={};k.layout.stack=
function(){function a(l,g){if(!(q=l.length))return l;var s=l.map(function(c,d){return b.call(a,c,d)}),m=s.map(function(b){return b.map(function(b,c){return[f.call(a,b,c),h.call(a,b,c)]})}),p=c.call(a,m,g),s=k.permute(s,p),m=k.permute(m,p),q,r,x,v=d.call(a,m,g),A=s[0].length;for(r=0;A>r;++r)for(e.call(a,s[0][r],x=v[r],m[0][r][1]),p=1;q>p;++p)e.call(a,s[p][r],x+=m[p-1][r][1],m[p][r][1]);return l}var b=x,c=Dc,d=Ec,e=Pf,f=Nf,h=Of;return a.values=function(c){return arguments.length?(b=c,a):b},a.order=
function(b){return arguments.length?(c="function"==typeof b?b:tg.get(b)||Dc,a):c},a.offset=function(b){return arguments.length?(d="function"==typeof b?b:ug.get(b)||Ec,a):d},a.x=function(b){return arguments.length?(f=b,a):f},a.y=function(b){return arguments.length?(h=b,a):h},a.out=function(b){return arguments.length?(e=b,a):e},a};var tg=k.map({"inside-out":function(a){var b,c=a.length,d=a.map(Qf),e=a.map(Rf),f=k.range(c).sort(function(a,b){return d[a]-d[b]}),h=0,l=0,g=[],s=[];for(a=0;c>a;++a)b=f[a],
l>h?(h+=e[b],g.push(b)):(l+=e[b],s.push(b));return s.reverse().concat(g)},reverse:function(a){return k.range(a.length).reverse()},"default":Dc}),ug=k.map({silhouette:function(a){var b,c,d,e=a.length,f=a[0].length,h=[],l=0,k=[];for(c=0;f>c;++c){for(d=b=0;e>b;b++)d+=a[b][c][1];d>l&&(l=d);h.push(d)}for(c=0;f>c;++c)k[c]=(l-h[c])/2;return k},wiggle:function(a){var b,c,d,e,f,h,l,k,g,m=a.length,p=a[0],q=p.length,r=[];r[0]=k=g=0;for(c=1;q>c;++c){for(e=b=0;m>b;++b)e+=a[b][c][1];f=b=0;for(l=p[c][0]-p[c-1][0];m>
b;++b){d=0;for(h=(a[b][c][1]-a[b][c-1][1])/(2*l);b>d;++d)h+=(a[d][c][1]-a[d][c-1][1])/l;f+=h*a[b][c][1]}r[c]=k-=e?f/e*l:0;g>k&&(g=k)}for(c=0;q>c;++c)r[c]-=g;return r},expand:function(a){var b,c,d,e=a.length,f=a[0].length,h=1/e,l=[];for(c=0;f>c;++c){for(d=b=0;e>b;b++)d+=a[b][c][1];if(d)for(b=0;e>b;b++)a[b][c][1]/=d;else for(b=0;e>b;b++)a[b][c][1]=h}for(c=0;f>c;++c)l[c]=0;return l},zero:Ec});k.layout.pie=function(){function a(h){var l,g=h.length,s=h.map(function(c,d){return+b.call(a,c,d)}),m=+("function"==
typeof d?d.apply(this,arguments):d),p=("function"==typeof e?e.apply(this,arguments):e)-m,q=Math.min(Math.abs(p)/g,+("function"==typeof f?f.apply(this,arguments):f)),r=q*(0>p?-1:1),x=(p-g*r)/k.sum(s),g=k.range(g),v=[];return null!=c&&g.sort(c===Je?function(a,b){return s[b]-s[a]}:function(a,b){return c(h[a],h[b])}),g.forEach(function(a){v[a]={data:h[a],value:l=s[a],startAngle:m,endAngle:m+=l*x+r,padAngle:q}}),v}var b=Number,c=Je,d=0,e=ra,f=0;return a.value=function(c){return arguments.length?(b=c,a):
b},a.sort=function(b){return arguments.length?(c=b,a):c},a.startAngle=function(b){return arguments.length?(d=b,a):d},a.endAngle=function(b){return arguments.length?(e=b,a):e},a.padAngle=function(b){return arguments.length?(f=b,a):f},a};var Je={},Uf={floor:x,ceil:x},Ke=pe(Fb);k.bisectLeft=Ke.left;k.bisect=k.bisectRight=Ke.right;k.bisector=function(a){return pe(1===a.length?function(b,c){return Fb(a(b),c)}:a)};k.scale={};k.scale.linear=function(){return qe([0,1],[0,1],Za,!1)};var Xf={s:1,g:1,p:1,r:1,
e:1};k.scale.identity=function(){return se([0,1])};k.scale.ordinal=function(){return te([],{t:"range",a:[[]]})};k.scale.pow=function(){return ue(k.scale.linear(),1,[0,1])};k.scale.sqrt=function(){return k.scale.pow().exponent(0.5)};R.transition=function(a){for(var b,c=ab||++Le,d=Ic(a),e=[],f=ac||{time:Date.now(),ease:Gf,delay:0,duration:250},h=-1,l=this.length;++h<l;){e.push(a=[]);for(var k=this[h],g=-1,m=k.length;++g<m;)(b=k[g])&&Lb(b,g,d,c,f),a.push(b)}return lb(e,d,c)};R.interrupt=function(a){return this.each(null==
a?Xb:ve(Ic(a)))};var ab,ac,Xb=ve(Ic()),aa=[],Le=0;aa.call=R.call;aa.empty=R.empty;aa.node=R.node;aa.size=R.size;k.transition=function(a,b){return a&&a.transition?ab?a.transition(b):a:k.selection().transition(a)};k.transition.prototype=aa;aa.select=function(a){var b,c,d,e=this.id,f=this.namespace,h=[];a=nc(a);for(var l=-1,k=this.length;++l<k;){h.push(b=[]);for(var g=this[l],m=-1,p=g.length;++m<p;)(d=g[m])&&(c=a.call(d,d.__data__,m,l))?("__data__"in d&&(c.__data__=d.__data__),Lb(c,m,f,e,d[f][e]),b.push(c)):
b.push(null)}return lb(h,f,e)};aa.selectAll=function(a){var b,c,d,e,f=this.id,h=this.namespace,l=[];a=Md(a);for(var k=-1,g=this.length;++k<g;)for(var m=this[k],p=-1,q=m.length;++p<q;)if(b=m[p]){e=b[h][f];c=a.call(b,b.__data__,p,k);l.push(b=[]);for(var r=-1,x=c.length;++r<x;)(d=c[r])&&Lb(d,r,h,f,e),b.push(d)}return lb(l,h,f)};aa.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Vd(a));for(var f=0,h=this.length;h>f;f++){e.push(b=[]);c=this[f];for(var l=0,k=c.length;k>l;l++)(d=c[l])&&a.call(d,
d.__data__,l,f)&&b.push(d)}return lb(e,this.namespace,this.id)};aa.tween=function(a,b){var c=this.id,d=this.namespace;return 2>arguments.length?this.node()[d][c].tween.get(a):Ia(this,null==b?function(b){b[d][c].tween.remove(a)}:function(e){e[d][c].tween.set(a,b)})};aa.attr=function(a,b){function c(){this.removeAttribute(l)}function d(){this.removeAttributeNS(l.space,l.local)}function e(a){return null==a?c:(a+="",function(){var b,c=this.getAttribute(l);return c!==a&&(b=h(c,a),function(a){this.setAttribute(l,
b(a))})})}function f(a){return null==a?d:(a+="",function(){var b,c=this.getAttributeNS(l.space,l.local);return c!==a&&(b=h(c,a),function(a){this.setAttributeNS(l.space,l.local,b(a))})})}if(2>arguments.length){for(b in a)this.attr(b,a[b]);return this}var h="transform"==a?ne:Za,l=k.ns.qualify(a);return Hc(this,"attr."+a,b,l.local?f:e)};aa.attrTween=function(a,b){function c(a,c){var d=b.call(this,a,c,this.getAttribute(e));return d&&function(a){this.setAttribute(e,d(a))}}function d(a,c){var d=b.call(this,
a,c,this.getAttributeNS(e.space,e.local));return d&&function(a){this.setAttributeNS(e.space,e.local,d(a))}}var e=k.ns.qualify(a);return this.tween("attr."+a,e.local?d:c)};aa.style=function(a,b,c){function d(){this.style.removeProperty(a)}var e=arguments.length;if(3>e){if("string"!=typeof a){2>e&&(b="");for(c in a)this.style(c,a[c],b);return this}c=""}return Hc(this,"style."+a,b,function(b){return null==b?d:(b+="",function(){var d,e=M(this).getComputedStyle(this,null).getPropertyValue(a);return e!==
b&&(d=Za(e,b),function(b){this.style.setProperty(a,d(b),c)})})})};aa.styleTween=function(a,b,c){return 3>arguments.length&&(c=""),this.tween("style."+a,function(d,e){var f=b.call(this,d,e,M(this).getComputedStyle(this,null).getPropertyValue(a));return f&&function(b){this.style.setProperty(a,f(b),c)}})};aa.text=function(a){return Hc(this,"text",a,Yf)};aa.remove=function(){var a=this.namespace;return this.each("end.transition",function(){var b;2>this[a].count&&(b=this.parentNode)&&b.removeChild(this)})};
aa.ease=function(a){var b=this.id,c=this.namespace;return 1>arguments.length?this.node()[c][b].ease:("function"!=typeof a&&(a=k.ease.apply(k,arguments)),Ia(this,function(d){d[c][b].ease=a}))};aa.delay=function(a){var b=this.id,c=this.namespace;return 1>arguments.length?this.node()[c][b].delay:Ia(this,"function"==typeof a?function(d,e,f){d[c][b].delay=+a.call(d,d.__data__,e,f)}:(a=+a,function(d){d[c][b].delay=a}))};aa.duration=function(a){var b=this.id,c=this.namespace;return 1>arguments.length?this.node()[c][b].duration:
Ia(this,"function"==typeof a?function(d,e,f){d[c][b].duration=Math.max(1,a.call(d,d.__data__,e,f))}:(a=Math.max(1,a),function(d){d[c][b].duration=a}))};aa.each=function(a,b){var c=this.id,d=this.namespace;if(2>arguments.length){var e=ac,f=ab;try{ab=c,Ia(this,function(b,e,f){ac=b[d][c];a.call(b,b.__data__,e,f)})}finally{ac=e,ab=f}}else Ia(this,function(e){e=e[d][c];(e.event||(e.event=k.dispatch("start","end","interrupt"))).on(a,b)});return this};aa.transition=function(){for(var a,b,c,d,e=this.id,f=
++Le,h=this.namespace,l=[],k=0,g=this.length;g>k;k++){l.push(a=[]);b=this[k];for(var m=0,p=b.length;p>m;m++)(c=b[m])&&(d=c[h][e],Lb(c,m,h,f,{time:d.time,ease:d.ease,delay:d.delay+d.duration,duration:d.duration})),a.push(c)}return lb(l,h,f)};k.svg={};k.svg.axis=function(){function a(a){a.each(function(){var a,s=k.select(this),p=this.__chart__||c,q=this.__chart__=c.copy(),r=null==g?q.ticks?q.ticks.apply(q,l):q.domain():g,v=null==b?q.tickFormat?q.tickFormat.apply(q,l):x:b,A=s.selectAll(".tick").data(r,
q),r=A.enter().insert("g",".domain").attr("class","tick").style("opacity",L),D=k.transition(A.exit()).style("opacity",L).remove(),y=k.transition(A.order()).style("opacity",1),u=Math.max(e,0)+h,H=Ib(q),s=s.selectAll(".domain").data([0]),s=(s.enter().append("path").attr("class","domain"),k.transition(s));r.append("line");r.append("text");var t,C,z,P,G=r.select("line"),Q=y.select("line"),v=A.select("text").text(v),A=r.select("text"),J=y.select("text"),E="top"===d||"left"===d?-1:1;if("bottom"===d||"top"===
d?(a=Zf,t="x",z="y",C="x2",P="y2",v.attr("dy",0>E?"0em":".71em").style("text-anchor","middle"),s.attr("d","M"+H[0]+","+E*f+"V0H"+H[1]+"V"+E*f)):(a=$f,t="y",z="x",C="y2",P="x2",v.attr("dy",".32em").style("text-anchor",0>E?"end":"start"),s.attr("d","M"+E*f+","+H[0]+"H0V"+H[1]+"H"+E*f)),G.attr(P,E*e),A.attr(z,E*u),Q.attr(C,0).attr(P,E*e),J.attr(t,0).attr(z,E*u),q.rangeBand)var qa=q,M=qa.rangeBand()/2,p=q=function(a){return qa(a)+M};else p.rangeBand?p=q:D.call(a,q,p);r.call(a,p,q);y.call(a,q,q)})}var b,
c=k.scale.linear(),d=Me,e=6,f=6,h=3,l=[10],g=null;return a.scale=function(b){return arguments.length?(c=b,a):c},a.orient=function(b){return arguments.length?(d=b in vg?b+"":Me,a):d},a.ticks=function(){return arguments.length?(l=arguments,a):l},a.tickValues=function(b){return arguments.length?(g=b,a):g},a.tickFormat=function(c){return arguments.length?(b=c,a):b},a.tickSize=function(b){var c=arguments.length;return c?(e=+b,f=+arguments[c-1],a):e},a.innerTickSize=function(b){return arguments.length?
(e=+b,a):e},a.outerTickSize=function(b){return arguments.length?(f=+b,a):f},a.tickPadding=function(b){return arguments.length?(h=+b,a):h},a.tickSubdivide=function(){return arguments.length&&a},a};var Me="bottom",vg={top:1,right:1,bottom:1,left:1};k.functor=la;k.svg.line=function(){return ag(x)};var Kc=k.map({linear:oa,"linear-closed":function(a){return oa(a)+"Z"},step:function(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d[0]+(d=a[b])[0])/2,"V",d[1]);return 1<c&&e.push("H",
d[0]),e.join("")},"step-before":Lc,"step-after":Mc,basis:xe,"basis-open":function(a){if(4>a.length)return oa(a);for(var b,c=[],d=-1,e=a.length,f=[0],h=[0];3>++d;)b=a[d],f.push(b[0]),h.push(b[1]);c.push(ua(Sa,f)+","+ua(Sa,h));for(--d;++d<e;)b=a[d],f.shift(),f.push(b[0]),h.shift(),h.push(b[1]),Oc(c,f,h);return c.join("")},"basis-closed":function(a){for(var b,c,d=-1,e=a.length,f=e+4,h=[],l=[];4>++d;)c=a[d%e],h.push(c[0]),l.push(c[1]);b=[ua(Sa,h),",",ua(Sa,l)];for(--d;++d<f;)c=a[d%e],h.shift(),h.push(c[0]),
l.shift(),l.push(c[1]),Oc(b,h,l);return b.join("")},bundle:function(a,b){var c=a.length-1;if(c)for(var d,e,f=a[0][0],h=a[0][1],l=a[c][0]-f,k=a[c][1]-h,g=-1;++g<=c;)d=a[g],e=g/c,d[0]=b*d[0]+(1-b)*(f+e*l),d[1]=b*d[1]+(1-b)*(h+e*k);return xe(a)},cardinal:function(a,b){return 3>a.length?oa(a):a[0]+Mb(a,Nc(a,b))},"cardinal-open":function(a,b){return 4>a.length?oa(a):a[1]+Mb(a.slice(1,-1),Nc(a,b))},"cardinal-closed":function(a,b){return 3>a.length?oa(a):a[0]+Mb((a.push(a[0]),a),Nc([a[a.length-2]].concat(a,
[a[1]]),b))},monotone:function(a){if(3>a.length)a=oa(a);else{var b=a[0],c,d,e,f,h=[],l;c=0;l=a.length-1;for(var k=[],g=a[1],m=k[0]=Pc(a[0],g);++c<l;)k[c]=(m+(m=Pc(g,g=a[c+1])))/2;l=(k[c]=m,k);k=-1;for(g=a.length-1;++k<g;)c=Pc(a[k],a[k+1]),U(c)<L?l[k]=l[k+1]=0:(d=l[k]/c,e=l[k+1]/c,f=d*d+e*e,9<f&&(f=3*c/Math.sqrt(f),l[k]=f*d,l[k+1]=f*e));for(k=-1;++k<=g;)f=(a[Math.min(g,k+1)][0]-a[Math.max(0,k-1)][0])/(6*(1+l[k]*l[k])),h.push([f||0,l[k]*f||0]);a=b+Mb(a,h)}return a}});Kc.forEach(function(a,b){b.key=
a;b.closed=/-closed$/.test(a)});var ye=[0,2/3,1/3,0],ze=[0,1/3,2/3,0],Sa=[0,1/6,2/3,1/6];k.geom={};k.geom.polygon=function(a){return Eb(a,bc),a};var bc=k.geom.polygon.prototype=[];bc.area=function(){for(var a,b=-1,c=this.length,d=this[c-1],e=0;++b<c;)a=d,d=this[b],e+=a[1]*d[0]-a[0]*d[1];return 0.5*e};bc.centroid=function(a){var b,c,d=-1,e=this.length,f=0,h=0,k=this[e-1];for(arguments.length||(a=-1/(6*this.area()));++d<e;)b=k,k=this[d],c=b[0]*k[1]-k[0]*b[1],f+=(b[0]+k[0])*c,h+=(b[1]+k[1])*c;return[f*
a,h*a]};bc.clip=function(a){for(var b,c,d,e,f,h,k=Ae(a),g=-1,s=this.length-Ae(this),m=this[s-1];++g<s;){b=a.slice();a.length=0;e=this[g];f=b[(d=b.length-k)-1];for(c=-1;++c<d;)h=b[c],Qc(h,m,e)?(Qc(f,m,e)||a.push(Rc(f,h,m,e)),a.push(h)):Qc(f,m,e)&&a.push(Rc(f,h,m,e)),f=h;k&&a.push(a[0]);m=e}return a};k.svg.arc=function(){function a(){var a=Math.max(0,+c.apply(this,arguments)),m=Math.max(0,+d.apply(this,arguments)),p=h.apply(this,arguments)-ia,q=k.apply(this,arguments)-ia,r=Math.abs(q-p),x=p>q?0:1;if(a>
m&&(v=m,m=a,a=v),r>=og)return b(m,x)+(a?b(a,1-x):"")+"Z";var v,A,D,y,u,H,t,C,z,P;t=v=0;r=[];((y=(+g.apply(this,arguments)||0)/2)&&(D=f===cc?Math.sqrt(a*a+m*m):+f.apply(this,arguments),x||(t*=-1),m&&(t=Ma(D/m*Math.sin(y))),a&&(v=Ma(D/a*Math.sin(y)))),m)?(D=m*Math.cos(p+t),y=m*Math.sin(p+t),u=m*Math.cos(q-t),H=m*Math.sin(q-t),A=Math.abs(q-p-2*t)<=J?0:1,t&&(0<(D-u)*y-(y-H)*D?0:1)===x^A&&(u=(p+q)/2,D=m*Math.cos(u),y=m*Math.sin(u),u=H=null)):D=y=0;if(a){t=a*Math.cos(q-v);C=a*Math.sin(q-v);z=a*Math.cos(p+
v);P=a*Math.sin(p+v);var G=Math.abs(p-q+2*v)<=J?0:1;v&&(0<(t-z)*C-(C-P)*t?0:1)===1-x^G&&(z=(p+q)/2,t=a*Math.cos(z),C=a*Math.sin(z),z=P=null)}else t=C=0;if(0.001<(v=Math.min(Math.abs(m-a)/2,+e.apply(this,arguments)))){A=m>a^x?0:1;var G=null==z?[t,C]:null==u?[D,y]:Rc([D,y],[z,P],[u,H],[t,C]),p=D-G[0],q=y-G[1],E=u-G[0],Q=H-G[1],p=1/Math.sin(Math.acos((p*E+q*Q)/(Math.sqrt(p*p+q*q)*Math.sqrt(E*E+Q*Q)))/2),G=Math.sqrt(G[0]*G[0]+G[1]*G[1]);null!=u?(q=Math.min(v,(m-G)/(p+1)),E=Nb(null==z?[t,C]:[z,P],[D,y],
m,q,x),Q=Nb([u,H],[t,C],m,q,x),v===q?r.push("M",E[0],"A",q,",",q," 0 0,",A," ",E[1],"A",m,",",m," 0 ",1-x^(0<(E[1][0]-Q[1][0])*E[1][1]-(E[1][1]-Q[1][1])*E[1][0]?0:1),",",x," ",Q[1],"A",q,",",q," 0 0,",A," ",Q[0]):r.push("M",E[0],"A",q,",",q," 0 1,",A," ",Q[0])):r.push("M",D,",",y);null!=z?(m=Math.min(v,(a-G)/(p-1)),z=Nb([D,y],[z,P],a,-m,x),u=Nb([t,C],null==u?[D,y]:[u,H],a,-m,x),v===m?r.push("L",u[0],"A",m,",",m," 0 0,",A," ",u[1],"A",a,",",a," 0 ",x^(0<(u[1][0]-z[1][0])*u[1][1]-(u[1][1]-z[1][1])*
u[1][0]?0:1),",",1-x," ",z[1],"A",m,",",m," 0 0,",A," ",z[0]):r.push("L",u[0],"A",m,",",m," 0 0,",A," ",z[0])):r.push("L",t,",",C)}else r.push("M",D,",",y),null!=u&&r.push("A",m,",",m," 0 ",A,",",x," ",u,",",H),r.push("L",t,",",C),null!=z&&r.push("A",a,",",a," 0 ",G,",",1-x," ",z,",",P);return r.push("Z"),r.join("")}function b(a,b){return"M0,"+a+"A"+a+","+a+" 0 1,"+b+" 0,"+-a+"A"+a+","+a+" 0 1,"+b+" 0,"+a}var c=cg,d=dg,e=bg,f=cc,h=eg,k=fg,g=gg;return a.innerRadius=function(b){return arguments.length?
(c=la(b),a):c},a.outerRadius=function(b){return arguments.length?(d=la(b),a):d},a.cornerRadius=function(b){return arguments.length?(e=la(b),a):e},a.padRadius=function(b){return arguments.length?(f=b==cc?cc:la(b),a):f},a.startAngle=function(b){return arguments.length?(h=la(b),a):h},a.endAngle=function(b){return arguments.length?(k=la(b),a):k},a.padAngle=function(b){return arguments.length?(g=la(b),a):g},a.centroid=function(){var a=(+c.apply(this,arguments)+ +d.apply(this,arguments))/2,b=(+h.apply(this,
arguments)+ +k.apply(this,arguments))/2-ia;return[Math.cos(b)*a,Math.sin(b)*a]},a};var cc="auto";Lc.reverse=Mc;Mc.reverse=Lc;k.svg.area=function(){return hg(x)};k.svg.brush=function(){function a(f){f.each(function(){var f=k.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",e).on("touchstart.brush",e),h=f.selectAll(".background").data([0]);h.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor",
"crosshair");f.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var l=f.selectAll(".resize").data(u,x);l.exit().remove();l.enter().append("g").attr("class",function(a){return"resize "+a}).style("cursor",function(a){return wg[a]}).append("rect").attr("x",function(a){return/[ew]$/.test(a)?-3:null}).attr("y",function(a){return/^[ns]/.test(a)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");l.style("display",a.empty()?"none":null);
var m,f=k.transition(f),h=k.transition(h);g&&(m=Ib(g),h.attr("x",m[0]).attr("width",m[1]-m[0]),c(f));p&&(m=Ib(p),h.attr("y",m[0]).attr("height",m[1]-m[0]),d(f));b(f)})}function b(a){a.selectAll(".resize").attr("transform",function(a){return"translate("+m[+/e$/.test(a)]+","+q[+/^s/.test(a)]+")"})}function c(a){a.select(".extent").attr("x",m[0]);a.selectAll(".extent,.n>rect,.s>rect").attr("width",m[1]-m[0])}function d(a){a.select(".extent").attr("y",q[0]);a.selectAll(".extent,.e>rect,.w>rect").attr("height",
q[1]-q[0])}function e(){function e(){var a=k.mouse(t),f=!1;H&&(a[0]+=H[0],a[1]+=H[1]);J||(k.event.altKey?(y||(y=[(m[0]+m[1])/2,(q[0]+q[1])/2]),F[0]=m[+(a[0]<y[0])],F[1]=q[+(a[1]<y[1])]):y=null);Q&&x(a,g,0)&&(c(G),f=!0);L&&x(a,p,1)&&(d(G),f=!0);f&&(b(G),P({type:"brush",mode:J?"move":"resize"}))}function x(a,b,c){var d,e,k=Ib(b);b=k[0];var k=k[1],g=F[c],l=c?q:m,p=l[1]-l[0];return J&&(b-=g,k-=p+g),d=(c?v:r)?Math.max(b,Math.min(k,a[c])):a[c],J?e=(d+=g)+p:(y&&(g=Math.max(b,Math.min(k,2*y[c]-d))),d>g?(e=
d,d=g):e=g),l[0]!=d||l[1]!=e?(c?h=null:f=null,l[0]=d,l[1]=e,!0):void 0}function u(){e();G.style("pointer-events","all").selectAll(".resize").style("display",a.empty()?"none":null);k.select("body").style("cursor",null);N.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);qa();P({type:"brushend"})}var y,H,t=this,C=k.select(k.event.target),P=l.of(t,arguments),G=k.select(t),E=C.datum(),Q=!/^(n|s)$/.test(E)&&
g,L=!/^(e|w)$/.test(E)&&p,J=C.classed("extent"),qa=sc(t),F=k.mouse(t),N=k.select(M(t)).on("keydown.brush",function(){32==k.event.keyCode&&(J||(y=null,F[0]-=m[1],F[1]-=q[1],J=2),z())}).on("keyup.brush",function(){32==k.event.keyCode&&2==J&&(F[0]+=m[1],F[1]+=q[1],J=0,z())});if(k.event.changedTouches?N.on("touchmove.brush",e).on("touchend.brush",u):N.on("mousemove.brush",e).on("mouseup.brush",u),G.interrupt().selectAll("*").interrupt(),J)F[0]=m[0]-F[0],F[1]=q[0]-F[1];else if(E){var O=+/w$/.test(E),E=
+/^n/.test(E);H=[m[1-O]-F[0],q[1-E]-F[1]];F[0]=m[O];F[1]=q[E]}else k.event.altKey&&(y=F.slice());G.style("pointer-events","none").selectAll(".resize").style("display",null);k.select("body").style("cursor",C.style("cursor"));P({type:"brushstart"});e()}var f,h,l=G(a,"brushstart","brush","brushend"),g=null,p=null,m=[0,0],q=[0,0],r=!0,v=!0,u=$c[0];return a.event=function(a){a.each(function(){var a=l.of(this,arguments),b={x:m,y:q,i:f,j:h},c=this.__chart__||b;this.__chart__=b;ab?k.select(this).transition().each("start.brush",
function(){f=c.i;h=c.j;m=c.x;q=c.y;a({type:"brushstart"})}).tween("brush:brush",function(){var c=Hb(m,b.x),d=Hb(q,b.y);return f=h=null,function(e){m=b.x=c(e);q=b.y=d(e);a({type:"brush",mode:"resize"})}}).each("end.brush",function(){f=b.i;h=b.j;a({type:"brush",mode:"resize"});a({type:"brushend"})}):(a({type:"brushstart"}),a({type:"brush",mode:"resize"}),a({type:"brushend"}))})},a.x=function(b){return arguments.length?(g=b,u=$c[!g<<1|!p],a):g},a.y=function(b){return arguments.length?(p=b,u=$c[!g<<1|
!p],a):p},a.clamp=function(b){return arguments.length?(g&&p?(r=!!b[0],v=!!b[1]):g?r=!!b:p&&(v=!!b),a):g&&p?[r,v]:g?r:p?v:null},a.extent=function(b){var c,d,e,k,l;return arguments.length?(g&&(c=b[0],d=b[1],p&&(c=c[0],d=d[0]),f=[c,d],g.invert&&(c=g(c),d=g(d)),c>d&&(l=c,c=d,d=l),(c!=m[0]||d!=m[1])&&(m=[c,d])),p&&(e=b[0],k=b[1],g&&(e=e[1],k=k[1]),h=[e,k],p.invert&&(e=p(e),k=p(k)),e>k&&(l=e,e=k,k=l),(e!=q[0]||k!=q[1])&&(q=[e,k])),a):(g&&(f?(c=f[0],d=f[1]):(c=m[0],d=m[1],g.invert&&(c=g.invert(c),d=g.invert(d)),
c>d&&(l=c,c=d,d=l))),p&&(h?(e=h[0],k=h[1]):(e=q[0],k=q[1],p.invert&&(e=p.invert(e),k=p.invert(k)),e>k&&(l=e,e=k,k=l))),g&&p?[[c,e],[d,k]]:g?[c,d]:p&&[e,k])},a.clear=function(){return a.empty()||(m=[0,0],q=[0,0],f=h=null),a},a.empty=function(){return!!g&&m[0]==m[1]||!!p&&q[0]==q[1]},k.rebind(a,l,"on")};var wg={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},$c=["n e s w nw ne se sw".split(" "),["e","w"],["n","s"],[]],ad=u.format=
De.timeFormat,Ne=ad.utc,Oe=Ne("%Y-%m-%dT%H:%M:%S.%LZ");ad.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Sc:Oe;Sc.parse=function(a){a=new Date(a);return isNaN(a)?null:a};Sc.toString=Oe.toString;u.second=Ta(function(a){return new da(1E3*Math.floor(a/1E3))},function(a,b){a.setTime(a.getTime()+1E3*Math.floor(b))},function(a){return a.getSeconds()});u.seconds=u.second.range;u.seconds.utc=u.second.utc.range;u.minute=Ta(function(a){return new da(6E4*Math.floor(a/6E4))},function(a,
b){a.setTime(a.getTime()+6E4*Math.floor(b))},function(a){return a.getMinutes()});u.minutes=u.minute.range;u.minutes.utc=u.minute.utc.range;u.hour=Ta(function(a){var b=a.getTimezoneOffset()/60;return new da(36E5*(Math.floor(a/36E5-b)+b))},function(a,b){a.setTime(a.getTime()+36E5*Math.floor(b))},function(a){return a.getHours()});u.hours=u.hour.range;u.hours.utc=u.hour.utc.range;u.month=Ta(function(a){return a=u.day(a),a.setDate(1),a},function(a,b){a.setMonth(a.getMonth()+b)},function(a){return a.getMonth()});
u.months=u.month.range;u.months.utc=u.month.utc.range;var Ob=[1E3,5E3,15E3,3E4,6E4,3E5,9E5,18E5,36E5,108E5,216E5,432E5,864E5,1728E5,6048E5,2592E6,7776E6,31536E6],bd=[[u.second,1],[u.second,5],[u.second,15],[u.second,30],[u.minute,1],[u.minute,5],[u.minute,15],[u.minute,30],[u.hour,1],[u.hour,3],[u.hour,6],[u.hour,12],[u.day,1],[u.day,2],[u.week,1],[u.month,1],[u.month,3],[u.year,1]],xg=ad.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],
["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",db]]),ig={range:function(a,b,c){return k.range(Math.ceil(a/c)*c,+b,c).map($a)},floor:x,ceil:x};bd.year=u.year;u.scale=function(){return Tc(k.scale.linear(),bd,xg)};var Pe=bd.map(function(a){return[a[0].utc,a[1]]}),yg=Ne.multi([[".%L",function(a){return a.getUTCMilliseconds()}],[":%S",function(a){return a.getUTCSeconds()}],
["%I:%M",function(a){return a.getUTCMinutes()}],["%I %p",function(a){return a.getUTCHours()}],["%a %d",function(a){return a.getUTCDay()&&1!=a.getUTCDate()}],["%b %d",function(a){return 1!=a.getUTCDate()}],["%B",function(a){return a.getUTCMonth()}],["%Y",db]]);Pe.year=u.year.utc;u.scale.utc=function(){return Tc(k.scale.linear(),Pe,yg)};"function"==typeof define&&define.amd?define(k):"object"==typeof module&&module.exports&&(module.exports=k);this.d3=k}();
(function(){var pa,bb=[].slice;pa=function(){return(Math.random().toString(36)+"00000000000000000").replace(/[^a-z]+/g,"").slice(0,5)};(function(W){return"object"==typeof exports?module.exports=W():"function"==typeof define&&define.amd?define([],W):this.textures=W()})(function(){return{circles:function(){var W,M,F,X,N,Y,g,ca,S;return g=20,W="",Y=2,F=!1,X="#343434",ca="#343434",S=0,N=pa(),M=function(){var t,v,r,Q,z,E;if(v=this.append("defs").append("pattern").attr({id:N,patternUnits:"userSpaceOnUse",
width:g,height:g}),W&&v.append("rect").attr({width:g,height:g,fill:W}),v.append("circle").attr({cx:g/2,cy:g/2,r:Y,fill:X,stroke:ca,"stroke-width":S}),F){z=[[0,0],[0,g],[g,0],[g,g]];E=[];r=0;for(Q=z.length;Q>r;r++)t=z[r],E.push(v.append("circle").attr({cx:t[0],cy:t[1],r:Y,fill:X,stroke:ca,"stroke-width":S}));return E}},M.heavier=function(g){return Y=arguments.length&&g?2*Y*g:2*Y,M},M.lighter=function(g){return arguments.length?Y=g?Y/(2*g):Y/2:Y/=2,M},M.thinner=function(t){return g=arguments.length&&
t?2*g*t:2*g,M},M.thicker=function(t){return arguments.length?g=t?g/(2*t):g/2:g/=2,M},M.background=function(g){return W=g,M},M.size=function(t){return g=t,M},M.complement=function(){return F=!0,M},M.radius=function(g){return Y=g,M},M.fill=function(g){return X=g,M},M.stroke=function(g){return ca=g,M},M.strokeWidth=function(g){return S=g,M},M.id=function(g){return arguments.length?(N=g,M):N},M.url=function(){return"url(#"+N+")"},M},lines:function(){var W,M,F,X,N,Y,g,ca,S;return g=20,S=2,ca="#343434",
M=pa(),W="",X=["diagonal"],Y="auto",N=function(t){switch(t){case "0/8":return"M "+g/2+", 0 l 0, "+g;case "vertical":return"M "+g/2+", 0 l 0, "+g;case "1/8":return"M "+g/4+",0 l "+g/2+","+g+" M "+-g/4+",0 l "+g/2+","+g+"\nM "+3*g/4+",0 l "+g/2+","+g;case "2/8":return"M 0,"+g+" l "+g+","+-g+" M "+-g/4+","+g/4+" l "+g/2+","+-g/2+"\nM "+0.75*g+","+1.25*g+" l "+g/2+","+-g/2;case "diagonal":return"M 0,"+g+" l "+g+","+-g+" M "+-g/4+","+g/4+" l "+g/2+","+-g/2+"\nM "+0.75*g+","+1.25*g+" l "+g/2+","+-g/2;case "3/8":return"M 0,"+
0.75*g+" l "+g+","+-g/2+" M 0,"+g/4+" l "+g+","+-g/2+"\nM 0,"+5*g/4+" l "+g+","+-g/2;case "4/8":return"M 0,"+g/2+" l "+g+",0";case "horizontal":return"M 0,"+g/2+" l "+g+",0";case "5/8":return"M 0,"+-g/4+" l "+g+","+g/2+"M 0,"+g/4+" l "+g+","+g/2+"\nM 0,"+3*g/4+" l "+g+","+g/2;case "6/8":return"M 0,0 l "+g+","+g+" M "+-g/4+","+0.75*g+" l "+g/2+","+g/2+"\nM "+3*g/4+","+-g/4+" l "+g/2+","+g/2;case "7/8":return"M "+-g/4+",0 l "+g/2+","+g+" M "+g/4+",0 l "+g/2+","+g+"\nM "+3*g/4+",0 l "+g/2+","+g;default:return"M "+
g/2+", 0 l 0, "+g}},F=function(){var t,v,r,Q,z;t=this.append("defs").append("pattern").attr({id:M,patternUnits:"userSpaceOnUse",width:g,height:g});W&&t.append("rect").attr({width:g,height:g,fill:W});z=[];v=0;for(r=X.length;r>v;v++)Q=X[v],z.push(t.append("path").attr({d:N(Q),"stroke-width":S,"shape-rendering":Y,stroke:ca,"stroke-linecap":"square"}));return z},F.background=function(g){return W=g,F},F.shapeRendering=function(g){return Y=g,F},F.heavier=function(g){return S=arguments.length&&g?2*S*g:2*
S,F},F.lighter=function(g){return arguments.length?S=g?S/(2*g):S/2:S/=2,F},F.thinner=function(t){return g=arguments.length&&t?2*g*t:2*g,F},F.thicker=function(t){return arguments.length?g=t?g/(2*t):g/2:g/=2,F},F.orientation=function(){var g;return g=1<=arguments.length?bb.call(arguments,0):[],X=g,F},F.size=function(t){return g=t,F},F.stroke=function(g){return ca=g,F},F.strokeWidth=function(g){return S=g,F},F.id=function(g){return arguments.length?(M=g,F):M},F.url=function(){return"url(#"+M+")"},F},
paths:function(){var W,M,F,X,N,Y,g,ca,S,t,v;return g=20,F=1,v=1,S=2,ca="#343434",W="",M="",Y="auto",X=void 0,t=function(r){switch(r){case "squares":return"M "+g/4+" "+g/4+" l "+g/2+" 0 l 0 "+g/2+" l "+-g/2+" 0 Z";case "nylon":return"M 0 "+g/4+" l "+g/4+" 0 l 0 "+-g/4+" M "+3*g/4+" "+g+" l 0 "+-g/4+"\nl "+g/4+" 0 M "+g/4+" "+g/2+" l 0 "+g/4+" l "+g/4+" 0 M "+g/2+" "+g/4+"\nl "+g/4+" 0 l 0 "+g/4;case "waves":return"M 0 "+g/2+" c "+g/8+" "+-g/4+" , "+3*g/8+" "+-g/4+" , "+g/2+" 0\nc "+g/8+" "+g/4+" , "+
3*g/8+" "+g/4+" , "+g/2+" 0 M "+-g/2+" "+g/2+"\nc "+g/8+" "+g/4+" , "+3*g/8+" "+g/4+" , "+g/2+" 0 M "+g+" "+g/2+"\nc "+g/8+" "+-g/4+" , "+3*g/8+" "+-g/4+" , "+g/2+" 0";case "woven":return"M "+g/4+","+g/4+"l"+g/2+","+g/2+"M"+3*g/4+","+g/4+"l"+g/2+","+-g/2+"\nM"+g/4+","+3*g/4+"l"+-g/2+","+g/2+"M"+3*g/4+","+5*g/4+"l"+g/2+","+-g/2+"\nM"+-g/4+","+g/4+"l"+g/2+","+-g/2;case "crosses":return"M "+g/4+","+g/4+"l"+g/2+","+g/2+"M"+g/4+","+3*g/4+"l"+g/2+","+-g/2;case "caps":return"M "+g/4+","+3*g/4+"l"+g/4+","+
-g/2+"l"+g/4+","+g/2;case "hexagons":return v=3,F=Math.sqrt(3),"M "+g+",0 l "+g+",0 l "+g/2+","+g*Math.sqrt(3)/2+"\nl "+-g/2+","+g*Math.sqrt(3)/2+" l "+-g+",0\nl "+-g/2+","+-g*Math.sqrt(3)/2+" Z M 0,"+g*Math.sqrt(3)/2+"\nl "+g/2+",0 M "+3*g+","+g*Math.sqrt(3)/2+" l "+-g/2+",0";default:return r(g)}},N=function(){var r,Q;return Q=t(M),X=pa(),r=this.append("defs").append("pattern").attr({id:X,patternUnits:"userSpaceOnUse",width:g*v,height:g*F}),W&&r.append("rect").attr({width:g*v,height:g*F,fill:W}),
r.append("path").attr({d:Q,fill:"transparent","stroke-width":S,"shape-rendering":Y,stroke:ca,"stroke-linecap":"square"})},N.background=function(g){return W=g,N},N.shapeRendering=function(g){return Y=g,N},N.heavier=function(g){return S=arguments.length&&g?2*S*g:2*S,N},N.lighter=function(g){return arguments.length?S=g?S/(2*g):S/2:S/=2,N},N.thinner=function(r){return g=arguments.length&&r?2*g*r:2*g,N},N.thicker=function(r){return arguments.length?g=r?g/(2*r):g/2:g/=2,N},N.d=function(g){return M=g,N},
N.size=function(r){return g=r,N},N.stroke=function(g){return ca=g,N},N.strokeWidth=function(g){return S=g,N},N.id=function(g){return arguments.length?(X=g,N):X},N.url=function(){return"url(#"+X+")"},N}}})}).call(this);
!function(){function pa(g,r){function t(q){var p,r=g.arcs[0>q?~q:q],C=r[0];return g.transform?(p=[0,0],r.forEach(function(g){p[0]+=g[0];p[1]+=g[1]})):p=r[r.length-1],0>q?[p,C]:[C,p]}function z(g,p){for(var r in g){var v=g[r];delete p[v.start];delete v.start;delete v.end;v.forEach(function(g){E[0>g?~g:g]=1});q.push(v)}}var E={},G={},C={},q=[],P=-1;return r.forEach(function(q,p){var x,C=g.arcs[0>q?~q:q];3>C.length&&!C[1][0]&&!C[1][1]&&(x=r[++P],r[P]=q,r[p]=x)}),r.forEach(function(g){var p;p=t(g);var q=
p[0],r=p[1];(p=C[q])?(delete C[p.end],p.push(g),p.end=r,g=G[r])?(delete G[g.start],q=g===p?p:p.concat(g),G[q.start=p.start]=C[q.end=g.end]=q):G[p.start]=C[p.end]=p:(p=G[r])?(delete G[p.start],p.unshift(g),p.start=q,g=C[q])?(delete C[g.end],q=g===p?p:g.concat(p),G[q.start=g.start]=C[q.end=p.end]=q):G[p.start]=C[p.end]=p:(p=[g],G[p.start=q]=C[p.end=r]=p)}),z(C,G),z(G,C),r.forEach(function(g){E[0>g?~g:g]||q.push([g])}),q}function bb(g,r,t){function z(g){var p=0>g?~g:g;(H[p]||(H[p]=[])).push({i:g,g:P})}
function E(g){g.forEach(z)}function G(g){g.forEach(E)}function C(g){"GeometryCollection"===g.type?g.geometries.forEach(C):g.type in p&&(P=g,p[g.type](g.arcs))}var q=[];if(1<arguments.length){var P,H=[],p={LineString:E,MultiLineString:G,Polygon:G,MultiPolygon:function(g){g.forEach(G)}};C(r);H.forEach(3>arguments.length?function(g){q.push(g[0].i)}:function(g){t(g[0].g,g[g.length-1].g)&&q.push(g[0].i)})}else for(var x=0,F=g.arcs.length;F>x;++x)q.push(x);return{type:"MultiLineString",arcs:pa(g,q)}}function W(g,
r){function t(g){g.forEach(function(r){r.forEach(function(r){(E[r=0>r?~r:r]||(E[r]=[])).push(g)})});G.push(g)}function z(q){q=F(g,{type:"Polygon",arcs:[q]}).coordinates[0];for(var r,C=-1,p=q.length,x=q[p-1],z=0;++C<p;)r=x,x=q[C],z+=r[0]*x[1]-r[1]*x[0];return 0<0.5*z}var E={},G=[],C=[];return r.forEach(function(g){"Polygon"===g.type?t(g.arcs):"MultiPolygon"===g.type&&g.arcs.forEach(t)}),G.forEach(function(g){if(!g._){var r=[],v=[g];g._=1;for(C.push(r);g=v.pop();)r.push(g),g.forEach(function(g){g.forEach(function(g){E[0>
g?~g:g].forEach(function(g){g._||(g._=1,v.push(g))})})})}}),G.forEach(function(g){delete g._}),{type:"MultiPolygon",arcs:C.map(function(q){var r=[];if(q.forEach(function(g){g.forEach(function(g){g.forEach(function(g){2>E[0>g?~g:g].length&&r.push(g)})})}),r=pa(g,r),1<(n=r.length)){var C;C=z(q[0][0]);for(q=0;n>q;++q)if(C===z(r[q])){C=r[0];r[0]=r[q];r[q]=C;break}}return r})}}function M(g,r){var t={type:"Feature",id:r.id,properties:r.properties||{},geometry:F(g,r)};return null==r.id&&delete t.id,t}function F(v,
r){function t(g){return g=g.slice(),q(g,0),g}function z(g){for(var r=[],v=0,C=g.length;C>v;++v){var z=g[v],t=r;t.length&&t.pop();for(var G=void 0,E=F[0>z?~z:z],H=0,Q=E.length;Q>H;++H)t.push(G=E[H].slice()),q(G,H);if(0>z)for(z=t,t=void 0,G=z.length,Q=G-Q;Q<--G;)t=z[Q],z[Q++]=z[G],z[G]=t}return 2>r.length&&r.push(r[0].slice()),r}function E(g){for(g=z(g);4>g.length;)g.push(g[0].slice());return g}function G(g){return g.map(E)}function C(g){var q=g.type;return"GeometryCollection"===q?{type:q,geometries:g.geometries.map(C)}:
q in H?{type:q,coordinates:H[q](g)}:null}var q=g(v.transform),F=v.arcs,H={Point:function(g){return t(g.coordinates)},MultiPoint:function(g){return g.coordinates.map(t)},LineString:function(g){return z(g.arcs)},MultiLineString:function(g){return g.arcs.map(z)},Polygon:function(g){return G(g.arcs)},MultiPolygon:function(g){return g.arcs.map(G)}};return C(r)}function X(g,r){for(var t=0,z=g.length;z>t;){var E=t+z>>>1;g[E]<r?t=E+1:z=E}return t}function N(g){var r=g[0],t=g[1];g=g[2];return Math.abs((r[0]-
g[0])*(t[1]-r[1])-(r[0]-t[0])*(g[1]-r[1]))}function Y(){function g(r,v){for(;0<v;){var q=(v+1>>1)-1,t=z[q];if(0<=r[1][2]-t[1][2])break;z[t._=v]=t;z[r._=v=q]=r}}function r(g,r){for(;;){var q=r+1<<1,v=q-1,t=r,p=z[t];if(E>v&&0>z[v][1][2]-p[1][2]&&(p=z[t=v]),E>q&&0>z[q][1][2]-p[1][2]&&(p=z[t=q]),t===r)break;z[p._=r]=p;z[g._=r=t]=g}}var t={},z=[],E=0;return t.push=function(r){return g(z[r._=E]=r,E++),E},t.pop=function(){if(!(0>=E)){var g,v=z[0];return 0<--E&&(g=z[E],r(z[g._=0]=g,0)),v}},t.remove=function(t){var C,
q=t._;return z[q]===t?(q!==--E&&(C=z[E],(0>C[1][2]-t[1][2]?g:r)(z[C._=q]=C,q)),q):void 0},t}function g(g){if(!g)return S;var r,t,z=g.scale[0],E=g.scale[1],G=g.translate[0],C=g.translate[1];return function(g,v){v||(r=t=0);g[0]=(r+=g[0])*z+G;g[1]=(t+=g[1])*E+C}}function ca(g){if(!g)return S;var r,t,z=g.scale[0],E=g.scale[1],G=g.translate[0],C=g.translate[1];return function(g,v){v||(r=t=0);var H=(g[0]-G)/z|0,p=(g[1]-C)/E|0;g[0]=H-r;g[1]=p-t;r=H;t=p}}function S(){}var t={version:"1.6.19",mesh:function(g){return F(g,
bb.apply(this,arguments))},meshArcs:bb,merge:function(g){return F(g,W.apply(this,arguments))},mergeArcs:W,feature:function(g,r){return"GeometryCollection"===r.type?{type:"FeatureCollection",features:r.geometries.map(function(r){return M(g,r)})}:M(g,r)},neighbors:function(g){function r(g,p){g.forEach(function(g){0>g&&(g=~g);var q=E[g];q?q.push(p):E[g]=[p]})}function t(g,p){g.forEach(function(g){r(g,p)})}function z(g,p){"GeometryCollection"===g.type?g.geometries.forEach(function(g){z(g,p)}):g.type in
C&&C[g.type](g.arcs,p)}var E={},G=g.map(function(){return[]}),C={LineString:r,MultiLineString:t,Polygon:t,MultiPolygon:function(g,p){g.forEach(function(g){t(g,p)})}};g.forEach(z);for(var q in E){g=E[q];for(var F=g.length,H=0;F>H;++H)for(var p=H+1;F>p;++p){var x,M=g[H],N=g[p];(x=G[M])[q=X(x,N)]!==N&&x.splice(q,0,N);(x=G[N])[q=X(x,M)]!==M&&x.splice(q,0,M)}}return G},presimplify:function(t,r){function F(g){G.remove(g);g[1][2]=r(g);G.push(g)}var z=g(t.transform),E=ca(t.transform),G=Y();return r||(r=N),
t.arcs.forEach(function(g){for(var q,t=[],v=0,p=0,x=g.length;x>p;++p)q=g[p],z(g[p]=[q[0],q[1],1/0],p);p=1;for(x=g.length-1;x>p;++p)q=g.slice(p-1,p+2),q[1][2]=r(q),t.push(q),G.push(q);p=0;for(x=t.length;x>p;++p)q=t[p],q.previous=t[p-1],q.next=t[p+1];for(;q=G.pop();)t=q.previous,p=q.next,q[1][2]<v?q[1][2]=v:v=q[1][2],t&&(t.next=p,t[2]=q[2],F(t)),p&&(p.previous=t,p[0]=q[0],F(p));g.forEach(E)}),t}};"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=
t:this.topojson=t}();
;
(function(){function w(a,c,b){a=a.translate();c=Math.atan2(c[1]-a[1],c[0]-a[0])-Math.atan2(b[1]-a[1],b[0]-a[0]);return[Math.cos(c/2),0,0,Math.sin(c/2)]}function u(a,c){var b=a.invert(c);return b&&isFinite(b[0])&&isFinite(b[1])&&n(b)}function p(a){var c=0.5*a[0]*m,b=0.5*a[1]*m,d=0.5*a[2]*m;a=Math.sin(c);var c=Math.cos(c),e=Math.sin(b),b=Math.cos(b),f=Math.sin(d),d=Math.cos(d);return[c*b*d+a*e*f,a*b*d-c*e*f,c*e*d+a*b*f,c*b*f-a*e*d]}function q(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],k=c[0],h=c[1],l=c[2],
g=c[3];return[b*k-d*h-e*l-f*g,b*h+d*k+e*g-f*l,b*l-d*g+e*k+f*h,b*g+d*l-e*h+f*k]}function v(a,c){if(a&&c){var b=[a[1]*c[2]-a[2]*c[1],a[2]*c[0]-a[0]*c[2],a[0]*c[1]-a[1]*c[0]],d=Math.sqrt(r(b,b)),e=0.5*Math.acos(Math.max(-1,Math.min(1,r(a,c)))),f=Math.sin(e)/d;return d&&[Math.cos(e),b[2]*f,-b[1]*f,b[0]*f]}}function x(a,c){var b=Math.max(-1,Math.min(1,r(a,c))),d=0>b?-1:1,e=Math.acos(d*b),f=Math.sin(e);return f?function(b){var h=d*Math.sin((1-b)*e)/f;b=Math.sin(b*e)/f;return[a[0]*h+c[0]*b,a[1]*h+c[1]*b,
a[2]*h+c[2]*b,a[3]*h+c[3]*b]}:function(){return a}}function s(a){return[Math.atan2(2*(a[0]*a[1]+a[2]*a[3]),1-2*(a[1]*a[1]+a[2]*a[2]))*t,Math.asin(Math.max(-1,Math.min(1,2*(a[0]*a[2]-a[3]*a[1]))))*t,Math.atan2(2*(a[0]*a[3]+a[1]*a[2]),1-2*(a[2]*a[2]+a[3]*a[3]))*t]}function n(a){var c=a[0]*m;a=a[1]*m;var b=Math.cos(a);return[b*Math.cos(c),b*Math.sin(c),Math.sin(a)]}function r(a,c){for(var b=0,d=a.length,e=0;b<d;++b)e+=a[b]*c[b];return e}function y(a){for(var c=0,b=arguments.length,d=[];++c<b;)d.push(arguments[c]);
var e=d3.dispatch.apply(null,d);e.of=function(b,c){return function(d){try{var l=d.sourceEvent=d3.event;d.target=a;d3.event=d;e[d.type].apply(b,c)}finally{d3.event=l}}};return e}var m=Math.PI/180,t=180/Math.PI;d3.geo.zoom=function(){function a(a){f++||a({type:"zoomstart"})}function c(a){--f||a({type:"zoomend"})}var b,d,e,f=0,k=y(h,"zoomstart","zoom","zoomend"),h=d3.behavior.zoom().on("zoomstart",function(){var c=d3.mouse(this),d=p(b.rotate()),f=u(b,c);f&&(e=f);l.call(h,"zoom",function(){b.scale(g.k=
d3.event.scale);var a=d3.mouse(this),f=v(e,u(b,a));b.rotate(g.r=s(d=f?q(d,f):q(w(b,c,a),d)));c=a;k.of(this,arguments)({type:"zoom"})});a(k.of(this,arguments))}).on("zoomend",function(){l.call(h,"zoom",null);c(k.of(this,arguments))}),l=h.on,g={r:[0,0,0],k:1};h.rotateTo=function(a){a=v(n(a),n([-g.r[0],-g.r[1]]));return s(q(p(g.r),a))};h.projection=function(a){if(!arguments.length)return b;b=a;g={r:b.rotate(),k:b.scale()};return h.scale(g.k)};h.duration=function(a){return arguments.length?(d=a,h):d};
h.event=function(e){e.each(function(){var e=d3.select(this),f=k.of(this,arguments),l=g,m=d3.transition(e);if(m!==e){m.each("start.zoom",function(){this.__chart__&&(g=this.__chart__);b.rotate(g.r).scale(g.k);a(f)}).tween("zoom:zoom",function(){var a=h.size()[0],c=x(p(g.r),p(l.r)),e=d3.geo.distance(g.r,l.r),k=d3.interpolateZoom([0,0,a/g.k],[e,0,a/l.k]);d&&m.duration(d(0.001*k.duration));return function(d){d=k(d);this.__chart__=g={r:s(c(d[0]/e)),k:a/d[2]};b.rotate(g.r).scale(g.k);h.scale(g.k);f({type:"zoom"})}}).each("end.zoom",
function(){c(f)});try{m.each("interrupt.zoom",function(){c(f)})}catch(n){}}else this.__chart__=g,a(f),f({type:"zoom"}),c(f)})};return d3.rebind(h,k,"on")}})();
;
(function(){function b(){this.callbacks={}}b.prototype.register=function(a,b){this.callbacks[a]||(this.callbacks[a]=[]);this.callbacks[a].push(b)};b.prototype.calculate=function(){var a={};_.each(this.callbacks,function(b,c){a[c]=_.reduce(b,function(b,a){return b+((_.isFunction(a)?a():a)||0)},0)});return a};FTB.module("SpaceManager",b)})();
;
$.extend(d3.selection.prototype,{front:function(){return this.each(function(){this.parentNode.appendChild(this)})},prepend:function(a){return this.insert(a,":first-child")},dim:function(){try{var a=this.node().getBBox();return[a.width,a.height]}catch(b){return[0,0]}},jq:function(){return $(this.node())},trans:function(a,b,c){if(!a)return this;c=this.transition().duration(a);return b?c.delay(function(a,c){return c*b}):c},addClass:function(a){return this.toggleClass(a,!0)},removeClass:function(a){return this.toggleClass(a,
!1)},toggleClass:function(a,b){a=_.isString(a)?a.split(" "):a;return this.classed(_.object(a,_.map(a,_.constant(!!b))))},selectAndRemoveClass:function(a){this.selectAll("."+a).classed(a,!1)},closestToPoint:function(a){var b=Infinity,c,e,f;this.each(function(){e=d3.select(this);f=Math.abs(e.attr("cx")-a[0]);f<b&&(c=e,b=f)});return c},bbox:function(){var a,b,c,e;this.each(function(f,g){var d=this.getBoundingClientRect(),h=d.left+d.width,k=d.top+d.height;a=g?Math.min(d.left,a):d.left;b=g?Math.min(d.top,
b):d.top;c=g?Math.max(h,c):h;e=g?Math.max(k,e):k});return{w:c-a,h:e-b,x:a,y:b}},getClientBox:function(a){var b=this.bbox();a=a[0][0].getBoundingClientRect();return $.extend(b,{x:b.x-a.left,y:b.y-a.top})},fill:function(){return 1===this[0].length?this.jq().css("fill"):null}});
;
(function(){FTB.module("FTB.ChartTheme",{CONTINUOUS:1,DISCRETE:2,themes:{"default":{type:1,colors:[{color:"#ffffff",stop:0},{color:FTB.Colors.ftbBlue,stop:42},{color:"#000000",stop:100}]},cool:{type:1,colors:[{color:"#ffffff",stop:0},{color:"#dcedc8",stop:25},{color:"#42b3d5",stop:45},{color:"#1a237e",stop:75},{color:"#000000",stop:100}]},warm:{type:1,colors:[{color:"#ffffff",stop:0},{color:"#feeb65",stop:30},{color:"#e4521b",stop:65},{color:"#4d342f",stop:85},{color:"#000000",stop:100}]},fancy:{type:1,
colors:[{color:"#ffffff",stop:0},{color:"#ffecb3",stop:20},{color:"#e85285",stop:45},{color:"#6a1b9a",stop:65},{color:"#000000",stop:100}]},soft:{type:2,colors:"#6aacad #e85151 #ebc265 #57517a #9cb87f #804452 #cfcc7c #b05f82".split(" ")},ryg:{type:2,colors:[FTB.Colors.lightGreen,FTB.Colors.lightYellow,FTB.Colors.lightRed]},politics:{type:2,colors:["#4c678f","#a65653","#c4bb9c"]},medals:{type:2,colors:["#debf44","#eee8de","#ad7e53"]},gender:{type:2,colors:["#64a0d7","#dd6fc2"]}},getColors:function(a,
c){if(_.isArray(a))return a;a=a||"default";c=c||10;var b=this.themes[a];if(b){if(2===b.type)return b.colors;if(1===b.type)return b=this.getThemeScale(a),this.interpolateContinuousScale(b,c)}return this.getColorRange(a,c)},getThemeScale:_.memoize(function(a){a=this.themes[a];return d3.scale.linear().domain(_.pluck(a.colors,"stop")).range(_.pluck(a.colors,"color"))}),interpolateContinuousScale:function(a,c){var b=this.__deltaScale||(this.__deltaScale=d3.scale.linear().domain([1,2,5,10]).range([0,15,
25,30]).clamp(!0)),f=1<c?55:42,d=2===c?3:c,e=b(d),g=1<d?2*e/(d-1):0;return _.map(_.range(c),function(b){return a(f-e+b*g)})},getColorRange:function(a,c){var b=d3.hsl(a);b.l=Math.min(Math.max(b.l,0.4),0.6);b=d3.scale.linear().domain([0,42,100]).range(["#fff",b.toString(),"#000"]);return this.interpolateContinuousScale(b,c)}})})();
;
(function(d){var g=FTB.ChartTheme,e=d.Class.extend({init:function(a){this._o=$.extend({},a);$.extend(this,{w:700,h:350,seriesAll:{},series:[],data:[]},a);this.build();this.axesRequired()?this.initAxes():this.mapRequired()&&this.initMap();this.setFields(this.fields);this.setSeries(this.series);this.initPlayer();this.setData();this.resizeOnUpdate=!0;this.initAnnotations();return this},build:function(){var a=this,b=this.$pane=$('<div class="gfx-pane"/>'),c=this.$paneInner=$('<div class="gfx-pane-inner"/>').appendTo(b);
this.svg=d3.select(c[0]).append("svg");this.g=this.svg.append("g").classed("nosel",!0);b.appendTo(this.$el);this.spaceManager=new d.SpaceManager;a.popLink&&(a.$el.on("click",".gfx-pop-link",function(){var b=a.$el.find(".gfx-point.gfx-hl-sel");b.length&&(EVT(["Viz","Click to DD","Popup Link",null,!1]),(d.widget_log||$.noop)("Viz","Click to DD","Popup Link"),a.onPointClicked(b[0]))}),a.$el.on("mouseenter",".gfx-pop",function(){clearTimeout(a.hDelay)}).on("mouseleave",".gfx-pop",function(){a.highlightSoon(!1)}));
this.$el.on("mouseenter",".gfx-point",function(b){a.popEvt=b;a.noProximity=!0;b=d3.select(this).data()[0];b.series&&a.highlightSoon({series:b.series.seriesId,row:b.id,chartElement:this})});this.$el.on("mouseleave",".gfx-point",function(){a.noProximity=!1;a.highlightSoon(!1)});if(!d.is_touch)this.$el.on("click",".gfx-point",function(){a.onPointClicked(this)});return this},setFields:function(a){var b=this;this.fields=a;_.each(a,function(a,f){a.key=f;"date"===a.type&&(a.dateFormat||(a.dateFormat="%B %d, %Y %I:%M%p"),
a.formatDate||(a.formatDate=(b.useUTC?d3.time.format.utc:d3.time.format)(a.dateFormat)))});return this},setSeries:function(a){var b=this;_.invoke(b.seriesGroups,"reset");b.series=_.map(a,function(a){a=$.extend({},b.seriesAll,a,{parent:b});a.type===e.AREA&&(a.type=e.LINE,a.area=!0);a=FTB.ChartSeries.create(a);a.featured&&(b.featured={series:a.seriesId});return a});b.seriesGroups=b.seriesGroups||{};_.each(_.groupBy(b.series,"type"),function(a,f){b.seriesGroups[f]?b.seriesGroups[f].setSeries(a):(b.seriesGroups[f]=
FTB.ChartSeriesGroup.create({type:+f,series:a,parent:b}),b.$el.addClass("gfx-has-"+f))});b.axes&&b.axes.setSeries(_.filter(b.series,"axis"));return this},axesRequired:function(){return this.seriesAll&&this.seriesAll.type?this.axesRequiredForType(this.seriesAll.type):!!_.find(_.pluck(this.series,"type"),this.axesRequiredForType)},axesRequiredForType:function(a){return 0<=[e.BAR,e.LINE,e.AREA,e.SCATTER].indexOf(a)},mapRequiredForType:function(a){return 0<=[e.HEAT_MAP,e.BUBBLE_MAP].indexOf(a)},mapRequired:function(){return this.seriesAll&&
this.seriesAll.type?this.mapRequiredForType(this.seriesAll.type):!!_.find(_.pluck(this.series,"type"),this.mapRequiredForType)},initAxes:function(){this.axes=new FTB.ChartAxes({extentPad:this.extentPad,scaleYAxis:this.scaleYAxis,showPrimaryLabel:this.showPrimaryLabel,showValueLabel:this.showValueLabel,zoomType:this.zoomType,parent:this})},initMap:function(){this.map=new FTB.ChartMap({parent:this})},initAnnotations:function(){var a=this;_.size(a.annotations)&&(a.annoPopup=new FTB.ChartAnnotationPopup({parent:a}),
a.$el.on("mouseover",".gfx-ann-hover",function(){a.highlightAnnotation(d3.select(this))}).on("mouseleave",".gfx-ann-hover",function(){a.unhighlightAnnotation(d3.select(this))}))},highlightAnnotation:function(a){var b=a.datum().i,b=this.annotations.data[b];this.$el.toggleClass("gfx-ann-active",!0);a.classed("gfx-ann-over",!0);b.selection=a.select("circle");this.pop&&this.pop.disable();this.annoPopup.show(b)},unhighlightAnnotation:function(a){a||(a=this.svg.selectAll(".gfx-ann-over"));this.$el.toggleClass("gfx-ann-active",
!1);a.classed("gfx-ann-over",!1);this.pop&&this.pop.enable()},processAnnotationData:function(){var a=this,b=a.annotations,c=b.head.primary,f=b.isTimestamp,h=[],e;_.each(b.data,function(b,d){var g=f?new Date(1E3*b[c].raw):b[c].raw||b[c];_.each(a.series,function(c){a.axes&&h.push({series:c,sf:c.valueField,y:(0,a.axes.scales[c.axis])(b._y),color:c.color||"#ddd"})});e=b.index_field||b[c];_.extend(b,{i:d,x:a.axes?a.axes.scales.x(g)+(a.axes.ordinalOffset||0):g,imgUrl:b._img,title:e.formatted||e,seriesData:h});
h=[]});return b},updateAnnotations:function(){if(_.size(this.annotations)){var a=this.processAnnotationData();this.annotationData=a;a=this.g.selectAll(".gfx-ann-hover").data(a.data);a.enter().call(this._enterAnnotation.bind(this));a.exit().remove();a.call(this._updateAnnotation.bind(this));this.displayAnnotation(d3.select(a[0][0]))}},_enterAnnotation:function(a){a=a.append("g").classed("gfx-ann-hover",!0);_.each(this.seriesGroups,function(b){b._ah&&b._ah.enter.apply(b,[a])})},_updateAnnotation:function(a){_.each(this.seriesGroups,
function(b){b._ah&&b._ah.update.apply(b,[a])});a.front()},displayAnnotation:_.once(function(a){var b=_(this.data).filter("_annotation");b.size()?this.highlight({row:b.first().id}):this.highlightAnnotation(a)}),update:function(){this.animateSetup();this.trigger("preUpdate");this.resizeOnUpdate&&(this._resize(),this.resizeOnUpdate=!1);this.pop&&this.pop.isShown()&&!this.player&&this.highlight(!1);this.trigger("update");this.highlightFeatured();this.updateAnnotations();this.annt&&this.annt.draw();this.animateTeardown();
return this},resize:function(a,b){this.w=a||this.w;this.h=b||this.h;this.svgHeight=this.svgWidth=null;this.animateOnce=!1;this.resizeOnUpdate=!0;this.update();return this},_resize:function(){this.resizeSVG();this.trigger("resize");return this},resizeSVG:function(){this.svg.attr({width:this.getSVGWidth(),height:this.getSVGHeight()})},getSVGWidth:function(){return this.w},getSVGHeight:function(){this.dynamicHeight&&(this.svgHeight=this.dynamicHeight);this.svgHeight||(this.svgHeight=this.getInnerPaneHeight());
return this.svgHeight},getInnerPaneHeight:function(){if(this.allowDynamicHeight)return this.h;var a=this.spaceManager.calculate();return this.h-(a.top||0)-(a.bottom||0)},error:function(a){var b=this.$el;this.$err||(this.$err=$('<div class="gfx-error-wrap"><div class="gfx-error bbx">'+(a||tt("Woah! The visualization could not be rendered, sorry about that!"))+"</div></div>").hide().appendTo(b).fadeIn(500),FTB.Analytics.error("Visualization Could Not Render"))},resetError:function(){var a=this;a.$err&&
(a.$err.fadeOut(500),setTimeout(function(){a.$err.remove();a.$err=null},500))},destroy:function(){this.off();this.$el.empty();return this},setData:function(a){a&&(this.data=a);_.each(this.data,function(a){void 0===a.id&&(a.id=_.uniqueId())});this.player&&(this._data=this.data,this.player.setData(this.data));this.setColors().processData().setLegend();this.trigger("setData");this.resizeOnUpdate=!0;return this},processData:function(){this.trigger("processData");this.map&&this.map.processKeys();return this},
getNumPoints:function(){return _.size(this.data)},setColors:function(a){a=a||this.series;var b=this,c=b.getPalette(a),f=c.length;_.each(a,function(a,e){var d=a.colorField,g=d?b.fields[d].type:null;d&&a.colorCallback?a.colorScale=a.colorCallback:"color"===g?a.colorScale=_.identity:"number"===g?a.colorScale=d3.scale.linear().range(a.getColorRange()):d?a.colorScale=_.bind(a.getDiscreteColor,a):(a.color=a.color||c[e%f],a.colorScale=_.identity)});return this},getPalette:function(a){var b=_.size(a);a=_.pluck(a,
"color");var c=_.filter(a);if(c.length){var b=c.length-b,f;b&&(f=g.getColorRange("#999999",-b));return _.map(a,function(a){return a||f.shift()})}return g.getColors(this.theme,b)},getFieldColors:function(){var a={};_.each(this.series,function(b){a[b.valueField]=b.color});return a},getPrimaryField:function(){return this.fields[this.series[0].primaryField]},getPrimaryDateFormat:function(){return this.getPrimaryField().dateFormat},getD3TimeFormat:function(){return e.getD3TimeFormatter(this.useUTC)},getD3TimeScale:function(){return this.useUTC?
d3.time.scale.utc:d3.time.scale},getDisplayValue:function(a,b,c){a=this.fields[a];var f=a.prefix||"",e=a.suffix||"";if(c&&a.formatter){var d=!1,d=a.formatter(b,c);if(!1!==d)return d}return this.formatValue(this.getRawDisplayValue(b,a),f,e)},getRawDisplayValue:function(a,b){if(a&&"date"===b.type)return b.formatDate(a);if(a&&"text"===b.type)return a;if(null===a||isNaN(a)||""===a)return"&mdash;";a=b.precision?String(parseFloat(a,10).toFixed(b.precision||0)):(a=parseFloat(a,10))&&1>Math.abs(a)?a.toPrecision(2):
String(Math.round(100*a)/100);!1!==b.addCommas&&(a=add_commas(a));return a},formatValue:function(a,b,c){/^-/.test(a)&&1===b.length&&(a="-"+b+a.substr(1),b="");return b+a+c},animateSetup:function(){void 0!==this.animateOnce&&(this.__animate=this.animate,this.animate=this.animateOnce,this.animateOnce=void 0)},animateTeardown:function(){void 0!==this.__animate&&(this.animate=this.__animate,this.__animate=void 0)},highlightSoon:function(a){var b=this;if(!b.popLink)return b.highlight(a);clearTimeout(b.hDelay);
b.hDelay=setTimeout(function(){b.highlight(a)},50)},highlight:function(a){if(this.disablePop)return!1;var b=this,c=b.pop=b.pop||new FTB.ChartPopup({parent:b}),f=b.svg.selectAll(".gfx-hl-sel");b.$el.hasClass("gfx-ann-active")&&!b.$el.hasClass("gfx-hl")&&b.unhighlightAnnotation();f.classed("gfx-hl-sel",function(){return $(this).hasClass("gfx-hl-sel-ann")});b.$el.toggleClass("gfx-hl",!!a);clearTimeout(c.t);if(!1===a)c.t=setTimeout(function(){b.pop.hide();b.legend.unhighlightGradient()},100);else{var c=
[],d;void 0!==a.series&&(c.push(".gfx-srs-"+a.series),d=!0);void 0!==a.row&&(c.push('[data-row-id="'+a.row+'"]'),d=!1);c=a.selection=b.svg.selectAll(c.join(" ")).addClass("gfx-hl-sel");!d||a.featured?(d=c[d?"selectAll":"filter"](".gfx-point"),b.pop.show(d),b.legend.show(d.datum())):(c.data().type===e.LINE&&c.front(),b.pop.hide(),b.legend.unhighlightGradient())}a&&!1===a.trigger||this.trigger("highlight",a);return this},rehighlight:function(){var a=this.pop;a&&a.selection&&a.show(a.selection);return this},
highlightId:function(a){this.highlight({row:a,trigger:!1})},highlightFeatured:function(){if(!this.featuredShown&&this.featured){var a=this,b=a.featured;_.isObject(b)||(b={row:b});b.featured=!0;setTimeout(function(){a.featuredShown=!0;a.highlight(b)},this.animate?1E3:10)}},initProximityHover:function(){var a=this,b=_.throttle(a.onProximityHover,50,{trailing:!1});a.svg.prepend("rect").addClass("gfx-mouse-target").attr({width:this.w,height:this.h});a.svg.on("mousemove",function(){b.call(a,d3.mouse(a.g.node()))});
a.svg.jq().on("mouseleave",function(){a.highlightSoon(!1)});a.on("update",function(){a.points=a.svg.selectAll("circle.gfx-point")})},onProximityHover:function(a){this.series.length&&this.points.size()&&!this.noProximity&&(a=this.points.closestToPoint(a).data()[0]||{},(a=this.points.filter(_.createCallback({p:a.p})))&&!a.empty()&&this.highlightSoon({row:a.data()[0].id}))},onPointClicked:function(a){a=a.__data__;this.onItemClicked(this.data[a.i],a.series._o)},onItemClicked:function(a,b){if(a){this.trigger("itemClicked",
a,b);var c=a._url||this.url;!c||this.TEST||FTB.explore||c===d.location.href||d.open(c)}},getLegendItems:function(){var a=_(this.seriesGroups).invoke("getLegendItems").flatten().value(),b=_(a).pluck("color").filter(_.isString).size();return 2>b&&b===a.length?null:a},setLegend:function(){var a=this.legend=this.legend||new FTB.ChartLegend({parent:this,isPreview:this.isPreview,showLegend:this.showLegend});if(!a.useLegend())return this;var b=this.getLegendItems();if(!b)return this;this.$legend=a.reset().generateLegend(b);
a=this.$el.find(".gfx-axis-labels-bottom");this.$legend.insertAfter(a.length?a:this.$pane);this.allowDynamicHeight||(this.svgHeight=null);this.registerLegend();return this},registerLegend:_.once(function(){var a=this;this.spaceManager.register("bottom",function(){return a.$legend?a.$legend.outerHeight():0})}),initPlayer:function(){var a=this.timeField;a&&(this.player=new FTB.ChartPlayer({parent:this,field:this.fields[a]}))},toggleSeries:function(a){a+="";var b=this,c=_.pluck(b.series,"seriesId"),
d=_.pluck(_.filter(b.series,"disabled"),"seriesId");a=d.length?_.xor(_.xor(d,[a]),c):[a];d=a.length?_.xor(a,c):[];_.each(b.series,function(a){b.$legend.find('[data-series="'+a.seriesId+'"]').toggleClass("off",a.disabled=0<=d.indexOf(a.seriesId))});b.processData().trigger("toggleSeries").update()},buildToolbar:function(){this.$tbar&&this.$tbar.remove();this.iconBar=$('<div class="gfx-icon-bar"/>');this.$tbar=$('<div class="gfx-tbar"/>').append(this.iconBar).appendTo(this.$el)},addToolbarOption:function(a,
b){this.$tbar||this.buildToolbar();$('<div class="gfx-icon-item stnd-btn">'+a+"</div>").click(b).prependTo(this.iconBar)},addAnnotation:function(a){this.annt=a;a.setChart(this);a.getContainer().insertAfter(this.$pane)}}).mixin(_.Events);e.getD3TimeFormatter=function(a){return a?d.d3.time.format.utc:d.d3.time.format};$.extend(e,{BAR:1,SCATTER:2,LINE:3,AREA:4,HEAT_MAP:5,DONUT:7,BUBBLE_MAP:8,STACK_NONE:0,STACK:1,STACK_FULL:2,STACK_CENTER:3,LOW_GOOD:-1,NEUTRAL:-2,HIGH_GOOD:1,ZOOM_DATA_MIN:10,ZOOM_NONE:0,
ZOOM_X:1,ZOOM_XY:2});FTB.module("FTB.Chart",e)})(window);
;
(function(){var e=Class.extend({init:function(a){$.extend(this,a)},generateLegend:function(a){var b=this;a=_.map(a,function(a){return b.itemHtml(a)}).join("");b.$legend=$('<div class="gfx-lgnd bbx nosel">'+a+"</div>");b.bindEvents();return b.$legend},show:function(a){a=a&&a.c;this.scale&&a&&this.highlightGradient({value:a})},itemHtml:function(a){var b="";this.isColorRange(a)?(this.scale=a.scale,b=this.getColorRangeHtml(a)):b='<div class="gfx-lgnd-icn" style="'+this.getLegendColorCss(a)+'"/>';a.label&&
(b+='<div class="gfx-lgnd-txt">'+a.label+"</div>");a.extras&&(b+=a.extras);return this.openDiv(a)+b+"</div>"},getColorRangeHtml:function(a){return'<div class="gfx-lgnd-range"><em>'+(a.low||"Low")+'</em><div class="gfx-lgnd-grad" style="'+this.getLegendColorCss(a)+'"></div><em>'+(a.high||"High")+'</em><em class="gfx-lgnd-suffix">'+(a.suffix||"")+"</em></div>"},isColorRange:function(a){return _.isArray(a.color)},openDiv:function(a){var b=["gfx-lgnd-i"];a.interactive&&b.push("gfx-lgnd-i-inter");return'<div class="'+
b.join(" ")+'" data-id="'+a.id+'" data-type="'+a.type+'">'},getLegendColorCss:function(a){a=a.color;if(_.isArray(a)){var b=_.size(a),c;10>b&&(a=this.getBetterGradient(a),b=_.size(a));c=b?100/b:0;a=$.map(a,function(a,b){return a+" "+Math.round(b*c)+"%"});return"background: linear-gradient(to right, "+a.join(",")+");background: -webkit-linear-gradient(left, "+a.join(",")+");"}return a?"background-color:"+a:""},getBetterGradient:function(){var a=this.scale.domain(),b=a[0],a=a[a.length-1],c=(a-b)/9;return _.range(b,
a+c,c).map(this.scale)},reset:function(){this.$legend&&(this.$legend.remove(),this.$pointer=void 0);return this},useLegend:function(){return!this.isPreview&&!1!==this.showLegend},bindEvents:function(){this.$legend.on("click",".gfx-lgnd-i-inter",{self:this.parent},this.onLegendClick).on("mouseover",".gfx-lgnd-i-inter",{self:this.parent},this.onLegendHover).on("mouseout",".gfx-lgnd-i-inter",{self:this.parent},this.onLegendUnhover)},highlightGradient:function(a){if(gatekeeper("Charts: new legends")){var b=
this.scale.domain(),c=_.max(b),d=_.min(b);this.$legend.addClass("gfx-lgnd-active");a.percentage?(b=a.percentage,a=d+(c-d)*a.percentage):(a=a.value,b=(a-d)/(c-d));a=this.scale(a);this.getGradientPointer().css({"border-color":a+" transparent transparent transparent",left:this.getGradientWidth()*b-2})}},unhighlightGradient:function(){this.$legend&&this.$legend.removeClass("gfx-lgnd-active")},getGradientPointer:function(){this.$pointer||(this.$pointer=$('<em class="gfx-lgnd-pop"></em>').appendTo(this.$legend.find(".gfx-lgnd-grad")));
return this.$pointer},onLegendClick:function(a){var b=$(this);"series"===b.data("type")&&a.data.self.toggleSeries(b.data("id"))},onLegendHover:function(a){var b=$(this);"series"===b.data("type")&&a.data.self.highlight({series:b.data("id")})},onLegendUnhover:function(a){a.data.self.highlight(!1)},getGradientWidth:function(a){if(this._legendWidth)return this._legendWidth;a=a||this.$legend.find(".gfx-lgnd-grad");return this._legendWidth=a.width()}});FTB.module("FTB.ChartLegend",e)})();
;
(function(){var r=Class.extend({init:function(a){$.extend(this,a)},show:function(a){if(this.disabled)return this;this.selection=a;this.$e||this.build();if(a=this.getHTML(a)){this.$e.html(a).show();this.state=!0;this.reset();a=this.getBBox();var c=this.getPosition(a);this.resize(a,c);this.$e.addClass("show").css({left:c.left,top:c.top});return this}},hide:function(){this.selection=null;!this.disabled&&this.$e&&this.$e.removeClass("show");this.state=!1;return this},isShown:function(){return!!this.state},
build:function(){var a=this,c=a.parent.$pane.find(".gfx-pop");_.size(c)?a.$e=c:a.$e=$('<div class="gfx-pop border-box"/>').hide().hover(function(){clearTimeout(a.t)},function(){a.t=setTimeout(function(){a.hide()},100)}).appendTo(a.parent.$pane);a.parent.descriptionField&&a.$e.addClass("gfx-pop-desc");return this},getContent:function(a){var c=this,b=a.data()||[];if(!b.length)return null;var d=[],e,f,g,l,h,k,m;_.each(b,function(a){_.each(a.series.getPopFields(),function(m){f=c.parent.data[a.i];e=f[m];
h=c.parent.fields[m];void 0===k&&(k=h.highGood);"color"!==h.type&&(g=c.parent.getDisplayValue(m,e,f),d.push([h.name,g,1<b.length?a.cs(a.c):"",void 0===e?-1===k?Infinity:-Infinity:e]))});m=a._annotation&&a._annotation._content;l=a._annotation&&a._annotation._img});1<d.length&&this.shouldSortValues()&&(d.sort(function(a,b){return b[3]-a[3]}),this.parent.flipY&&d.reverse());var n=b[0].series,q=n.labelField||n.primaryField,p;!1!==n.showPopTitle&&(p=c.parent.getDisplayValue(q,b[0].l||b[0].p));c.parent.imageField&&
1===b.length&&(l=c.parent.data[b[0].i][c.parent.imageField]);c.parent.descriptionField&&!m&&(m=c.parent.data[b[0].i][c.parent.descriptionField]);(n=c.parent.player)&&(p=_.filter([p,n.currentValue]).join(" "));return{t:p,v:d,c:a.attr("color"),i:l,w:m}},shouldSortValues:function(){return this.parent.series[0].type!==FTB.Chart.LINE||1!==_(this.parent.series).pluck("type").uniq().size()?!1:!this.parent.series[0].stack},setSubtitle:function(a){this.subtitle=a},getHTML:function(a){a=this.getContent(a);
var c=["gfx-pop-i"],b="",d="",e={};if(a){a.i&&(b+='<div class="gfx-pop-image"><img src="'+a.i+'"/></div>',b+='<div class="gfx-pop-txt">');a.t&&(b+='<div class="gfx-pop-title">'+a.t+"</div>");a.s&&(b+='<div class="gfx-pop-st">'+a.s+"<div>");var f=a.v||[],g=f.length,l=a.w;l&&(b+='<div class="gfx-pop-text">'+l+"</div>",c.push("gfx-pop-i-txt"));var h=/^(-[\D]{0,2}[\d,.]+)(.*)/,k;_.each(f.slice(0,10),function(a){var b=a[2]?' style="border-left:4px solid '+a[2]+'"':"",c=a[1]+"";if(k=h.exec(c))c="<nobr>"+
k[1]+"</nobr>"+(k[2]||"");d+='<tr class="gfx-pop-val"><td><div'+(b?' class="clr" '+b:"")+">"+a[0]+"</div></td><td>"+c+"</td></tr>"});d&&(f=Math.min(g,10),b+='<table style="font-size:'+(5<f?11:3<f?12:13)+'px;">'+d+"</table>");10<g&&(b+='<div class="gfx-pop-more"><i>+ '+(g-10)+" more</i></div>");this.parent.popLink&&(b+='<span class="gfx-pop-link link">See more details &raquo;</span>');a.i&&(b+="</div>");a.c&&(e["border-color"]=a.c,c.push("clr"));e=_.map(e,function(a,b){return b+":"+a}).join(";");c=
c.join(" ");return'<div class="'+c+'" '+(e?'style="'+e+'">':">")+b+"</div>"}},getPosition:function(a){a=this.getPositionForBbox(a);if(!a&&this.parent.popEvt){a=this.parent.popEvt;var c=this.parent.svg.jq().offset();a=this.getPositionForBbox({x:a.clientX-c.left,y:a.clientY-c.top,w:1,h:1})}a||(a={left:10,top:10,pos:"top"});return a},getPositionForBbox:function(a){var c=this.$e,b=c.outerWidth(),d=c.outerHeight(),e=this.parent.getSVGWidth(),f=this.parent.getSVGHeight(),g=a.x,l=g+a.w,h=a.y-this.parent.$paneInner[0].scrollTop,
k=h+a.h;this.isLarge=d>f;a={right:{willFit:function(){return e-l-20>b},state:{left:l+10,top:Math.max(Math.min(h,f-d),0),pos:"right"}},bottom:{willFit:function(){return f-k-20>d},state:{left:Math.max(Math.min(g,e-b),0),top:k+10,pos:"bottom"}},left:{willFit:function(){return 0<g-b-20},state:{left:Math.max(g-b-10,0),top:Math.max(Math.min(h,f-d),0),pos:"left"}},top:{willFit:function(){return 0<h-d-20},state:{left:Math.max(Math.min(g,e-b),0),top:Math.max(h-d-10,0),pos:"top"}}};c=this.parent.rotate?["right",
"top","bottom","left"]:this.parent.axes?["top","right","left","bottom"]:["right","top","left","bottom"];if(a=_(a).pick(c).find(function(a){return a.willFit()}))return a.state},getBBox:function(){return this.selection.getClientBox(this.parent.svg)},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},reset:function(){this.isLarge=!1;this.$e.removeClass("gfx-pop-large").css("height","").css("width","")},resize:function(a,c){var b=this.parent,d=this.$e,e={},f;!this.isLarge||"top"!==
c&&"bottom"!==c||(f=(b.axes?b.axes.gridHeight:null)||b.h,e.height=f-(a.y-b.$paneInner[0].scrollTop),d.addClass("gfx-pop-large").css(e))}});FTB.module("FTB.ChartPopup",r)})();
;
(function(){var b=FTB.ChartPopup.extend({getBBox:function(){return this.selection.selection.getClientBox(this.parent.svg)},getContent:function(a){return{t:a.title,w:a._content,i:a.imgUrl,c:a.color,v:[]}}});FTB.module("FTB.ChartAnnotationPopup",b)})();
;
(function(){function p(){this.parentNode&&this.parentNode.removeChild(this)}function n(a){return[[".%L",function(b){return a?b.getUTCMilliseconds():b.getMilliseconds()},1],[":%S",function(b){return a?b.getUTCSeconds():b.getSeconds()},1E3],["%_I:%M",function(b){return a?b.getUTCMinutes():b.getMinutes()},60],["%_I %p",function(b){return a?b.getUTCHours():b.getHours()},60],["%b %e",function(b){return 1!==(a?b.getUTCDate():b.getDate())},24],["%b",function(b){return a?b.getUTCMonth():b.getMonth()},30],
["%Y",function(){return!0},365]]}function k(a,b){return 1<_.uniq(_.pluck(a,b)).length?"":a[0][b]||""}var q=window.Class.extend({init:function(a){$.extend(this,{scales:{},scaleYAxis:!1,tickFontSize:13,tickLevels:[],labelPad:8,zoomType:FTB.Chart.ZOOM_X,$labels:{}},a);this.rotate=a.parent.rotate;this.listenTo(this.parent,"resize",this.update);this.listenTo(this.parent,"highlight",this.highlight);this.listenTo(this.parent,"setData",this.setDomains);this.listenTo(this.parent,"preUpdate",this.updateAxisLabels);
var b=this;this.listenTo(this.parent,"toggleSeries",function(){b.setDomains().update()});this.gridSpaceManager=new window.SpaceManager;this.tickFormat=_.bind(this.tickFormat,this)},setSeries:function(a){var b=this;b.seriesByAxis=_.groupBy(a,"axis");b.primaryField=_.find(b.seriesByAxis)[0].primaryField;a=b.parent.fields[b.primaryField];var c=a.dateFormat;"date"===a.type&&b.parent.data.length>b.getTimeThreshold(c)?(b.timeAxis=!b.rotate,b.ordinalAxis=!!b.rotate):(b.timeAxis=!1,this.hasChartType(FTB.Chart.BAR)&&
20>b.parent.data.length&&"number"===a.type?b.ordinalAxis=!0:b.ordinalAxis="number"!==a.type);b.dateFormat=c;b.axes||(b.buildAxes(),b.initZoom());_.each(b.axes,function(a,c){$.extend(a,b.getAxisFormatOptions(a));if(a.isValue){var e=a.stack=b.seriesByAxis[c][0].stack;a.min=e?0:a.min;a.max=e===FTB.Chart.STACK_FULL?1:a.max}})},buildAxes:function(){var a=this,b={},c=a.rotate,d;a.timeAxis?(d=this.parent.getD3TimeScale()(),a.timeTickFormat=a.generateTimeTickFormatter(a.parent.getPrimaryDateFormat())):d=
a.ordinalAxis?d3.scale.ordinal():d3.scale.linear();a.scales.x=d;b.x=d3.svg.axis().orient(c?"left":"bottom").scale(d).tickFormat(a.tickFormat).tickPadding(a.labelPad);b.x.isPrimary=!0;b.x.horizontal=!c;b.x.scaled=a.scaleXAxis;b.x.isOrdinal=a.ordinalAxis;b.x.isTime=a.timeAxis;_.each(a.seriesByAxis,function(d,e){var h=a.scales[e]=d3.scale.linear().nice().clamp(!0),f="y"===e;b[e]=d3.svg.axis().tickFormat(a.tickFormat).orient(c?f?"bottom":"top":f?"left":"right").tickPadding(a.labelPad).scale(h);$.extend(b[e],
{horizontal:!!c,isValue:!0,isMain:f})});_.each(b,function(c,d){c._id=d;c.tx=a.parent.g.append("g").addClass("gfx-ticks gfx-font-size gfx-axis-"+d);c.isOrdinal&&c.tx.addClass("gfx-axis-ordinal");var h=c.orient(),f="bottom"===h?h:"top";c.label=$("<div>").prependTo(a.createAxisLabelParent(f)).addClass("gfx-axis-label gfx-font-size gfx-axis-label-"+d).addClass(a.rotate?"rotated":"not-rotated");c.isValue&&(c.tx.addClass("gfx-hl-axis"+(!c.isMain&&b.y?" gfx-axis-extra":"")),c.label.addClass("gfx-hl-axis"),
c.flipped=a.isFlipped(),c.scaled=a.scaleYAxis);a.gridSpaceManager.register(h,function(){var b=a.labelPad,b=!c.isValue&&a.$ordinal?b+a.$ordinal["outer"+(c.horizontal?"Height":"Width")]():b+c.tx.dim()[c.horizontal?1:0];return b+=Math.max(0,a.getTickSize(c))})});this.axes=b},createAxisLabelParent:function(a){var b=this.$labels[a];if(b)return b;b=$("<div>").addClass("gfx-axis-labels gfx-axis-labels-"+a+" clearfix");"top"===a?b.prependTo(this.parent.$pane):b.appendTo(this.parent.$pane);this.parent.spaceManager.register(a,
function(){return b.outerHeight()});return this.$labels[a]=b},getAxisOverflow:function(a){var b=a.scale();if(!b.ticks)return 0;var c=b.ticks(this.getNumTicks(a)),d=this.parent.flipY&&a.isValue?"first":"last",c=b(_[d](c)),d=a.tx.jq().find(".tick:"+d+" text");if(a.horizontal)return a=d3.max(b.range())-c,Math.max(Math.floor(d.width()/2)-a,5);a=d3.min(b.range())-c;return Math.max(Math.floor(d.height()/2)+a,0)},setDomains:function(){var a=this,b,c=a.scales.x,d=(a.ordinalAxis?a.parent.uniqueField:null)||
a.primaryField;this.parent.timeField?(a.uniquePrimary=_.uniq(a.parent._data,!1,d),d=_.pluck(a.uniquePrimary,d)):d=_.pluck(a.parent.data,d);a.timeAxis?c.domain(a.getTimeAxisDomain(d)):a.ordinalAxis?c.domain(d):(b=a.getNumericAxisDomain(a.axes.x,d3.extent(d)),c.domain(b));_.each(a.seriesByAxis,function(c,d){var h=a.getExtentForSeries(c);b=a.getNumericAxisDomain(a.axes[d],h);a.scales[d].domain(b)});return a},getExtentForSeries:function(a){if(a[0].stack===FTB.Chart.STACK_FULL)return[0,1];if(this.parent.player){var b=
_.pluck(a,"valueField"),c=a[0].stack?d3.sum:d3.max;a=_.map(this.parent._data,function(a){return c(_.filter(_.pick(a,b)))})}else a=d3.merge(_.map(a,function(a){return a.disabled?[]:a.getExtent()}));return d3.extent(a)},isFlipped:function(){return this.rotate?!this.parent.flipY:this.parent.flipY},getTimeThreshold:function(a){return this.hasChartType(FTB.Chart.BAR)?"%Y"===a?10:4:-1},getNumericAxisDomain:function(a,b){if(!b[0]&&!b[1])return[0,1];a.stack===FTB.Chart.STACK_FULL&&(b[1]=Math.min(b[1],1));
var c,d=b[0];c=b[1];var g=$.isNumeric(a.min)?+a.min:-Infinity,e=$.isNumeric(a.max)?+a.max:Infinity;a.scaled||a.isPrimary||(d=Math.min(b[0],0),c=Math.max(b[1],0));var h=Math.abs(b[1]-b[0]||b[0]),f=0;a.scaled?f=h*(this.extentPad||0.1):a.isPrimary||(f=0.5*(c-d)-0.4*h);c=[-this.limitDomain(-d,-g,f,a.scaled),this.limitDomain(c,e,f,a.scaled)];a.isValue&&0<d&&0>c[0]&&(c[0]=0);a.flipped&&(c=c.reverse());return c},limitDomain:function(a,b,c,d){if(0===a)return a;a=parseFloat(a.toPrecision(10));c=a+c;return Infinity===
b||a>b&&1.01<a/b||!(c>b||!d&&30<a/b)?c:b},update:function(){var a=this,b=a.parent.getSVGWidth(),c=a.parent.getSVGHeight();a.resizeFonts();a.parent.g.classed("gfx-msr",!0);a.resizeScales(b,c);_.each(a.valueAxes(),a.updateAxisTicks,a);var d=a.getGridPad();a.rotate?a.gridHeight=Math.floor(c-d.top-d.bottom):(a.gridWidth=Math.floor(b-d.right-d.left),a.ordinalAxis&&a.resizeScales(a.gridWidth,c));_.each(a.primaryAxes(),a.updateAxisTicks,a);a.rotate&&a.ordinalAxis&&(d=Math.ceil(a.parent.getNumPoints()*a.tickFontSize*
1.8),d>a.parent.h&&(a.parent.dynamicHeight=c=d,a.parent.allowDynamicHeight||a.parent.$paneInner.height(a.parent.getInnerPaneHeight()).addClass("gfx-pane-overflow"),a.parent.resizeSVG()));d=a.getGridPad();a.gridWidth=b-d.right-d.left;a.gridHeight=c-d.top-d.bottom;b=_(a.axes).filter("horizontal").map(a.getAxisOverflow,a).max().value();c=_(a.axes).reject("horizontal").map(a.getAxisOverflow,a).max().value();a.gridWidth-=b;a.gridHeight-=c;a.parent.g.classed("gfx-msr",!1);_.each(a.axes,function(b){b.tickSize(a.getTickSize(b))});
a.resizeScales(a.gridWidth,a.gridHeight);_.each(a.axes,a.updateAxisTicks,a);a.parent.g.attr("transform","translate("+d.left+","+(d.top+c)+")");_.each(a.axes,function(b){var c=b.orient(),d="right"===c?a.gridWidth:0,c="bottom"===c?a.gridHeight:0;(d||c)&&b.tx.attr({transform:"translate("+d+","+c+")"})});a.baseline||(a.baseline=a.parent.g.append("line").classed("gfx-baseline",!0));a.baseline.attr({x1:0,x2:a.parent.rotate?0:a.gridWidth,y2:a.gridHeight,y1:a.parent.rotate?null:a.gridHeight});a.ordinalOffset=
a.ordinalAxis?a.scales.x.rangeBand()/2:0;a.renderedOnce=!0;return a},hasChartType:function(a){return!!_.find(this.parent.seriesGroups,{type:a})},getTickSize:function(a){var b=this.hasChartType(FTB.Chart.SCATTER),c=this.hasChartType(FTB.Chart.BAR);return a.isValue||b?/left|right/.test(a.orient())?-this.getEstimatedWidth():-this.getEstimatedHeight():a.isOrdinal?this.useResponsiveTicks||!c?7:0:7},updateAxisLabels:function(){_.each(this.axes,this.updateAxisLabel,this)},updateAxisLabel:function(a,b){var c=
a.label;c.html(c.content=this.getAxisLabel(b));a.isValue?this.isAxisEnabled(b)?c._show=!1!==this.showValueLabel&&!!c.content:c._show=!1:c._show=!!this.showPrimaryLabel&&!!c.content;c.showIf(c._show)},isAxisEnabled:function(a){return!!_.reject(this.seriesByAxis[a],"disabled").length},updateAxisTicks:function(a,b){var c=this,d=a.tx,g="x"===b,e=c.ordinalAxis&&g,h=c.timeAxis&&g;e||a.ticks(c.getNumTicks(a));if(!g&&!c.isAxisEnabled(b))return null;c.currentAxis=a;d.trans(c.parent.animate&&c.renderedOnce?
1E3:0,0).call(a);e&&(c.$ordinal&&c.$ordinal.remove(),c.rotate||c.setOrdinalTickSize(),c.$ordinal=c.buildOrdinalTicks(),c.bindTickEvents(),c.parent.$paneInner.append(c.$ordinal),c.rotate&&c.setOrdinalTickSize(),c.resizeOrdinal());e&&(d.classed("gfx-ord-responsive",!!c.useResponsiveTicks),d.selectAll("line").each(function(a,b){var d=!!_.find(c.ticksShown,{index:b});d3.select(this).classed("gfx-hidden",!d)}));if(h){var f=d3.extent(c.tickLevels);f[0]!==f[1]&&c.axes.x.tx.selectAll(".tick").each(function(a,
b){d3.select(this).classed("gfx-tick-major",c.tickLevels[b]===f[1])});c.tickLevels=[]}return c},getNumTicks:function(a){var b,c,d;d=(b=a.horizontal)?this.getEstimatedWidth():this.getEstimatedHeight();c="tickScale"+(b?"H":"V");b=this[c]=this[c]||d3.scale.linear().domain(b?[200,2E3]:[100,600]).range([4,b?16:10]).clamp(!0);d=Math.floor(b(d));if(a.integer&&a.stack!==FTB.Chart.STACK_FULL&&!a.isTime)for(;1<d&&_.find(a.scale().ticks(d),_.isFloat);)d--;return a.isPrimary&&"%Y"===this.parent.getPrimaryDateFormat()?
Math.min(d,this.parent.getNumPoints()):d},valueAxes:function(){return _.omit(this.axes,"x")},primaryAxes:function(){return _.pick(this.axes,"x")},getAxisFormatOptions:function(a){a.isValue?(a=_.pluck(this.seriesByAxis[a._id],"valueField"),a=_.values(_.pick(this.parent.fields,a))):a=[this.parent.getPrimaryField()];return{prefix:k(a,"prefix"),suffix:k(a,"suffix"),integer:k(a,"integer"),commas:k(a,"addCommas"),max:k(a,"max")}},getAxisLabel:function(a){var b="x"===a,c=this.axes[a];a=b?_.values(this.seriesByAxis)[0]:
this.seriesByAxis[a];var d=a[0][(b?"primary":"value")+"Field"],d=this.parent.fields[d],g=c.prefix||"",c=c.suffix||"",d=d.name||"",e=[];2<g.length?e.push($.trim(g)):2<c.length&&e.push($.trim(c));e=e.join("/");if(!b&&1<_.size(a))return 0>e.indexOf("/")?e.capitalize():e;e&&(d+=" ("+e+")");return d},bindTickEvents:function(){var a=this;this.$ordinal.on("mouseleave",".gfx-lnk",function(){a.parent.highlight(!1)}).on("mouseenter",".gfx-lnk",function(b){a.parent.popEvt=b;a.parent.highlight({row:$(this).data("row")})}).on("click",
".gfx-lnk",function(){var b=+$(this).data("index");a.parent.onItemClicked(a.parent.data[b])});this.$ordinal.find("img").on("error",p)},buildOrdinalTicks:function(){var a=this,b='<div class="gfx-ord-tx nosel">',c,d,g,e;if(a.parent.noOrdinalTicks)return $(b+"</div>");var h=a.uniquePrimary||a.parent.data;a.ticksShown||(a.ticksShown=a.getOrdinalTickArray());_.each(a.ticksShown,function(f,k){var l=h[f.index],l=l||{};c=a.tickImages?l[a.parent.imageField]:null;g=a.tickNoText?"":f.label;d='data-index="'+
k+'" data-row="'+l.id+'"';e="";f.width&&(e="width:"+f.width+"px;");if(void 0!==f.translateX){var m="transform:translateX("+f.translateX+"px);";e+=m+"-webkit-"+m+"-moz"+m}b+='<div class="gfx-ord-tick gfx-ord-tick-'+l.id+' gfx-hl-dim gfx-lnk" '+d+' style="'+e+'">'+(c?'<div class="gfx-ord-img"><img src="'+c+'"/></div>':"")+(g?'<div class="gfx-ord-text">'+g+"</div>":"")+"</div>"});var f=$(b+"</div>");a.rotate&&f.addClass("gfx-ord-rotate");a.useResponsiveTicks&&f.addClass("gfx-ord-responsive");return f},
resizeOrdinal:function(){var a=this.$ordinal,b=a.find("img"),c=a.find(".gfx-ord-text");this.rotate?(a.width(this.tickWidth).children().height(this.tickStep),c.css("line-height",this.tickStep+"px")):a.width(this.tickSpace);if(!this.tickNoText){var d=this.tickSpace/a.text().length;c.css("font-size",this.tickFontSize-(5>d)+(3>d))}this.tickImages&&(b.css({maxWidth:this.tickImageSize,maxHeight:this.tickImageSize}),a.find(".gfx-ord-img").height(this.tickImageSize));a.css({top:this.gridPad.top+(this.rotate?
this.tickOffset:this.gridHeight+10),left:this.gridPad.left+(this.rotate?-this.tickWidth-this.labelPad:this.tickOffset)})},getGridPad:function(){return this.gridPad=$.extend({top:0,right:0,bottom:0,left:0},this.gridSpaceManager.calculate())},getEstimatedWidth:function(){return this.gridWidth||this.parent.getSVGWidth()},getEstimatedHeight:function(){return this.gridHeight||this.parent.getSVGHeight()},setOrdinalTickSize:function(){var a=this,b=a.axes.x.scale(),c=b.domain(),d=a.$ordinal,g=a.getNumOrdinalValues(),
e=a.rotate?a.getEstimatedHeight():a.getEstimatedWidth(),h=a.tickStep=1<c.length?b(c[1])-b(c[0]):b.rangeBand();a.tickOffset=Math.round((e-g*h)/2);a.tickSpace=e-2*a.tickOffset;a.tickImageSize=!a.rotate&&Math.min(80,Math.floor(0.95*h));a.tickImages=!a.rotate&&a.parent.imageField&&20<a.tickImageSize;a.tickWidth=a.rotate?Math.min(d.outerWidth(),0.4*a.parent.w):h;b=a.getOrdinalTickArray();c=!1;a.rotate||(a.measureTicks(b),c=!!_.find(b,function(a){return a.width>h||5<a.lines}));a.tickNoText=!a.rotate&&c&&
a.tickImages;a.rotate||a.tickNoText||!c?(_.each(b,function(b){b.width=a.tickWidth}),a.ticksShown=b):a.ticksShown=a.selectShownTicks(b,a.tickSpace,h);a.useResponsiveTicks=a.ticksShown.length!==g},getOrdinalTickArray:function(){return _.map(this.getOrdinalTickValues(),function(a,b){return{label:a,index:b}})},getOrdinalTickValues:function(){var a=_.pluck(this.uniquePrimary||this.parent.data,this.primaryField),b=this.parent.fields[this.primaryField];"date"===b.type&&(a=_.map(a,function(a){return b.formatDate(a)}));
return a},getNumOrdinalValues:function(){return this.parent.timeField?_.size(this.uniquePrimary):this.parent.getNumPoints()},measureTicks:function(a){var b=this.$ghost=this.$ghost||$("<div/>").addClass("gfx-ord-test gfx-hidden").appendTo("body");b.width(this.tickStep).css({fontSize:this.tickFontSize}).html(_.mapToString(a,function(a){return'<div class="gfx-ord-test-tick">'+a.label+"</div>"})).show();var c=parseInt(b.css("line-height").replace("px",""),10);b.children().quickEach(function(b){a[b].lines=
this.height()/c;a[b].width=2>=a[b].lines?this[0].scrollWidth:Math.max(100,this[0].scrollWidth)});b.hide()},selectShownTicks:function(a,b,c){var d=_.size(a)-1,g=Math.floor(b-_.last(a).width),e=0,h=0,f=0;_.each(a,function(a,b){0===b?a.shown=!0:b===d?(a.shown=!0,e=g):(e=Math.floor(c*(b+0.5)-a.width/2),e>=h&&e+a.width<g&&(a.shown=!0));a.shown&&(a.translateX=e-f,h=e+a.width,f+=a.width)});return _.filter(a,"shown")},resizeScales:function(a,b){var c=this;c.rotate&&(a=[b,b=a][0]);c.ordinalAxis?c.scales.x.rangeRoundBands([0,
a],0.08):c.scales.x.range([0,a]);_.each(c.valueAxes(),function(a){a.scale().range(c.flipY?[0,b]:[b,0])})},resizeFonts:function(){this.fontScale||(this.fontScale=d3.scale.linear().clamp(!0).domain([600,2E3]).rangeRound([13,20]));var a=this.tickFontSize=this.fontScale(Math.min(this.parent.h,this.parent.w));this.parent.g.selectAll(".gfx-font-size").style("font-size",Math.floor(a)+"px")},highlight:function(a){this.parent.g.selectAll(".gfx-axis-label, .gfx-ticks").removeClass("gfx-hl-sel");if(a){var b=
[];a.series?(b=_.find(this.parent.series,{seriesId:""+a.series}).axis,b=[".gfx-axis-label-"+b,".gfx-axis-"+b]):a.row&&b.push(".gfx-axis-label",".gfx-ticks");this.parent.g.selectAll(b.join(",")).addClass("gfx-hl-sel")}this.ordinalAxis&&this.parent.$el.find(".gfx-ord-tx, .gfx-ord-tick").removeClass("gfx-hl-sel").end().find(a&&a.row?".gfx-ord-tick-"+a.row:".gfx-ord-tx").addClass("gfx-hl-sel")},getTimeAxisDomain:function(a){var b=null;_.each(this.parent.seriesGroups,function(c){if(c.getDateExtent)return b=
c.getDateExtent(a),!1});return b||this.getDateExtent(a)},getDateExtent:function(a){1===a.length&&(a=this.createRangeFromDate(a[0]));return d3.extent(a)},createRangeFromDate:function(a){for(var b=[],c=1,d=n(this.parent.useUTC),g=0,e=d[g];!e[1](a);)c*=e[2],e=d[++g];c*=e[2];_.each([-1,1],function(d){b.push((new Date).setTime(a.getTime()+d*c))});return b},generateTimeTickFormatter:function(a){return"%b"===a||"%B"===a?this.parent.getD3TimeFormat()(1E3<=this.gridWidth?"%B":"%b"):this.getCustomTimeFormatter(n(this.parent.useUTC))},
getCustomTimeFormatter:function(a){var b=this.parent.getD3TimeFormat().multi(a),c=this;return function(d){var g=_(a).pluck(1).findIndex(function(a){return a(d)});c.tickLevels.push(g);return b(d)}},tickFormat:function(a){var b=this.currentAxis;return b.isValue?this.numberTickFormat(a,b):this.timeAxis?this.timeTickFormat(a):this.ordinalAxis?a:this.numberTickFormat(a,b)},numberTickFormat:function(a,b){if(b.stack===FTB.Chart.STACK_FULL)return 100*a+"%";a=parseFloat(a.toFixed(10),10);if(1>Math.abs(a)&&
0.01<=Math.abs(a)||!1===b.commas)a=d3.format("")(a);else{var c=d3.formatPrefix(a),d=c.symbol;"G"===d&&(d=tt("B"));a=c.scale(a)+(d?d:"")}c=b.prefix;d=b.suffix;c=c&&2>=c.length?c:"";d=d&&2>=d.length?d:"";return this.parent.formatValue(a,c,d)},initZoom:function(){var a=this,b=!1;if(a.ordinalAxis||a.parent.getNumPoints()<FTB.Chart.ZOOM_DATA_MIN||a.rotate||a.parent.isPreview||a.parent.player)a.zoomType=FTB.Chart.ZOOM_NONE;if(!a.zoomType)return this;a.parent.addToolbarOption('<div class="gfx-icon-mag"><span class="i icon-zoom-in"></span></div>',
function(){b=!b;$(this).toggleClass("bg-blue",b);EVT(["Visualization","Toggled "+(b?"on":"off")+" zoom icon",FTB.page_type,time_on_site(),!1]);a.toggleBrush(b);!b&&a.preview&&a.togglePreview(!1)});a.on("brushstart",function(){a.parent.highlight(!1);a.parent.pop&&a.parent.pop.hide();a.parent.disablePop=!0});a.on("brushend",function(b,d){a.clearSelectedData();a.resetBrush();a.parent.disablePop=!1;a.zoomAndRefreshData(d)&&(a.buildPreview(),a.previewChart.axes.setPreviewBrush(d));b&&EVT(["Visualization",
"Zoomed on graph",FTB.page_type,time_on_site(),!1])})},zoomAndRefreshData:function(a){var b=this;b.preZoomData||(b.preZoomData=b.parent.data);if(a){if(a=b.filterDataByRect(b.preZoomData,a),!a.length)return!1}else a=b.preZoomData,b.preZoomData=null;_.each(b.valueAxes(),function(a){a.scaled=b.preZoomData?!0:b.scaleYAxis});b.parent.data=a;b.parent.processData();b.setDomains();b.parent.update();b.update();return!0},toggleBrush:function(a){(a?this.enableBrush:this.disableBrush).call(this)},disableBrush:function(){this.isBrushing=
!1;this.brush&&(this.resetBrush(),this.parent.$el.find(".gfx-brush").hide())},enableBrush:function(){this.isBrushing=!0;this.brush?this.parent.$el.find(".gfx-brush").show():this.buildBrush()},resetBrush:function(){var a=!this.brush.y(),b=a?this.gridHeight:0,c=[0,0];this.brush.extent(a?c:[c,c]);this.brushExtent&&this.brushExtent.attr({width:0,height:b})},reBrush:function(){this.brush&&(this.brushGroup.call(this.brush),this.brush.y()||this.brushGroup.selectAll(".background,.extent,.e>rect,.w>rect").attr("height",
this.gridHeight))},buildBrush:function(){var a=this,b=this.brush=d3.svg.brush().x(a.scales.x);a.zoomType===FTB.Chart.ZOOM_XY&&b.y(a.scales.y);b.on("brushstart",function(){a.isBrushing&&(a.trigger("brushstart"),$d.on("keydown.gfx-selbox",function(b){27===b.keyCode&&(a.disableBrush(),a.clearSelectedData())}))}).on("brush",function(){a.isBrushing&&(a.clearSelectedData(),a.getPointsInRect(b.extent()).classed("gfx-drag-sel",!0))}).on("brushend",function(){a.isBrushing&&(a.trigger("brushend",a.getSelectedData(),
b.extent()),a.clearSelectedData(),$d.off("keydown.gfx-selbox"))});var c=this.brushGroup=a.parent.g.append("g").classed("gfx-brush",!0);this.reBrush();this.brushExtent=c.select(".extent");return this},clearSelectedData:function(){this.parent.svg.selectAndRemoveClass("gfx-drag-sel")},getSelectedData:function(){return this.parent.svg.selectAll(".gfx-drag-sel").data()},getPointsInRect:function(a){a=this.filterDataByRect(this.parent.data,a);var b=_.pluck(a,"id");return this.parent.svg.selectAll(".gfx-point").filter(function(a){return-1!==
b.indexOf(a.id)})},filterDataByRect:function(a,b){var c=this.parent.series[0],d=c.primaryField,g=c.valueField;return _.isArray(b[0])?_.filter(a,function(a){return a[d]>=b[0][0]&&a[d]<=b[1][0]&&a[g]>=b[0][1]&&a[g]<=b[1][1]}):_.filter(a,function(a){return a[d]>=b[0]&&a[d]<=b[1]})},buildPreview:function(){var a=this,b;if(a.isPreview||a.preview)return this;b=$('<div class="gfx-pview bbx"><div class="gfx-pview-tglr rsaquo">&rsaquo;</div><div class="gfx-ctrl"><div class="gfx-ctrl-reset stnd-btn">'+tt("Reset")+
"</div></div></div>");a.preview=b.appendTo(a.parent.$tbar);a.previewState=!0;b.on("click",".gfx-ctrl-reset",function(){b.removeClass("active");a.zoomAndRefreshData();setTimeout(function(){a.preview.remove();a.parent.$el.off("mouseleave.gfx-preview");delete a.preview},500);EVT(["Visualization","Reset zoom on graph",FTB.page_type,time_on_site(),!1])}).on("click",".gfx-pview-tglr",function(){a.togglePreview()});setTimeout(function(){b.addClass("active")},1);a.parent.$el.one("mouseleave.gfx-preview",
function(){a.togglePreview(!1)});a.previewChart=new a.parent.constructor($.extend(a.parent._o,{$el:b,w:b.width(),h:b.height(),disablePop:!0,showPrimaryLabel:!1,showValueLabel:!1,scaleYAxis:a.scaleYAxis,isPreview:!0,parentChart:a.parent,annotations:null}));a.previewChart.update();return this},togglePreview:function(a){void 0===a&&(a=!this.previewState);this.previewState=a;this.preview.toggleClass("hide-pview",!a).find(".gfx-pview-tglr").html(a?"&rsaquo;":"&lsaquo;")},setPreviewBrush:function(a){var b=
this;b.brush||(b.buildBrush(),b.brush.on("brushend",function(){b.parent.parentChart.axes.zoomAndRefreshData(b.brush.extent())}));b.brush.extent(a);b.reBrush()}}).mixin(_.Events);FTB.module("FTB.ChartAxes",q)})();
;
(function(c){c=c.Class.extend({init:function(a){$.extend(this,a,{height:30,playing:!1,duration:800});_.bindAll(this,"play","onPlay");this.update=_.debounce(this.update,50);this.build();this.listenTo(this.parent,"resize",this.resize)},build:function(){var a=this,b=this.scale=this.getScale(),e=this.brush=d3.svg.brush().x(b).extent([0,0]).on("brush",function(){var d=e.extent()[0];d3.event.sourceEvent&&(d=b.invert(d3.mouse(this)[0]),e.extent([d,d]),a.toggle(!1));var c=a.ordinal?Math.round(d):_.sortedIndex(a.groupedKeys,
d);a.current=c;a.setText(c);a.$handle.css("left",b(d));a.update(c)}),d=this.$slider=$('<div class="gfx-slider"><div class="relative"><div class="gfx-slider-play stnd-btn"><i class="icon-play"></i></div><div class="gfx-slider-track"><svg class="gfx-slider-brush" height="'+this.height+'"></svg><div class="gfx-slider-bg bbx"></div><div class="gfx-slider-handle bbx"></div></div><div class="gfx-slider-text-wrap"><div class="gfx-slider-text"></div><div class="gfx-slider-text-ghost"></div></div></div></div>');
this.$play=d.find(".gfx-slider-play").click(this.onPlay);this.$handle=d.find(".gfx-slider-handle");this.$textWrap=d.find(".gfx-slider-text-wrap");this.$text=d.find(".gfx-slider-text");this.$ghost=d.find(".gfx-slider-text-ghost");var c=this.brushGroup=(this.brushSVG=d3.select(d.find("svg")[0])).append("g").call(e);c.selectAll(".extent,.resize").remove();c.select(".background").attr("height",this.height).style("cursor","pointer");a.toggle(!1);d.appendTo(this.parent.$el);a.parent.spaceManager.register("bottom",
function(){return a.$slider?a.$slider.outerHeight():0})},setData:function(a){this.groupedData=_.groupBy(a,this.field.key);this.groupedKeys=this.getKeys(this.groupedData);this.setDomain();this.setTextSize();this.setText(0);this.setCurrentIndex(0)},getKeys:function(a){var b=this.field.type;a=_.keys(a);"date"===b&&(a=_.map(a,function(a){return new Date(a)}));return a},setTextSize:function(){var a=_(this.groupedKeys).map(this.getFormattedValue,this);this.$ghost.html(a.value().join("<br/>"));a=20<a.map("length").max().value()?
13:20;this.$textWrap.css({fontSize:a})},setDomain:function(){var a=this.field.type,b=this.groupedKeys,b="date"===a||"number"===a?d3.extent(b):[0,b.length-1];this.scale.domain(b)},getFormattedValue:function(a){"date"===this.field.type&&(a=this.field.formatDate(new Date(a)));return a},setText:function(a){this.currentValue=a=this.getFormattedValue(this.groupedKeys[a]);this.$text.html(a)},getScale:function(){var a=this.field.type;if("date"===a)return this.parent.getD3TimeScale()().clamp(!0);"number"!==
a&&(this.ordinal=!0);return d3.scale.linear().clamp(!0)},resize:function(){var a=this.parent.w-this.$play.outerWidth()-this.$textWrap.outerWidth()-20;this.brushSVG.attr("width",a);this.scale.range([0,a-this.$handle.outerWidth()]);this.brushGroup.call(this.brush)},play:function(){var a=this,b=a.current,b=void 0===b?a.groupedCurrent:b;if(b>=a.groupedKeys.length||!a.playing)a.toggle(!1);else{a.setCurrentIndex(b,!0);var c=b;setTimeout(function(){a.setText(c);a.$handle.css("left",a.scale(a.ordinal?c:a.groupedKeys[c]))},
0.4*a.duration);a.current=++b;setTimeout(a.play,a.duration)}},onPlay:function(){this.toggle(!this.playing);this.playing&&this.current>=this.groupedKeys.length-1&&(this.current=0);this.parent.highlight(!1);setTimeout(this.play,100)},toggle:function(a){this.playing=!!a;this.$play.find("i").attr("class","icon-"+(a?"pause":"play"))},update:function(a){this.setCurrentIndex(a,!0)},setCurrentIndex:function(a,b){this.current=a;this.parent.data=this.groupedData[this.groupedKeys[a]];b&&this.parent.processData().update().rehighlight()}}).mixin(_.Events);
FTB.module("FTB.ChartPlayer",c)})(window);
;
(function(){var m=FTB.Chart,f=window.Class.extend({init:function(a){$.extend(this,a);this._o=$.extend({},a);this.parent.axesRequiredForType(this.type)&&!this.axis&&(this.axis="y");!this.name&&this.valueField&&(this.name=this.parent.fields[this.valueField].name);void 0===this.seriesId&&(this.seriesId=_.uniqueId())},processData:function(){var a=this,b=a.primaryField,c=a.valueField,d=a.sizeField,e=a.labelField,k=a.colorField,n=a.parent.uniqueField,r=a.getPrimaryScale(),s=a.getValueScale(),t=a.colorScale,
q=a.latitudeField,f=a.longitudeField,l=[],h;_.each(a.parent.data,function(g,p){h={p:g[b],ps:r,c:k?g[k]:a.color,cs:t,id:g.id,i:p,series:a,_annotation:g._annotation};if(c){if("number"!==typeof g[c]){if(!a.stack&&a.type!==m.DONUT)return;h.v=0}else h.v=g[c];h.vs=s}n&&(h.u=g[n]);d&&(h.s=g[d]);q&&f&&(h.latf=g[q],h.lonf=g[f]);e&&(h.l=g[e]);l.push(h)});a.data=l;a.setDomains()},getPrimaryScale:function(){return this.axis?this.parent.axes.scales.x:null},getValueScale:function(){return this.axis?this.parent.axes.scales[this.axis]:
null},getPopFields:function(){return _.filter([this.valueField,this.colorLabelField||this.colorField])},getLegendItem:function(){if(this.isDiscreteColorField())return this.getDiscreteLegendItems();if(!this.isExplicitColorField()){var a=this.colorScale&&this.colorScale.range?this.colorScale.range():this.color,b=this.colorField?this.parent.fields[this.colorField].name:this.name;return a&&b?{id:this.seriesId,type:"series",color:a,label:b,interactive:!1!==this.interactiveLegend,scale:this.colorScale}:
null}},getDiscreteLegendItems:function(){var a=this.getDiscreteFieldInfo();return _.map(a.values,function(a,c){return{id:c,type:"discrete",label:a.label,color:a.color,interactive:!1}})},getExtent:function(){return _.pluck(this.data,this.stack?"s1":"v")},getColorDomainData:function(){return this.parent.timeField?_.pluck(this.parent._data,this.colorField):_.pluck(this.data,"c")},setDomains:function(){var a=this.colorScale;if(a&&a.domain){var b=this.getColorDomainData();b.sort(d3.ascending);var b=_(b).uniq(!0).filter(_.isNumber).value(),
c=a.range().length,d;if(gatekeeper("Charts: new legends")){var e=b[0],k=b[b.length-1];d=(k-e)/(c-1);c=d3.range(e,k+d/2,d)}else d=(b.length-1)/(c-1),c=d3.range(0,c).map(function(a){return b[Math.round(a*d)]});a.domain(c)}},isDiscreteColorField:function(){return this.colorField?this.colorLabelField?!0:"text"===this.getColorType():!1},isExplicitColorField:function(){return"color"===this.getColorType()&&!this.colorLabelField},getColorType:function(){return this.colorField?this.parent.fields[this.colorField].type:
null},getDiscreteColor:function(a){return this.getDiscreteFieldInfo().valueColors[a]||"#ccc"},getDiscreteFieldInfo:function(){if(this.__discreteFieldCache)return this.__discreteFieldCache;var a=this.colorField,b=this.colorCallback,c=this.colorLabelField,d=c||a,e=_(this.parent.timeField?this.parent._data:this.parent.data).uniq(d).filter(d).value(),k=this.parent.getPalette(e),n=_.map(e,function(a,b){return k[b]||"#ccc"}),e=_.map(e,function(e,k){var f={label:e[d]};f.color=b?b(e[a]):c?e[a]:n[k];return f}),
f=_.zipObject(_.pluck(e,"label"),_.pluck(e,"color"));return this.__discreteFieldCache={values:e,valueColors:f}},getColorRange:function(){var a=this.parent.fields[this.colorField],b=-1===a.highGood,c=this.parent.theme;-2===a.highGood||c&&"default"!==c||(c="ryg");a=FTB.ChartTheme.getColors(c);if("ryg"===c?!b:b)a=a.slice(0),a.reverse();return a}}),l=window.Class.extend({init:function(a){$.extend(this,a);this.listenTo(this.parent,"update",this.update);this.listenTo(this.parent,"processData",this.processData);
this.highlight&&this.listenTo(this.parent,"highlight",this.highlight);this.useStack&&this.setStack()},reset:function(){this.series=[]},setAnnotationHandler:function(a){this._ah=a},setSeries:function(a){this.series=a;this.useStack&&this.stack!==a[0].stack&&this.setStack()},setStack:function(){this.stack=this.series[0].stack;this.stackLayout=this.getStackLayout()},setLayers:function(a){_.each(a,function(b,c){a[c]=$.extend({},{attr:{},attrStart:{},attrEnd:{},extraClass:""},b)});this.layers=a},update:function(){this.animate=
!1!==this.parent.animate;var a=this.activeSeries();this.preUpdate();this.updateGroups(a);_.each(this.layers,this.updateLayer,this)},updateLayer:function(a){var b=this,c=b.wrappers.selectAll("."+a.mainClass).data(function(b){return a.single?[b.data]:b.data},b.updateLayerJoin||function(c){return a.single?0:b.parent.uniqueField?c.u:c.l||c.p}),d=c.size()||1,e=this.animate?this.parent.timeField?500:1E3:0,d=Math.min(a.delay?Math.ceil(e/2/d):0,30);c.exit().trans(e,d).attr($.extend({},a.attr,a.attrExit)).remove();
b.updateLayerEnter(a,c);b.updateLayerEnd(a,c)},updateLayerEnter:function(a,b){return b.enter().append(a.type).each(function(b){var d=d3.select(this);b=_.isFunction(a.extraClass)?a.extraClass(b):a.extraClass;d.addClass(a.mainClass+" "+b);"linearGradient"===a.type&&(d.append("stop").attr("offset","0%").attr("stop-color",function(a){return a[0].c}),d.append("stop").attr("offset","100%").attr("stop-color","#fff"))}).attr($.extend({},a.attr,a.attrStart))},updateLayerEnd:function(a,b){var c=this.animate?
this.parent.timeField?500:1E3:0,d=b.size()||1,d=a.delay?Math.ceil(c/2/d):0;a.single||b.attr("data-row-id",_.createCallback("id"));b.trans(c,d).attr($.extend({},a.attr,a.attrEnd))},updateGroups:function(a){var b="gfx-srs-wrp-"+this.series[0].type;a=this.wrappers=this.parent.g.selectAll("."+b).data(a,function(a){return a.seriesId});a.exit().remove();a.enter().append("g").each(function(a){a.wrapper=d3.select(this);a.wrapper.addClass("gfx-srs-wrp "+b+" gfx-srs-"+a.seriesId)})},preUpdate:$.noop,activeSeries:function(){return _.reject(this.series,
"disabled")},getLegendSeries:function(){return this.series},getLegendItems:function(){return _(this.getLegendSeries()).invoke("getLegendItem").filter().value()},getStackLayout:function(){var a=this.stack,b=a?0:null,c=d3.layout.stack().values(function(a){var b=0;return _.map(d3.range(0,this.size),function(c,f){return(c=a.data[b])&&c.i===f?(b++,c):{p:f,v:null}})}).out(function(b,c,f){c=a?c:0;a===m.STACK_FULL&&0===b.v&&(f=0);b.sy=f;b.s0=c;b.s1=c+f}).x(_.createCallback(this.parent.uniqueField?"u":"p")).y(function(a){return null===
a.v?b:a.v});a===m.STACK_FULL?c.offset("expand"):a===m.STACK_CENTER&&c.offset("silhouette");return c},processData:function(){var a=this.activeSeries();_.each(a,function(a){a.processData()});this.useStack&&a.length&&(this.stackLayout.size=this.parent.getNumPoints(),this.stackLayout.series=a,this.stackLayout(a))},primaryPositionGetter:function(){var a=this.parent.axes.ordinalAxis,b=a&&this.parent.uniqueField,c=a?this.parent.axes.ordinalOffset:0;return function(a){return a.ps(b?a.u:a.p)+c}}}).mixin(_.Events),
p={applyTo:function(a){a.types={};a.define=this.define;a.create=this.create},define:function(a,b){this.types[a]=this.extend(b)},create:function(a){var b=this.types[a.type];if(b)return new b(a)}};p.applyTo(f);p.applyTo(l);FTB.module("FTB.ChartSeries",f);FTB.module("FTB.ChartSeriesGroup",l)})();
;
(function(){var h=FTB.Chart,l=FTB.ChartSeriesGroup;FTB.ChartSeries.define(h.BAR,{});l.define(h.BAR,{useStack:!0,init:function(c){this._super(c);this.setLayers({rect:{type:"rect",delay:!0,mainClass:"gfx-bar-point",extraClass:"gfx-point",attr:{fill:function(b){if(b._annotation){var c=window.textures.lines().strokeWidth(0.5).size(4).stroke("rgba(255,255,255,0.9)").background(b.cs(b.c));b.series.parent.svg.call(c);return c.url()}return(void 0!==b.c?b.cs(b.c):null)||"#ccc"},color:function(b){return(void 0!==
b.c?b.cs(b.c):null)||"#ccc"},opacity:1},attrExit:{opacity:0}}})},preUpdate:function(){var c=this.parent,b=c.uniqueField,e=c.maxBarWidth,f=this.activeSeries(),d=c.axes.isFlipped(),k=!!this.stack,m=k?1:_.size(f),n=this.getBandWidth(),g=m+0.1*(m-1),e=Math.max(Math.min(Math.floor(n/g),e||30),2),h=Math.floor((n-e*g)/2),g=Math.ceil(0.1*e),q=e+g,g=f[0]?f[0].getValueScale()(0):0,p={},l=function(a){var c=b?"u":"p",d=a[c];void 0===p[d]&&(p[d]=_.reduce(f,function(b,a){var e={};e[c]=d;return(a=_.find(a.data,
e))?(a.ni=b)+1:b},0));return m-p[d]},r=function(a){var d;d=c.axes.timeAxis?a.ps(a.p)-n/2:c.axes.ordinalAxis?a.ps(b?a.u:a.p):a.ps(a.p);d+=h;k||(d+=Math.floor(l(a)*q/2)+a.ni*q);return d},s=k?function(a){return a.vs(d?a.s0:a.s1)}:function(a){return 2>Math.abs(a.vs(a.sy)-a.vs(0))?a.vs(0)+((0<=a.sy?!d:d)?-2:0):a.vs(Math[d?"min":"max"](a.sy,0))},t=k?function(a){return Math.abs(a.vs(a.s0)-a.vs(a.s1))}:function(a){return Math.max(Math.abs(a.vs(a.sy)-a.vs(0)),2)};this.layers.rect.attrStart=this.attrs(r,g,
e,0,c.rotate);this.layers.rect.attrEnd=this.attrs(r,s,e,t,c.rotate)},attrs:function(c,b,e,f,d){return{x:d?b:c,y:d?c:b,width:d?f:e,height:d?e:f}},getDateExtent:function(c){for(var b=Infinity,e=Infinity,f=-Infinity,d=0;d<c.length;d++)d&&(b=Math.min(b,c[d]-c[d-1]||b)),e=Math.min(e,c[d]),f=Math.max(f,c[d]);Infinity===b&&(b=this.parent.axes.createRangeFromDate(new Date(e)),b=b[1]-b[0]);c=Math.ceil(b/2);this.dateMin=e-1.2*c;this.dateMax=f+1.2*c;this.dateRange=b;return[this.dateMin,this.dateMax]},getBandWidth:function(){var c=
this.parent,b=this.series[0].getPrimaryScale();return c.axes.timeAxis?b(this.dateRange+this.dateMin)-b(this.dateMin):c.axes.ordinalAxis?b.rangeBand():2}})})();
;
(function(){var f=FTB.Chart,g=FTB.ChartSeriesGroup;FTB.ChartSeries.define(f.LINE,{});g.define(f.LINE,{useStack:!0,crosshair:!0,init:function(a){this._super(a);var b={};a=a.series[0];var c=function(a){return(a[0]?a[0].series.color:null)||"#999"},d=function(a){return a.cs(a.c)};this.stack||(b.line={type:"path",mainClass:"gfx-ln-path",lineStart:d3.svg.line(),lineEnd:d3.svg.line(),single:!0,attr:{stroke:c,color:c}});a.area&&(a.stack&&this.parent.g.addClass("gfx-ln-stack"),a.stack||(b.gradient={type:"linearGradient",
mainClass:"gfx-ln-gradient",single:!0,attr:{id:function(a){return"area-gradient"+a[0].series.seriesId},gradientUnits:"userSpaceOnUse",x1:0,x2:0,y1:0,y2:this.parent.h}}),b.area={type:"path",mainClass:"gfx-ln-area",areaStart:d3.svg.area(),areaEnd:d3.svg.area(),single:!0,attr:{fill:a.stack?c:function(a){return"url(#area-gradient"+a[0].series.seriesId+")"}}});b.points={type:"circle",mainClass:"gfx-ln-point",extraClass:"gfx-point",attr:{fill:d,color:d},attrStart:{r:0.1}};this.setAnnotationHandler({enter:this.annotationEnter,
update:this.annotationUpdate});this.setLayers(b);this.parent.initProximityHover()},preUpdate:function(){var a=this.parent,b=a.axes.gridHeight,c=this.primaryPositionGetter(),d=function(a){return a.vs(a.s1)},e=this.layers.line;e&&(e.attrStart.d=e.lineStart.x(c).y(b),e.attrEnd.d=e.lineEnd.x(c).y(d));var e=this.layers.points,h=a.axes.gridWidth/30,a=this.pointsHidden=this.layers.area||a.getNumPoints()>h;e.attrStart.cy=b;e.attrEnd.r=this.pointRadius=a?0.1:4;e.attrEnd.cx=c;e.attrEnd.cy=d;if(a=this.layers.area)a.attrStart.d=
a.areaStart.x(c).y0(b).y1(b),a.attrEnd.d=a.areaEnd.x(c).y0(function(a){return a.vs(a.s0)}).y1(d)},highlight:function(a){this.highlighted&&(this.highlighted.attr("r",this.pointRadius),delete this.highlighted);var b=(a||{}).selection;b&&(b=b.filter("circle"),b.size()?this.highlighted=b.attr("r",4):b=!1);var c=this.crosshair&&this.getCrosshair();if(a=c&&b&&!this.parent.noProximity&&a&&(!a.series||a.row)){var b=b.attr("cx"),d=this.pointsHidden?0:100;c.front().trans(d,0).attr({x1:b,x2:b})}c&&c.classed("shown",
a)},getCrosshair:function(){var a=this.$crosshair;a||(a=this.$crosshair=this.parent.g.append("line").classed("gfx-crosshair t02",!0).attr("y2",this.parent.axes.gridHeight));return a},annotationEnter:function(a){var b=this,c=b.parent.axes.gridHeight;a.append("circle").classed("gfx-ann-circle-x",!0);a.append("circle").classed("gfx-ann-circle-pulse",!0);a.selectAll("circle").attr("cy",c).attr("r",4).attr("stroke","#e1e1e1");d3.select(a.select(".gfx-ann-circle-pulse")[0][0]).each(function(){var a=d3.select(this),
b=a.attr("r"),c=a.attr("stroke");(function k(){a=a.transition().duration(1500).attr("r",10).attr("stroke","#444").attr("stroke-width",5).attr("opacity",0).transition().duration(1).attr("stroke",c).attr("r",b).attr("opacity",1).each("end",k)})()});a.append("line").classed("gfx-ann-line",!0).attr("y2",c);a.each(function(){var a=d3.select(this);_.each(b.series,function(b){a.append("circle").classed("gfx-ann-line-circle",!0).attr("seriesId",b.seriesId).attr("r",3)})})},annotationUpdate:function(a){var b,
c,d;a.selectAll(".gfx-ann-line").attr("x1",function(a){return a.x}).attr("x2",function(a){return a.x});a.selectAll(".gfx-ann-circle-x, .gfx-ann-circle-pulse").attr("cx",function(a){return a.x});a.selectAll(".gfx-ann-line-circle").each(function(a){b=d3.select(this);d=b.attr("seriesId");(c=_.filter(a.seriesData,{sf:d})[0])&&b.attr("stroke",c.color).attr("cy",c.y).attr("cx",b.datum().x)})}})})();
;
(function(){var k=FTB.Chart,r=FTB.ChartSeriesGroup;FTB.ChartSeries.define(k.SCATTER,{getPopFields:function(){var a=[];this.primaryField!==this.labelField&&a.push(this.primaryField);a.push(this.valueField,this.sizeField,this.colorLabelField||this.colorField);return _.unique(_.filter(a))}});r.define(k.SCATTER,{init:function(a){this._super(a);$.extend(this.parent.axes,{showPrimaryLabel:!0,scaleXAxis:!0,scaleYAxis:!0,extentPad:0.08,zoomType:FTB.Chart.ZOOM_XY});this.r=d3.scale.linear().clamp(!0).rangeRound([5,
9]);a={};var c=this;a.points={type:"circle",mainClass:"gfx-sp-point",extraClass:"gfx-point",attr:{fill:function(a){var b=c.rgba(void 0===a.c?"#bbb":a.cs(a.c));return a._annotation?(b=window.textures.lines().strokeWidth(0.5).size(4).stroke("rgba(255,255,255,0.9)").background(b),a.series.parent.svg.call(b),b.url()):b},color:function(a){return c.rgba(void 0===a.c?"#bbb":a.cs(a.c))},stroke:function(a){return c.darken(void 0===a.c?"#bbb":a.cs(a.c))},cy:function(a){return a.vs(a.v)}},attrStart:{r:0},attrExit:{r:0}};
this.setLayers(a)},preUpdate:function(){var a=this,c=a.parent,d=a.layers.points;c.timeField||(d.attrStart.cx=c.axes.gridWidth/2,d.attrStart.cy=c.axes.gridHeight/2);d.attrEnd.cx=a.primaryPositionGetter();d.attrEnd.r=function(b){return a.r(b.s||0)}},update:function(){this._super();this.showTrendline(!!this.parent.trendline)},processData:function(){this._super();var a=this.activeSeries(),a=a[0].sizeField?d3.extent(_.pluck(a[0].data,"s")):[0,0];this.r.domain(a)},showTrendline:function(a){var c=this.line;
if(a){c||(c=this.line=this.parent.g.append("line").classed("gfx-tl",!0));var d=0,b=0,f=0,p=0,h=this.series[0],k=h.data,l=k.length;a=h.getPrimaryScale();for(var h=h.getValueScale(),q=a.domain(),m=h.domain(),n={},e=0,g;e<l;e++)g=k[e],d+=g.p,b+=g.v,f+=g.p*g.p,p+=g.p*g.v;f=(p-d*b/l)/(f-d*d/l);d=b/l-f*d/l;for(e=0;2>e;e++)b=q[e]*f+d,b<=m[1]&&b>=m[0]?n["x"+(e+1)]=a(q[e]):(b=b>m[1]?m[1]:m[0],n["x"+(e+1)]=a((b-d)/f)),n["y"+(e+1)]=h(b);c.front().attr(n).style({stroke:"#ccc"});return this}c&&(c.remove(),this.line=
null)},rgba:function(a){if(!this.rgba[a]){var c=d3.rgb(a);this.rgba[a]="rgba("+c.r+","+c.g+","+c.b+",0.6)"}return this.rgba[a]},darken:function(a){this.darken[a]||(this.darken[a]=d3.rgb(a).darker(0.5));return this.darken[a]}})})();
;
(function(){var f=FTB.Chart,k=FTB.ChartSeriesGroup;FTB.ChartSeries.define(f.HEAT_MAP,{init:function(a){this._super(a);this.setColorField(a.colorField||a.fields[0])},setColorField:function(a){this.colorField=a;this.colorScale&&this.colorScale.range(this.getColorRange())},getPopFields:function(){return[this.colorLabelField||this.colorField]}});k.define(f.HEAT_MAP,{init:function(a){var b=this;b._super(a);b.setLayers({rect:{delay:!0,attr:{fill:function(a){return a&&void 0!==a.c?a.cs(a.c):"#ccc"},color:function(a){return a&&
void 0!==a.c?a.cs(a.c):"#ccc"}}}});b.shapes=b.parent.map.g.selectAll(".shape").attr({fill:"#f6f6f6"});b.parent.$el.on("change",".gfx-lgnd-map-select",function(){b.series[0].setColorField($(this).val());b.series[0].processData();b.parent.setLegend().update()})},updateLayer:function(a){var b=this,c=b.series[0],e=c.data,d=b.shapes;d&&(b.parent.map.g.classed("gfx-srs-"+c.seriesId,!0),d.each(function(){var a=d3.select(this),c=a.attr("key"),c=(c=b.parent.map.keyIndexes[c])?e[+c]:{},d=a.datum()||{};c._shape=
d._shape||a.data();a.datum(c).attr("class","shape gfx-map-point"+(c?" gfx-point":"")).attr("data-row-id",c?c.id:"")}),c=a.delay?1E3/d.size():0,d.trans(b.animate?1E3:0,c).attr(a.attr),a.delay=!1,b.parent.map.update())},updateGroups:$.noop,getMinAndMax:function(){var a=this.series[0],b=a.colorLabelField||a.colorField,c,e,d,g,f;_.each(this.parent.data,function(a,h){c=a[b];if(_.isNumber(c)){if(!e||c<e)e=c,g=h;if(!d||c>d)d=c,f=h}});return[g,f]},getFormattedValue:function(a){var b=this.series[0],b=b.colorLabelField||
b.colorField,c=this.parent.data[a];a=this.parent.fields[b].suffix;b=this.parent.getDisplayValue(b,c[b],c);a&&1<a.length&&(b=b.replace(a,""));return b},getLegendSuffix:function(){var a=this.series[0],a=this.parent.fields[a.colorLabelField||a.colorField];return a.suffix&&1!==a.suffix.length?"("+a.suffix.trim()+")":void 0},getLegendItems:function(){var a=this,b=a.series[0],c=b.getLegendItem(),e=this.getMinAndMax(),d=b.colorLabelField||b.colorField;c.interactive=!1;gatekeeper("Charts: new legends")&&
!a.isDiscrete()&&(c=_.extend(c,{field:d,scale:b.colorScale,low:a.getFormattedValue(e[0]),high:a.getFormattedValue(e[1]),suffix:a.getLegendSuffix()}));b.fields&&1!==_.size(b.fields)?(c.label="",c.extras='<select class="gfx-lgnd-map-select">'+_.mapToString(b.fields,function(c){return'<option value="'+c+'"'+(c===b.colorField?" selected":"")+">"+a.parent.fields[c].name+"</option>"})+"</select>"):c.label=a.parent.fields[d].name;return[c]},isDiscrete:function(){var a=this.series[0];return"text"===this.parent.fields[a.colorLabelField||
a.colorField].type}})})();
;
(function(){var n=FTB.Chart,m=FTB.ChartSeries,p=FTB.ChartSeriesGroup,d=Math.PI;m.define(n.DONUT,{interactiveLegend:!1,init:function(a){a.showPopTitle=!1;this._super(a)}});p.define(n.DONUT,{init:function(a){var b=this;$.extend(a,_.pick(a.parent,["isPercentage","roundTo","order"]));a=$.extend({},{roundTo:0,isPercentage:0,label_x_padding:[-20,-30,-40],label_y_padding:[10,12,15],padding_x:60,padding_y:40},a);b._super(a);a={};var c=function(a){return"gfx-donut-label "+(a.series.skip||"")};a.arcs={id:"arcs",
type:"path",mainClass:"gfx-arc",extraClass:function(a){return a.series.isBuffer||a.series.isOther?"":"gfx-point"},attr:{fill:function(a){return a.series.isBuffer||!a.cs?"#ededed":a.cs(a.series.color)},color:function(a){return a.series.isBuffer||!a.cs?"#ededed":a.cs(a.series.color)}}};a.ticks={id:"ticks",type:"line",mainClass:"gfx-donut-label-tick",extraClass:c,attr:{transform:function(a){return"rotate("+(a.startAngle+a.endAngle)/2*(180/d)+")"}}};a.text={id:"labels",type:"text",mainClass:"gfx-donut-label-text",
extraClass:c,attr:{transform:function(a){a.textX=Math.cos((a.startAngle+a.endAngle-d)/2)*(b.outerRadius+14);a.textY=Math.sin((a.startAngle+a.endAngle-d)/2)*(b.outerRadius+14);return"translate("+a.textX+","+a.textY+")"},dy:function(a){a=(a.startAngle+a.endAngle)/2;var c=0;a>d/2&&a<1.5*d&&(c=b.label_y_padding[parseInt(b.roundTo,0)],a=Math.cos(a-d),c*=a);return c},dx:function(a){var c=(a.startAngle+a.endAngle)/2,e=0;c>=d&&(e=b.label_x_padding[parseInt(b.roundTo,0)],c=Math.sin(c-d),e*=c);a.series.isOther&&
(e-=10);return e},fill:"#4d4d4d"},attrStart:{transform:function(a){a.textX=Math.cos((a.startAngle+a.endAngle-d)/2)*(b.outerRadius+14);a.textY=Math.sin((a.startAngle+a.endAngle-d)/2)*(b.outerRadius+14);return"translate("+a.textX+","+a.textY+")"}}};b.initial=!0;b.setLayers(a);b.listenTo(b.parent,"resize",b.resize);b.arcGenerator=d3.svg.arc();b.resize()},resize:function(){var a=this.parent.$pane.outerHeight(),b=this.parent.$pane.outerWidth();this.outerRadius=Math.min(a/2-this.padding_y,b/2-this.padding_x);
this.innerRadius=3*this.outerRadius/5;this.lineY1=-this.outerRadius-3;this.lineY2=-this.outerRadius-8;this.arcGenerator.outerRadius(this.outerRadius).innerRadius(this.innerRadius);this.center();return this},center:function(){var a=this.parent.g,b=this.parent.$pane.outerHeight(),b="translate("+this.parent.$pane.outerWidth()/2+","+b/2+")";this.animate&&(a=a.transition().duration(1E3));a.attr("transform",b)},activeSeries:function(){return _.reject(this.donutSeries(this.showHidden||this.parent.featured&&
!this.parent.featuredShown),"disabled")},getLegendSeries:function(){var a=this.donutSeries();3>=this.series.length&&(a.reverse(),this.otherWedge&&a.push(a.shift()));return a},donutSeries:function(a){var b=this.series;a||(b=_.reject(b,"hidden"));if(this.bufferPercent){var c=this.getBufferSeries();$.extend(c.data[0],{perc:this.bufferPercent,startAngle:2*(1-this.bufferPercent/100)*d,endAngle:2*d});b.push(c)}this.otherWedge&&!a&&(a=this.getOtherSeries(),$.extend(a.data[0],this.otherWedge),b.push(a));
return b},getBufferSeries:function(){var a=this.bufferSeries;a||(a=this.bufferSeries=m.create({type:FTB.Chart.DONUT,name:"",isBuffer:!0,parent:this.parent}),a.data=[{cs:_.identity,c:"#ededed",series:a,id:"_buffer"}]);return a},getOtherSeries:function(){var a=this.otherSeries;a||(a=this.otherSeries=m.create({type:FTB.Chart.DONUT,name:"Other",isOther:!0,color:"#ededed",parent:this.parent}),a.data=[{cs:_.identity,c:"#ededed",series:a,id:"_other"}]);return a},processData:function(){this._super();this.processArcData()},
processArcData:function(){var a=this,b=a.series,c=1,l=[],f;if(a.order||10<b.length)b=b.sort(function(a,b){return b.data[0]&&a.data[0]?b.data[0].v-a.data[0].v:!1}),_.each(b,function(a){a.color=a.colorScale=null}),a.parent.setColors(b);f=_.map(b,function(a){return a.data[0].v});a.bufferPercent=null;a.startHidingIndex=null;if(a.isPercentage){var e=100-d3.sum(f);0<e&&(a.bufferPercent=e,f.push(e))}a.pieLayout||(a.pieLayout=d3.layout.pie().sort(null).value(_.identity));var g=a.pieLayout(f);_.each(b,function(b,
f){var e=g[f].startAngle||0,h=g[f].endAngle||0,h={perc:a.round((h-e)/(d/50)),startAngle:e,endAngle:h};a.isPercentage&&(b.parent.data[0][b.valueField]=h.perc,h.v=h.perc);!a.startHidingIndex&&e>5*d/3&&5<g.length-f?a.startHidingIndex=f:a.startHidingIndex&&0<g[f].data&&c++;b.hidden=h.hidden=a.startHidingIndex&&f>=a.startHidingIndex;l.push(b);$.extend(b.data[0],h)});a.startHidingIndex&&4>c&&(a.startHidingIndex=!1,_.each(l,function(a){a.hidden=a.data[0].hidden=!1}));a.startHidingIndex&&(b=b[a.startHidingIndex].data[0].startAngle,
a.otherWedge={startAngle:b,endAngle:2*d,perc:100*(1-b/(2*d)),otherCount:c+" others"})},preUpdate:function(){var a=this.layers.ticks;a.attr.y1=this.lineY1;a.attr.y2=this.lineY2;this.disablePop=!0},update:function(){this.markClashingLabels();this._super();this.initial=!1},updateLayerEnter:function(a,b){var c=this,l=c._super(a,b);"arcs"===a.id&&l.each(function(a){this._current={startAngle:a.startAngle,endAngle:c.animate?a.startAngle:a.endAngle};if(a.series.isOther)d3.select(this).on("mouseenter",function(){c.toggleHidden(!0)}).on("click",
function(){c.toggleHidden(!0)})});return l},updateLayerEnd:function(a,b){var c=this;"arcs"===a.id?c.animate?b.transition().ease("linear").delay(function(a){return c.initial?a.startAngle/(2*d)*1E3:0}).duration(function(a){return c.initial?1E3*a.perc/100:500}).attrTween("d",function(a){var b=d3.interpolate(this._current,_.pick(a,["startAngle","endAngle"]));this._current=b(0);return function(a){return c.arcGenerator(b(a))}}).each("end",function(a,d){d===b.size()-1&&(c.disablePop=!1)}):(b.attr("d",c.arcGenerator),
c.disablePop=!1):(c.animate&&(b=b.transition().delay(function(a){a=a.startAngle+(a.endAngle-a.startAngle)/2;return c.initial?a/(2*d)*1E3:0}).duration(function(){return c.initial?0:500})),"labels"===a.id?(b.attr(a.attr),b.text(function(a){return a.series.isBuffer?"":a.series.isOther?a.otherCount:c.format(a.perc)}).attr("fill",function(a){return a.series.isOther?"#a5a5a5":"#000"})):(b.attr("stroke",function(a){return a.series.isBuffer?"":a.series.isOther?"#a5a5a5":"#000"}),b.attr(a.attr)));b.attr("data-row-id",
_.createCallback("id"))},updateLayerJoin:function(){return 0},highlight:function(a){var b=this;clearTimeout(b.hideAgain);!a&&b.otherWedge&&(b.hideAgain=setTimeout(function(){b.toggleHidden(!1)},100));b.unhighlightAll();if(a&&a.selection){var c=a.selection;a.row||(c=c.selectAll("*"));b.highlightArc(c)}},highlightArc:function(a){var b=this;this.animateArcsTo(a,{arcs:{d:this.arcGenerator.outerRadius(this.outerRadius+10)},text:{transform:function(a){return"translate("+1.1*a.textX+","+1.1*a.textY+")"}},
ticks:{y1:function(){var a=0<parseInt(b.lineY1,0)?10:-10;return b.lineY1+a},y2:function(){var a=0<parseInt(b.lineY2,0)?10:-10;return b.lineY2+a}}})},unhighlightArc:function(a){this.animateArcsTo(a,{arcs:{d:this.arcGenerator.outerRadius(this.outerRadius)},text:{transform:this.layers.text.attr.transform},ticks:this.layers.ticks.attr})},animateArcsTo:function(a,b){a=a.trans(250);a.filter(".gfx-arc").attr(b.arcs);a.filter(".gfx-donut-label-text").attr(b.text);a.filter(".gfx-donut-label-tick").attr(b.ticks);
this.arcGenerator.outerRadius(this.outerRadius)},unhighlightAll:function(){var a=this.parent.g.selectAll("path,text,line");this.unhighlightArc(a)},toggleHidden:function(a){this.showHidden=!!a;a=this.parent.animate;this.parent.animate=!1;this.update();this.parent.animate=a},format:function(a){return this.round(a)+"%"},round:function(a){var b=[0,-1,-2][parseInt(this.roundTo,0)];if(0===b)return Math.round(a);a=+a;b=+b;if(isNaN(a)||"number"!==typeof b||0!==b%1)return NaN;a=a.toString().split("e");a=Math.round(+(a[0]+
"e"+(a[1]?+a[1]-b:-b)));a=a.toString().split("e");return+(a[0]+"e"+(a[1]?+a[1]+b:b))},markClashingLabels:function(){for(var a=this.series,b,c,d,f,e,g=0;g<a.length-1;g++)if(b=a[g].data[0],e=!1,d=b.perc,c=(b.startAngle+b.endAngle)/2,f=g,!(8<d)||this.inClashArea(c)){for(var k=g+1;k<a.length;k++)if(c=a[k].data[0],d+=c.perc,8>d)e=!0,a[g].skip=a[k].skip="gfx-hl-hide gfx-donut-nope",c.perc>b.perc&&(b=c,f=k);else break;e&&!b.hidden&&(a[f].skip="gfx-hl-hide gfx-donut-spared");g=k-1}d=a[0];a=a[a.length-1];
8>d.data[0].perc+a.data[0].perc&&(d.skip||a.skip?a.skip&&(d.skip="gfx-hl-hide gfx-donut-nope"):a.skip="gfx-hl-hide gfx-donut-nope")},inClashArea:function(a){return a>5*d/3||a<d/3||a>2*d/3&&a<4*d/3}})})();
;
(function(){var e=FTB.Chart,f=FTB.ChartSeries,g=FTB.ChartSeriesGroup,d=Math.PI,h=Math.pow(3,2)*d,k=Math.pow(10,2)*d;f.define(e.BUBBLE_MAP,{init:function(c){this._super(c);this.setColorField(c.sizeField)},setColorField:function(c){this.colorField=c;this.colorScale&&this.colorScale.range(this.getColorRange())},getPopFields:function(){return[this.colorLabelField||this.colorField]}});g.define(e.BUBBLE_MAP,{init:function(c){var b=this;this.r=d3.scale.linear().clamp(!0).rangeRound([h,k]);b._super(c);b.setLayers({points:{type:"circle",
mainClass:"gfx-mc-point",extraClass:"gfx-point",attr:{key:function(a){return""+a.lonf+a.latf},fill:function(a){return a.cs.range?a.cs.range()[0]:a.cs(a.c)},color:function(a){return a.cs.range?a.cs.range()[0]:a.cs(a.c)},stroke:function(a){return b.darken(a.cs.range?a.cs.range()[0]:a.cs(a.c))},cy:function(a){return a.latf},cx:function(a){return a.lonf},r:function(a){return a.latf&&a.lonf?_.isNumber(a.s)?Math.sqrt(b.r(a.s||0)/d):3:0}},attrStart:{r:0},attrExit:{r:0}}});b.parent.$el.on("change",".gfx-lgnd-map-select",
function(){b.series[0].setColorField($(this).val());b.series[0].processData();b.parent.update().setLegend()})},preUpdate:function(){var c=this,b=c.layers.points;b.attrEnd.r=function(a){return _.isNumber(a.s)?Math.sqrt(c.r(a.s||0)/d):3};b.cy=function(a){return a.latf};b.cx=function(a){return a.lonf}},updateLayer:function(c){var b=this.activeSeries(),b=b[0].sizeField?d3.extent(_.pluck(b[0].data,"s")):[0,0];this.r.domain(b);this._super(c);this.parent.map.update()},processData:function(){var c=this,b;
_.each(c.parent.data,function(a){(b=c.parent.map.project(a.__longitude,a.__latitude))&&b[0]&&b[1]?(a.__latitude=b[1],a.__longitude=b[0]):(delete a.__latitude,delete a.__longitude)});c._super()},getLegendItems:function(){var c=this,b=c.series[0],a=b.getLegendItem();a.interactive=!1;b.fields&&1!==_.size(b.fields)?(a.label="",a.extras='<select class="gfx-lgnd-map-select">'+_.mapToString(b.fields,function(a){return'<option value="'+a+'"'+(a===b.colorField?" selected":"")+">"+c.parent.fields[a].name+"</option>"})+
"</select>"):a.label=c.parent.fields[b.colorLabelField||b.colorField].name;return[a]},rgba:function(c){if(!this.rgba[c]){var b=d3.rgb(c);this.rgba[c]="rgba("+b.r+","+b.g+","+b.b+",0.6)"}return this.rgba[c]},darken:function(c){this.darken[c]||(this.darken[c]=d3.rgb(c).darker(0.5));return this.darken[c]}})})();
;
(function(){var g=window.Class.extend({init:function(){this._q=[];this._ar=$('<div class="gfx-annt bbx nosel"/>')},getContainer:function(){return this._ar},setChart:function(a){this._cht=a;this._pl=f(a);return this},setHeight:function(a){this._ar.height(a);return this},add:function(a){this._q.push(a);return this},draw:function(){var a=this._pl;try{_.forEach(this._q,function(c){c(a)}),a.appendToContainer(this._ar)}catch(d){if(FTB.IS_DEVELOPER)throw MSG("Unable to draw annotation"),d;}return this}});
FTB.module("FTB.ChartAnnotations",g);var f=function(a){var d=$("<div/>"),c=[],e=[];return{plot:function(a){var b=d.clone();b.html(a.html).css($.extend({position:"absolute",left:a.x,top:a.y},a.css||{}));c.push(b)},postRender:function(a){e.push(a)},appendToContainer:function(a){a.empty();_.forEach(c,function(b){a.append(b)});c=[];_.invoke(e,"call",this);e=[];return this},getItemPositionByIndex:function(c,b){if(!b)throw"Must provide field to plotter.getItemPosition(itemIndex, field)";var d=_.toArray(a.seriesGroups)[0],
e=_.findIndex(d.series,function(a){return a.valueField===b});return d.wrappers.selectAll('[data-row-id="'+a.data[c].id+'"]').filter(function(a,c,b){return b===e}).getClientBox([a.$el])}}}})();
;
(function(){var f=window.Class.extend({init:function(a){$.extend(this,{},a);_.size(this.parent.geojson_name)?(this.addGroups(),this.processData(),this.setProjectionAndPath(),this.setClasses(),this.build(),this.g.selectAll(".shape").attr({fill:"#f1f1f1",stroke:"#D8D8D8","stroke-width":0.6}),this.listenTo(this.parent,"resize",function(){this.scaleAndTranslate();this.redraw()})):this.addSVGMap()},project:function(a,b){return this.projection([a,b])},addGroups:function(){this.bg=this.parent.g.append("g").addClass("background");
this.g=this.parent.g.append("g")},processData:function(){var a=JSON.parse(window.FTB.geo[this.parent.geojson_name]),b;"Topology"===a.type?(b={image:a.objects.payload.info},a=window.topojson.feature(a,a.objects.payload),a.info=b,this.isWorldMap=!1):this.isWorldMap=a.info&&!!a.info.isWorldMap;this.geojson=a},processKeys:function(){this.keyIndexes=_.invert(_.pluck(this.parent.data,this.parent.data[0].__key?"__key":this.parent.series[0].primaryField))},setProjectionAndPath:function(){this.projection=
(this.nonContinental()&&!this.isWorldMap?d3.geo.albersUsa():d3.geo.mercator()).scale(1).translate([0,0]);this.path=d3.geo.path().projection(this.projection);this.scaleAndTranslate()},build:function(){this.g.selectAll("path.shape").data(this.geojson.features).enter().append("path").classed("shape",!0).attr("d",this.path).attr("key",function(a){return a.properties.primary})},update:function(){this.addBackgroundImage()},addSVGMap:function(){this.parent.svg.addClass("gfx-map").attr({viewBox:"0 0 930 600"});
$(this.parent.svg_name?FTB.SVG[this.parent.svg_name]:FTB.SVG.USA).appendTo(this.parent.svg[0][0]);this.g=this.parent.svg.select("svg")},scaleAndTranslate:function(){var a=this.parent.getSVGWidth(),b=this.parent.getSVGHeight(),c=this.getPathBounds(),d=(c[0][0]+c[1][0])/2,e=(c[0][1]+c[1][1])/2,c=0.95/Math.max((c[1][0]-c[0][0])/a,(c[1][1]-c[0][1])/b),a=[a/2-c*d,b/2-c*e];this.projection.scale(c).translate(a);this.path=this.path.projection(this.projection)},redraw:function(){var a=this;a.g.selectAll("path.shape").attr("d",
function(b){return a.path(b._shape?b._shape[0]:b)})},addBackgroundImage:function(){var a=this.geojson&&this.geojson.info&&this.geojson.info.image;if(this.parent.backgroundImage&&a&&a.backgroundUrl){this.$imagePane||this.addImagePane();var b=1/a.realWidth*a.zoomConstant*this.g[0][0].getBBox().width,c=this.parent.getSVGHeight(),d=this.parent.getSVGWidth(),e=d/2-b/2,c=-0.5*(b-c),a=a.backgroundUrl,a=a.replace("a.tiles.findthebest","tiles.graphiq").replace("tiles1","tiles"),d=(d-b)/2,d=0>d?0:d;this.$imagePane.css({"background-image":"url("+
a+")","background-position":e+"px "+c+"px","background-repeat":"no-repeat","background-size":b+"px"});this.$attribution.css("left",d)}},addImagePane:function(){var a=$('<div class="gfx-pane-map"></div>'),b=$('<div class="gfx-pane-map-attr"> \u00a9 <a target="_blank" href="http://www.openstreetmap.org/copyright">OpenStreetMap</a></div>');this.parent.$pane.find(".gfx-pane-inner").prepend(a).append(b);this.$attribution=b;this.$imagePane=a},setClasses:function(){var a=this.geojson.info,b=this.parent.series[0].type;
this.parent.svg.classed("gfx-map",!0).classed("gfx-map-new",!0).classed("gfx-map-img",this.parent.backgroundImage&&a.image&&a.image.backgroundUrl).classed("gfx-map-big",this.isWorldMap).classed("gfx-map-type-"+b,!0).classed("gfx-map-usa",this.useBorder())},nonContinental:function(){var a=this.getGlobalBounds();return 140<a[0][0]||-126>a[0][0]},getGlobalBounds:function(){this.globalBounds||(this.globalBounds=d3.geo.bounds(this.geojson));return this.globalBounds},getPathBounds:function(){this.pathBounds||
(this.pathBounds=this.path.bounds(this.geojson));return this.pathBounds},useBorder:function(){var a=this.getGlobalBounds();return this.nonContinental()&&-127<a[1][0]&&2E3>this.geojson.features.length}}).mixin(_.Events);FTB.module("FTB.ChartMap",f)})();
;
(function(q){function m(a,b,c,d){function e(c,e){m=a.defs[c._hi].data_type;q=a.defs[c._hi].control_type;f=x[c._hi];if(e===r&&!f)return k=1,!1;_.isObject(f)&&void 0!==f.raw&&(f=c.parseDate?f.formatted:f.raw);s&&_.size(s.data)&&l&&e===r&&(_.size(l)&&_.isObject(l[0])&&(l=c.parseDate?_.pluck(l,"formatted"):_.pluck(l,"raw")),h._annotation=s.data[_.indexOf(l,f)]);if("date"===c.type)f=c.parseDate?c.parseDate(f):new Date(1E3*f);else if("number"===c.type){if(null===f||void 0===f||""===f)return;k=0;f=v.test(f)?
parseFloat(f):f}else if("color"===c.type){if(null===f||void 0===f||""===f)return}else"image"===c.type?(f=a.get_img_info(p,"t",c._hi).src)&&(t=!0):"entity"===m&&f&&f.length&&(b.noLinks||(n=f[0].url),f=f[0].title);e===b.descriptionField&&"list"===q&&(a.max_list_items_showing=Infinity,f=a.get_cell(p,c._hi));h[e]=f}var g=[],k,h,f,x,p,t,n,s,l,m,q,r=d[0].primaryField;d=c[r];var v=/^-?[0-9\.%]+$/,w=_.pluck((a.annotations||{}).data,"index_field");_.each(a.data,function(d,t){k=1;h={};m=n=f=void 0;x=d;p=t;
s=a.annotations;l=w;_.each(c,e);n||b.noLinks||(_.size(a.urls)?n=a.urls[p]:a.get_detail_url&&(n=a.get_detail_url(p)));n&&(h._url=n);h._ai=p;k||g.push(h)});b.imageField&&!t&&delete b.imageField;var u;b.timeField?"text"!==c[b.timeField].type&&(u=b.timeField):"date"===d.type&&(u=r);u&&(g=_.sortBy(g,u));return g}function v(a,b){var c={},d,e,g,k=_.filter(["id","__key","__latitude","__longitude",b.timeField,b.colorField,b.colorLabelField,b.descriptionField].concat(b.ghead));_.each(a.head,function(h,f){e=
a.defs[f];g=C(e);if("image"===g){if(!1===b.showImg)return;b.imageField=h}else if(0>k.indexOf(h))return;d=_.pick({addCommas:!!+e.add_commas,prefix:e.prefix,suffix:e.suffix,name:e.name,integer:e.integer,highGood:+e.high_good,precision:e.dec_fraction,type:g,max:"number"===g?D(e,h):void 0},_.identity);d._hi=f;"year"===e.data_type&&(e.date_format="Y");e.date_format&&(d.dateFormat=E(e.date_format));if("year"===e.data_type||"%B"===d.dateFormat)d.parseDate=FTB.Chart.getD3TimeFormatter(b.useUTC)(d.dateFormat).parse;
"number"===g&&(d.formatter=function(b,c){if(void 0!==c._ai){var e=a.data[c._ai][this._hi];if(_.isObject(e)&&e.formatted)return e.formatted}return!1});c[h]=d});b.rotate||!1===b.detectDates||F(c,b.ghead[0],a,b.useUTC);return c}function F(a,b,c,d){a=a[b];if("date"!==a.type){var e,g=c.head.indexOf(b),k=(c.data[0]||[])[g];_.isObject(k)&&k.raw&&(k=k.raw);/year/i.test(b)&&/^\d{4}$/.test(k)?e="%Y":"text"===a.type&&/month/i.test(b)&&12===_.size(c.data)&&(e=/janu/i.test(_.pluck(c.data,g).join(""))?"%B":"%b");
e&&(a.dateFormat=e,a.type="date",a.parseDate=FTB.Chart.getD3TimeFormatter(d)(a.dateFormat).parse)}}function E(a){a=a.replace(/(\w)/g,"%$1");a=a.replace(/F/g,"B");a=a.replace(/M/g,"b");a=a.replace(/j/g,"e");a=a.replace(/g/g,"I");a=a.replace(/i/g,"M");a=a.replace(/a/g,"p");return a=a.replace(/s/g,"S")}function C(a){a=a.data_type;return"number"===a||"currency"===a||"rating"===a?"number":"date"===a||"year"===a?"date":"img"===a?"image":"color"===a?"color":"text"}function D(a,b){if(w[b])return w[b];if(+a.range_max)return+a.range_max;
if(a&&0<=(a.prefix+a.suffix+"").indexOf("%"))return 100}function y(a,b,c){var d=G(a,b,c),e=H(b);_.each(d,function(d){var k=d.colorField||b.colorField;k?_.assign(d,I(a,b,c,k)):e&&!d.color&&(d.color=e[d.valueField])});return d}function G(a,b,c){var d=b.ghead[0];a=b.ghead.slice(1);if(b._type===z){var e={type:FTB.Chart.HEAT_MAP,primaryField:b.ghead[0],labelField:d,fields:a,name:c[d].name,seriesId:0};1===a.length&&"number"!==c[a[0]].type&&(e.colorField=b.colorField||a[0],delete e.fields);return[e]}return b._type===
J?(e={type:FTB.Chart.BUBBLE_MAP,primaryField:b.ghead[0],fields:a,latitudeField:"__latitude",longitudeField:"__longitude",sizeField:a[0],name:c[d].name,seriesId:0},1===a.length&&"number"!==c[a[0]].type&&(e.colorField=b.colorField||a[0],delete e.fields),[e]):b._type===A?[{type:FTB.Chart.SCATTER,labelField:d,primaryField:a[0],valueField:a[1],sizeField:a[2],name:c[d].name,seriesId:0}]:b._type===B?(delete b.featured,b.noShorten||K(a,c),_.map(a,function(a){return{type:FTB.Chart.DONUT,primaryField:d,valueField:a,
name:c[a].name,featured:a===b.featuredField}})):_.map(a,function(a,e){var h={primaryField:d,valueField:a,name:c[a].name,seriesId:a};b.stack&&(h.stack=+b.stack);var f=0<=(b.secondYAxis||[]).indexOf(e);h.axis=f?"y2":"y";b._type===L?h.type=FTB.Chart.AREA:b._type===M?h.type=FTB.Chart.LINE:b._type===N?h.type=FTB.Chart.BAR:b._type===O&&(h.type=f?b.secondaryType:b.primaryType,h.stack=0);return h})}function I(a,b,c,d){var e={colorField:d};if("number"===c[d].type){if(!("expert_rating"!==d&&"auto_ratings"!==
d||b.theme&&"default"!==b.theme)){var g=viz.get(a.get_def(d));g&&(e.colorCallback=function(a){return g.getColor(g.getPercent(a))})}}else b.colorLabelField&&(e.colorLabelField=b.colorLabelField);return e}function H(a){var b=a.theme;a=a.themeMap;if(!b||!_.size(a))return null;_.isString(b)&&(b=/^#/.test(b)?b.split(","):FTB.ChartTheme.getColors(b));return _.mapValues(a,function(a){return b[a]})}function P(a,b){var c=a.data.slice(0),d=b.ghead,e,g=[];b.featured&&(e=_.pluck(a.data,a.id_index).indexOf(b.featured)+
1,delete b.featured);var k=_.pluck(a.defs,"name").slice(0,a.id_index);c.unshift(k);var h=_.reject(d.map(function(b){return 0<=(b=a.head.indexOf(b))?b:null}),_.isNull),c=_.at(q.d3.transpose(c),h);return{defs:c.shift().map(function(c,d){g.push("tf"+d);e===d&&(b.featuredField="tf"+d);return $.extend({},a.defs[d?h[1]:h[0]],{name:d?_.isObject(c)?c.formatted:c:"",data_type:d?void 0:"text"})}),head:g,data:c,get_img_info:$.noop,get_detail_url:$.noop}}function K(a,b){if(!(2>_.size(a))){var c=b[a[0]].name.split(" "),
d=b[a[1]].name.split(" "),e=0,g;for(g in c)if(c[g]===d[g])e++;else break;for(c=0;c<a.length;c++)d=b[a[c]],g=d.name.split(" ").slice(e),_.size(g)&&(d.name=g.join(" "))}}var N=1,A=2,M=3,L=4,z=5,O=6,B=7,J=8;q.ChartFactory={get:function(a){a=this.getOptions(a);return new FTB.Chart(a)},getOptions:function(a){var b=a.app;a.ghead=_.intersection(a.ghead,b.head);_.isObject(a.scaleYAxis)&&(a.scaleYAxis=a.scaleYAxis.always);a.useUTC=!1!==a.useUTC;a.transpose&&(b=P(b,a),a.showImg=!1,a.ghead=b.head);if(!a.theme){var c;
c=0<=[z,A,B].indexOf(a._type)?void 0:2<_.size(a.ghead)-1?"cool":void 0;a.theme=c}c=v(b,a);var d=y(b,a,c),b=m(b,a,c,d);return{fields:c,series:d,data:b,$el:a.$ele,w:a.w,h:a.h,theme:a.theme,allowDynamicHeight:a.allowDynamicHeight,featured:a.featured,animate:!1!==a.animate,showLegend:a.showLegend,showPrimaryLabel:a.showPrimaryLabel,showValueLabel:a.showValueLabel,timeField:a.timeField,imageField:a.imageField,descriptionField:a.descriptionField,uniqueField:a.timeField?null:"id",rotate:a.rotate,flipY:a.flipY,
scaleYAxis:a.scaleYAxis,trendline:a.bestFit||a.trendline,noLinks:a.noLinks,popLink:a.popLink,url:a.url,useUTC:a.useUTC,annotations:a.app.annotations,geo:a.geo,backgroundImage:a.geo&&a.geo.backgroundImage||a.background_map_img,geojson_name:a.app.geojson_name,svg_name:a.app.svg_name,roundTo:a.roundTo,isPercentage:a.isPercentage,order:a.order}},update:function(a,b){b.ghead=_.intersection(b.ghead,b.app.head);var c=v(b.app,b),d=y(b.app,b,c),e=m(b.app,b,c,d),g=_.pick(b,["rotate","trendline"]);$.extend(a,
g);a.setFields(c).setSeries(d).setData(e).update()},updateApp:function(a,b){var c=m(b,a._o,a.fields,a.series);a.animate=!0;a.setData(c).update()}};var w={_urr_avg_rating:5,expert_rating:100,auto_ratings:100}})(window);
;
(function(d,c,e){var f=c.ChartFactory,k=!!c.use_svg,g=1,h=!!FTB.Chart;e=FTB.widget.Base.extend({mainClass:"gfx-main",minHeight:250,defaultHeight:300,init:function(a){_.bindAll(this,"resize");a.options.show_srp&&(FTB.widget.SRP.renderIn(d(".srp-widget[data-id="+a.options.show_srp_id+"]")),this.srp_widget=FTB.widget.getById(a.options.show_srp_id),a.srp_data=this.srp_widget.srp_data);this._super(a);this.viz=this.options.viz},getApp:function(){return this.srp_widget?this.srp_widget.app:this._super()},
isLoaded:function(){return this._super()&&h},lazyLoad:function(a){var b=this;d.when(b.lazyCharts(),b._super()).done(function(){h=!0;a()}).fail(function(){b.remove()})},lazyCharts:function(){return this.lazyChartDef||(this.lazyChartDef=FTB.Chart?!0:FTB.lazy("Charts"))},render:function(a){var b=this;this.$el=a;if(!k||"ok"!==this.srp_data.status)return this.remove();if(!this.isLoaded())return this.lazyLoad(function(){b.render(a);a.find(".spinner").fadeOut("fast",function(){d(this).remove();c.widgetRendered&&
c.widgetRendered()})});this._super(a);this.renderResults();this.initFilters();this.animateOnScroll&&(a.sqrl(function(){b.chart.update()},50),$w.scroll());if(!this.isEmbedded)this.$el.one("mouseenter",function(){b.checkSharable();b.checkPlayground()});this.$el.trigger("gfx-init")},bindEvents:function(){var a=this;c.resize_width_debounce(a.resize);a.$el.on("_resize",a.resize);if(a.options.full_link)a.$el.on("click",".gfx-mouse-target, .gfx-ln-area, .gfx-ln-path",function(b){b=d(b.currentTarget).is("path")?
"Click Area/Line Path":"Click Viz Megalink";EVT(["Viz","Click to DD",b,null,!1]);(c.widget_log||d.noop)("Viz","Click to DD",b);c.open(a.options.url)});return a},renderResults:function(){if(!(FTB.IS_WIDGET&&1>=this.$el.width()))if(this.chart?this.viz.denormField?f.update(this.chart,this.getChartOptions()):f.updateApp(this.chart,this.app):this.initChart(),_.size(this.app.data))this.chart.resetError();else{var a=this.filters?tt("No results, try adjusting filters"):"";this.chart.error(a)}},getChartOptions:function(){var a=
this.viz,b=this.options;return d.extend({_type:a.type,$ele:this.$main,w:this.getChartWidth(),h:this.getHeight(),app:this.app,geojson_name:this.srp_data.geojson_name,svg_name:this.srp_data.svg_name,theme:a.theme,colorField:a.colorField,colorLabelField:a.colorLabelField,descriptionField:a.descriptionField,featured:a.featured,ghead:a.fields||[],allowDynamicHeight:!this.isIframe,showActions:(b.show_action||b.show_srp)&&!this.noLinks,noLinks:!!this.noLinks,popLink:b.pop_link,url:b.url,$tbl:(this.srp_widget||
{}).$el,timeField:a.timeField,useUTC:b.useUTC},a.options)},initChart:function(){var a,b=this.getChartOptions();this.$main.showIf(this.viz.type);if(this.chart=a=f.get(b))this.srp_widget&&!b.transpose&&this.bindTable(),b=!c.is_bot&&!c.IS_MOBILE_APP,b=(a.animate=b)&&"detail"===FTB.page_type&&Math.random()<=g,g/=2,a.animateOnce=b,!b||FTB.explore?a.update():this.animateOnScroll=!0},getChartWidth:function(){return this.$main.width()},resize:function(){this.chart||this.renderResults();if(this.chart&&this.$el.is(":visible")){var a=
this.$main.width();this.isIframe&&(this._height=null,this.applyHeight());var b=this.getHeight();a===this.chart.w&&b===this.chart.h||this.chart.resize(a,b).update()}},bindTable:function(){var a=this,b=a.chart;a.srp_widget.onHover(function(a,c){b.highlightId(c)},function(){b.highlight(!1)});b.on("highlight",_.debounce(function(b){!1===b?a.srp_widget.deselect():b.row&&(a.srp_widget.rowSelect=1,a.srp_widget.select(b.row,!0))},100));var c=b.getFieldColors(),e=a.srp_widget.$el,f=e.find(".floating-header");
(f.length?f:e).find("th").each(function(){var b=a.getApp().head[+d(this).data("index")];d(this).css("borderTop",c[b]?"3px solid "+c[b]:0).addClass("srp-color-th")})},checkSharable:function(){var a=c.widgets[this.widgetId].preset_id;a&&this.chart.addToolbarOption('<div class="gfx-icon-embed"><i class="i icon-embed"></i></div>',function(){EVT([c.get_gaq_page_type(),"Embed from Visualization",null,null,!1]);c.embed(d.extend({compact:!0,anonymous:1,source:"Visualization Embed"},{preset_id:a}))})},checkPlayground:function(){var a=
this.options.playground_softjoin_id;FTB.needsToPollForPlayground&&this.chart.addToolbarOption('<div class="gfx-icon-playground"></div>',function(){c.openSoftjoinInPlayground(a)})},destroy:function(){this._super();this.chart&&this.chart.destroy();c.resize_width_debounce(this.resize,!0)}}).mixin(FTB.widget.filterable);lazy_render(".viz-widget",e.renderIn);FTB.module("FTB.widget.Viz",e)})(jQuery,window);
;
(function(c){function l(a,b,d){if(e.user.uid&&!d)b&&b(!0);else{var f=!1;c.ajax({url:a+"/ftb-auto-login-token",dataType:"jsonp",jsonp:!1,jsonpCallback:"get_session",success:function(a){a&&(h=a.token);f=!!h;b&&b(f)}})}}function n(a,b){l(location.protocol+"//"+location.host,function(d){d?p(a,h,b):m+location.host!==k&&l(k,function(d){d&&p(a,h,b)},!0)},!0)}function p(a,b,d){var f="/ftb-auto-login";a&&(f=m+"www."+a+f);c.ajax({url:f+"?token="+b,dataType:"jsonp",jsonp:!1,jsonpCallback:"get_user",success:function(b){console.log("logged in to "+
a);console.log(b);b.uid&&(e.user.uid=b.uid)},complete:function(){d&&d()}})}function q(a){if(a=r?r[a]:!1){var b=a.next;set_cookie("ftbrrl",b);n(a.domain,function(){b&&q(b)})}else set_cookie("ftbrrl","false")}var e=window.FTB=window.FTB||{},m=e.IS_LOCAL?"http://":"https://",k=m+(e.IS_LOCAL?"www.dw.com":"www.findthebest.com"),r=e.login_domains,h=!1,g;window.ftbRecaptchaCallback=function(){g.resolve()};e.Auth={RECAPTCHA_SITE_KEY:"6LfxXwATAAAAAGgo1U30WTs3h82Gm7NAQzhEb-qk",AUTH_METHOD_FB:"facebook",AUTH_METHOD_FTB:"ftb",
AUTH_METHOD_GOOGLE:"google",is_logged_in:l,auto_login:n,login_using_ftb:function(a){var b=c.Deferred();c.post(location.protocol+"//"+location.host+"/ftb-secure-login",a,null,"json").done(function(a){a.error?b.reject(a.error):location.href=k+"/ftb-secure-login?token="+a.token+"&redirect_uri="+window.get_cookie("login_source")}).fail(function(a){b.reject();console.error(a.error||"Login Error")});return b},register_using_ftb:function(a){var b=c.Deferred();c.post((a.state||"")+"/ftb-secure-register",
a,null,"json").done(function(a){a.user_error?b.reject(a.user_error):location.href=k+"/ftb-secure-register?token="+a.token+"&redirect_uri="+window.get_cookie("login_source")}).fail(function(a){b.reject();console.error(a.error||"Registration Error")});return b},set_login_source:function(a){set_cookie("login_source",a||location.href)},round_robin_login:q,load_recaptcha:function(){if(g)return g;g=c.Deferred();c.getScript("https://www.google.com/recaptcha/api.js?onload=ftbRecaptchaCallback&render=explicit");
return g}}})(jQuery);
;
(function(c){function w(){m();location.href=c(this).data("auth-url")}function x(){m();location.href=c(this).data("auth-url")}function y(a){a.preventDefault();l(!0);var b=c("#user-login-small-form");a=s(b);var g="";m();a?h.login_using_ftb(a).fail(function(a){p(b,[{id:g,value:a||"Login failed, please try again later."}]);l(!1)}):(b.find(".required").each(function(){this.value||(g+=this.id+", #")}),g=g.substring(0,g.length-3),p(b,[{id:g,value:"Must provide email and password."}]),l(!1))}function z(a){a.preventDefault();
a=e.find("#edit-pass");var b=e.find("#edit-mail");e.find(".mail-error").toggleClass("active",""===b.val());e.find(".password-error").toggleClass("active",6>a.val().length);c(".username-error.active").length||c(".password-error.active").length||c(".mail-error.active").length?c(".username-error, .password-error, .mail-error").css("color","red"):(e.removeClass("tc-error"),window.cleanup_placeholders(),l(!0),m(),a=s(e),a.captcha_response=window.grecaptcha.getResponse(A),a.reg_url=location.href,h.register_using_ftb(a).fail(function(a){p(e,
[{id:"",value:a||"Registration failed, please try again later."}]);l(!1)}))}function m(){h.set_login_source(d.redirect)}function p(a,b){a.find(".messages").remove();a.find(".error").removeClass("error");if(b){for(var d=c("<div>").addClass("messages").addClass("error"),e=0;e<b.length;e++){var f=b[e];f.id&&a.find("#"+f.id).addClass("error");d.append(f.value+"<br/>")}a.prepend(d)}}function l(a){var b=c(".login-loading").toggleClass("active",a);!1===a?setTimeout(function(){b.hide().spin()},200):b.show().spin()}
function s(a){var b={drupal_ajax:1};a.find("input").each(function(){-1<this.className.indexOf("required")&&!this.value&&(b=!1);b&&(b[this.name]=this.value)});return b}function n(a){BOX.hide();t(a)&&f&&(f.find("#edit-dest").val(d.destination?d.destination:""),d.message&&f.find("#login-title").text(d.message),f.show(),window.loginBox=BOX.show({html:f,onclose:function(){f.parent().append(f.hide());if(d.onClose)d.onClose()}}))}function u(a){t(a)&&(q?v():c.getJSON("/user_register_form?purpose"+d.purpose,
function(a){a&&a.html&&(q=a.html,v())}))}function v(){BOX.hide();BOX.show({html:q,fixed:!0,onClose:d.onClose});e=c("#user-register-small-form");e.css({maxHeight:c(window).height()-150,overflowY:"auto",overflowX:"hidden"});c.getScript("https://www.google.com/recaptcha/api.js");window.setup_placeholders()}function B(){var a=e.find(".username-error");c.get("/ajax_valid_username",{username:c(this).val(),r:Math.random()}).done(function(b){a.toggleClass("active",!b.is_valid)})}function C(){var a=e.find(".mail-error");
c.get("/ajax_valid_email",{email:c(this).val(),r:Math.random()}).done(function(b){b=JSON.parse(b);a.toggleClass("active",!b.is_valid)})}function t(a){window.loginBox&&(f.hide(),window.loginBox.hide());if(!1===a)return!1;d=c.extend({},D,a);set_cookie("login_purpose",d.purpose);set_cookie("ftbrrl","0");d.callback&&(set_cookie("login_callback","true"),r.set("callback_info",JSON.stringify({data:d.callback_data,callback:d.callback})));return!0}var k=window.FTB=window.FTB||{},h=k.Auth,f=c(".popup_login_box"),
D={callback:null,callback_data:null,method:h.AUTH_METHOD_FTB,message:null,purpose:"manual",redirect:null,onClose:null},d={},q=!1,e,A,r=window.persist("login_data");k.user=k.user||{};k.user.uid||(k.user.renderLoginForm=n,k.user.renderRegistrationForm=u,c("body").on("click","#create-account-btn",u).on("click","#existing-account-btn",n).on("click",".google-login-btn",w).on("click",".fb-login-btn",x).on("click","form#user-login-small-form input[type=submit]",y).on("click","form#user-register-small-form input[type=submit]",
z).on("change","form#user-register-small-form input#edit-name",B).on("change","form#user-register-small-form input#edit-email",C).on("keyup","form#user-register-small-form input#edit-pass",function(){e.find(".password-error").toggleClass("active",6>c(this).val().length)}).on("click",".popup_login_dlg",function(a){a.preventDefault();a=c(this);n({redirect:a.attr("href")||null,purpose:a.data("login-purpose")||a.attr("id")||"force_login"});return!1}));c(function(){gatekeeper("Login: enable auto login")&&
h.auto_login(null,function(){location.reload()});if("true"===GET().prompt_login||0<=window.location.hash.indexOf("prompt_login=true"))n({message:"Get more out of your experience by logging in now.",purpose:"page_load_prompt"});else if("true"===window.get_cookie("login_callback")||"true"===GET().login_callback||0<=window.location.hash.indexOf("login_callback=true")){var a=JSON.parse(r.get("callback_info"));if(a){var b=window,c=a.callback.split(".");r.remove("callback_info");for(var d=0;d<c.length;d++)b=
b[c[d]];b(a.data)}window.set_cookie("login_callback",!1)}a=get_cookie("ftbrrl");(0===a||a&&"false"!==a)&&h.round_robin_login(a)})})(jQuery);
;
(function(d){var a=d.FTB||{},c=0;a.track_gmaps=function(b){c++;b={page_type:a.page_type||"other",order_on_page:c,is_bot:d.is_bot,title:b};a.Analytics&&a.Analytics.send_data("gmaps",b)};a.gmaps_error=function(b,c){var e={page_type:a.page_type||"other",title:b+" error",is_bot:d.is_bot,error:c};a.Analytics&&a.Analytics.send_data("gmaps",e)}})(window);
;
$(function(){var a=[7434,7522];$d.on("contextmenu","img",function(){var b=this.src;return 0===_.filter(a,function(a){return-1<b.indexOf("sites/default/files/"+a+"/media/images")}).length})});
;
(function(){FTB.module("FTB.utils.ComponentTracker",function(b){function g(){var a=+new Date,k=window.$wScroll.scrollTop();f||(f=a);e||($w.width(),e=$w.height());var m=k+e,d=_.filter(h,function(a){if(a.visible)if(a.height>e){if(a.offsetTop+a.height<k+e*b.percent||a.offsetTop>m-e*b.percent)return!1}else{if(a.offsetTop+a.height*b.percent<k||a.offsetTop+a.height*(1-b.percent)>m)return!1}else return!1;return!0});_.forEach(d,function(b){c[b.id]||(c[b.id]={inView:0,hoverTime:0,clicks:0});c[b.id].inView+=
a-f});f=a}var d={},h={},c={},f,e,l=!1;b=$.extend({},{percent:0.5,showInSeconds:!0,timeMinimum:1},b);d.resize=function(a){l&&(a||b.$el||$d).find(b.selector).each(function(){var a=$(this),b=a.attr("data-cptid");b||(b=_.uniqueId(),a.attr("data-cptid",b));var c=a.offset();h[b]={id:b,offsetTop:c.top,offsetLeft:c.left,height:a.height(),$node:a,visible:a.is(":visible")}})};d.start=function(){l=!0;d.resize();g()};d.stop=function(){g();l=!1;f=void 0};d.getData=function(){g();return _.map(c,function(a,c){var d=
{$node:h[c].$node},e=b.showInSeconds?1E3*b.timeMinimum:b.timeMinimum;a.inView&&a.inView>e&&(d.inView=b.showInSeconds?a.inView/1E3:a.inView);a.hoverTime&&a.hoverTime>e&&(d.hoverTime=b.showInSeconds?a.hoverTime/1E3:a.hoverTime);a.clicks&&(d.clicks=a.clicks);return d})};d.paint=function(){var a=_.max(c,function(a){return a.inView}).inView;_.forEach(c,function(b,c){h[c].$node.css("opacity",b.inView/a)})};scroll_throttle(function(){g()});resize_debounce(function(){d.resize()});resize_throttle(function(){$w.width();
e=$w.height()});$d.on("mouseenter",b.selector,function(){var a=this.getAttribute("data-cptid");c[a]&&(c[a].startHover=+new Date)}).on("mouseleave",b.selector,function(){var a=this.getAttribute("data-cptid");c[a]&&c[a].startHover&&(c[a].hoverTime+=+new Date-c[a].startHover,delete c[a].startHover)}).on("click",b.selector,function(){var a=this.getAttribute("data-cptid");c[a]&&c[a].clicks++});return d})})();
;
(function(){function l(){void 0!==a.hidden&&(document[a.hidden]?(c+=+new Date-d,g(),EVT(["Engagement","Viewability","Browser out of view",time_on_site(),!0]),$d.trigger("onBrowserViewChange",!1)):(d=+new Date,EVT(["Engagement","Viewability","Browser back of view",time_on_site(),!0]),$d.trigger("onBrowserViewChange",!0)))}function m(){h++}function g(){clearTimeout(e);f=!0}var a=function(){var a,b;void 0!==document.hidden?(a="hidden",b="visibilitychange"):void 0!==document.mozHidden?(a="mozHidden",
b="mozvisibilitychange"):void 0!==document.msHidden?(a="msHidden",b="msvisibilitychange"):void 0!==document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");return{hidden:a,visibilityChange:b}}(),h=0,c=0,d=+new Date,f=!0,k,e;if(a.visibilityChange)$d.on(a.visibilityChange,l);$d.on("keydown click mousemove scroll",_.throttle(function(){f&&(clearTimeout(e),e=setInterval(m,1E3),f=!1);clearTimeout(k);k=setTimeout(g,5100)},1E3,{trailing:!1}));FTB.module("FTB.utils",{engaged_time:function(){return void 0===
a.hidden?!1:h},viewable_time:function(){return void 0===a.hidden?!1:(c+(+new Date-d))/1E3>>0}})})();
;
(function(){function p(){return FTB.ABTest?_.map(FTB.ABTest.all_tags(),function(a,c){return c+":"+a}).join(","):""}function q(){return JSON.stringify(_.map(EVT.getAll(),function(a){return{category:a.eventCategory,action:a.eventAction,label:a.eventLabel,interaction:!a.nonInteraction,time:a.time}}))}function e(){return time_on_site()>k||l&&"widget"!==FTB.page_type||FTB.Analytics&&!FTB.Analytics.isEnabled()?$.Deferred().resolve():$.ajax({url:gatekeeper("Analytics Funnel: funn.graphiq.com")&&!FTB.IS_LOCAL?
"https://funn.graphiq.com/ajax/analytics/funnel":"/ajax/analytics/funnel",type:"POST",data:$.extend({version:FTB.AnalyticsFunnel.version,evt_data:q(),page_type:FTB.real_page_type||FTB.page_type,page_hash:r,ab_tests:p(),scroll_depth:d||0,page_height:f||$d.height(),screen_height:b||$w.height(),load_timestamp:s,current_timestamp:+new Date((new Date).toUTCString()),time_on_page:time_on_site(),time_viewable:FTB.utils.viewable_time()||0,time_engaged:FTB.utils.engaged_time()||0},FTB.Analytics.default_data(),
t())}).fail(function(){clearTimeout(m)})}function t(){var a={};_.forEach(g,function(c,b){a[b]=c()});return a}function u(a,b){if(g[a])throw"Analytics Funnel already has this field ("+a+") defined";g[a]=b}function h(){document.hidden||document.webkitHidden||document.msHidden||document.mozHidden||e();time_on_site()>k||(m=setTimeout(h,v))}if(!FTB.disable_all_tracking){var v=1E4,k=300,d=0,b,f=0,n=_.debounce(function(){b||(b=$w.height());var a=$d.height(),c=$w.scrollTop();f=Math.max(f,a);d=Math.min(Math.max(c/
(a-b),d),1);1===d&&$w.off("scroll",n)},200);$w.on("scroll",n);resize_debounce(function(){b=$w.height()});var l=!1;set_cookie("__afct","on");"on"!==get_cookie("__afct")&&(EVT(["Engagement","Cookies","Disabled",0,!0]),l=!0);var s=+new Date((new Date).toUTCString()),r=randHash(60),g={},m;if(FTB.Analytics.tracked_session)h();else FTB.Analytics.on("tracked-session",h);$w.on("unload",e);FTB.module("FTB.AnalyticsFunnel",{ping:e,register:u})}})();
;
